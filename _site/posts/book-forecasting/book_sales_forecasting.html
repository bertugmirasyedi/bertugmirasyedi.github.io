<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-11-27">
<meta name="description" content="From Classical Statistical Models to XGBoost">

<title>Data and Decisions - Book Sales Forecasting: Comparison of Different Models Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.16.1.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data and Decisions</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bertugmirasyedi"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/bertugmirasyedi"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Book Sales Forecasting: Comparison of Different Models Part 1</h1>
                  <div>
        <div class="description">
          From Classical Statistical Models to XGBoost
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">time series forecasting</div>
                <div class="quarto-category">xgboost</div>
                <div class="quarto-category">arima</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 27, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#data-analysis-and-preprocessing" id="toc-data-analysis-and-preprocessing" class="nav-link" data-scroll-target="#data-analysis-and-preprocessing"><span class="toc-section-number">2</span>  Data Analysis and Preprocessing</a></li>
  <li><a href="#modelling" id="toc-modelling" class="nav-link" data-scroll-target="#modelling"><span class="toc-section-number">3</span>  Modelling</a>
  <ul class="collapse">
  <li><a href="#stl-arima" id="toc-stl-arima" class="nav-link" data-scroll-target="#stl-arima"><span class="toc-section-number">3.1</span>  STL-ARIMA</a></li>
  <li><a href="#forecasting-with-exogenous-regressors" id="toc-forecasting-with-exogenous-regressors" class="nav-link" data-scroll-target="#forecasting-with-exogenous-regressors"><span class="toc-section-number">3.2</span>  Forecasting with Exogenous Regressors</a>
  <ul class="collapse">
  <li><a href="#arimax" id="toc-arimax" class="nav-link" data-scroll-target="#arimax"><span class="toc-section-number">3.2.1</span>  ARIMAX</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="toc-section-number">3.2.2</span>  XGBoost</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#business-case-objective-function" id="toc-business-case-objective-function" class="nav-link" data-scroll-target="#business-case-objective-function"><span class="toc-section-number">4</span>  Business Case Objective Function</a></li>
  <li><a href="#hyperparameter-tuning-with-optuna" id="toc-hyperparameter-tuning-with-optuna" class="nav-link" data-scroll-target="#hyperparameter-tuning-with-optuna"><span class="toc-section-number">5</span>  Hyperparameter Tuning with Optuna</a>
  <ul class="collapse">
  <li><a href="#stl-arima-tuning" id="toc-stl-arima-tuning" class="nav-link" data-scroll-target="#stl-arima-tuning"><span class="toc-section-number">5.1</span>  STL-ARIMA Tuning</a></li>
  <li><a href="#arimax-tuning" id="toc-arimax-tuning" class="nav-link" data-scroll-target="#arimax-tuning"><span class="toc-section-number">5.2</span>  ARIMAX Tuning</a></li>
  <li><a href="#xgboost-tuning" id="toc-xgboost-tuning" class="nav-link" data-scroll-target="#xgboost-tuning"><span class="toc-section-number">5.3</span>  XGBoost Tuning</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="images/forecast.png" class="img-fluid"></p>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Time series forecasting is one of the most important fields in statistics because it is arguably the most impactful for businesses. Every business would love to know what will happen tomorrow, next week, next year, and next 10 years and make decisions accordingly. Although statistical methods for forecasting is not quite the silver bullet, it can help us make reasonable predictions under certain assumptions.</p>
<p>In this post, we will look into several forecasting models - both classical methods (e.g.&nbsp;ARIMA) and deep learing (LSTM, CNN) - and compare their performance using hyperparameter optimization with Optuna. I will also assume a business case in the end and the best model will be the less costly one. Let’s start with some data analysis and visualizations.</p>
</section>
<section id="data-analysis-and-preprocessing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data Analysis and Preprocessing</h1>
<p>Firstly we will import the training dataset <code>train.csv</code> using <code>pandas</code> and check its columns and some sample values.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>local_filepath <span class="op">=</span> <span class="st">"train.csv"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pandas.read_csv(local_filepath)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data.sample()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>row_id</th>
      <th>date</th>
      <th>country</th>
      <th>store</th>
      <th>product</th>
      <th>num_sold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55324</th>
      <td>55324</td>
      <td>2020-02-27</td>
      <td>Italy</td>
      <td>KaggleRama</td>
      <td>Kaggle Advanced Techniques</td>
      <td>162</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>row_id</th>
      <th>num_sold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>70128.000000</td>
      <td>70128.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>35063.500000</td>
      <td>194.296986</td>
    </tr>
    <tr>
      <th>std</th>
      <td>20244.354176</td>
      <td>126.893874</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>19.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>17531.750000</td>
      <td>95.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>35063.500000</td>
      <td>148.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>52595.250000</td>
      <td>283.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>70127.000000</td>
      <td>986.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">True</span> <span class="kw">in</span> data.isnull()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>False</code></pre>
</div>
</div>
<p>Good. The data don’t have any missing values. Now let’s check for what kind of values that the data have on each column.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique country values are: </span><span class="sc">{</span>data[<span class="st">'country'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique store values are: </span><span class="sc">{</span>data[<span class="st">'store'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique product values are: </span><span class="sc">{</span>data[<span class="st">'product'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique dates are: </span><span class="sc">{</span>data[<span class="st">'date'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unique country values are: ['Belgium' 'France' 'Germany' 'Italy' 'Poland' 'Spain']

Unique store values are: ['KaggleMart' 'KaggleRama']

Unique product values are: ['Kaggle Advanced Techniques' 'Kaggle Getting Started'
 'Kaggle Recipe Book' 'Kaggle for Kids: One Smart Goose']

Unique dates are: ['2017-01-01' '2017-01-02' '2017-01-03' ... '2020-12-29' '2020-12-30'
 '2020-12-31']
</code></pre>
</div>
</div>
<p>So the table has the daily sales data of <strong>4 different books</strong>, sold in <strong>2 different stores</strong>, which have branches in <strong>6 different countries</strong>, spanning from <strong>start of 2017 to the end of 2020</strong>. Data has 70128 rows which means for each book, store and country combination we have 4 years of sales data.</p>
<p>Let’s plot a subset of the whole data.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>subsets <span class="op">=</span> pandas.DataFrame()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>subsets[<span class="st">"subset1"</span>] <span class="op">=</span> data[</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    (data[<span class="st">"country"</span>] <span class="op">==</span> <span class="st">"Germany"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"store"</span>] <span class="op">==</span> <span class="st">"KaggleMart"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"product"</span>] <span class="op">==</span> <span class="st">"Kaggle Advanced Techniques"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>].set_index(<span class="st">"date"</span>)[<span class="st">"num_sold"</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>subsets[<span class="st">"subset2"</span>] <span class="op">=</span> data[</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    (data[<span class="st">"country"</span>] <span class="op">==</span> <span class="st">"Belgium"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"store"</span>] <span class="op">==</span> <span class="st">"KaggleRama"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"product"</span>] <span class="op">==</span> <span class="st">"Kaggle Getting Started"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>].set_index(<span class="st">"date"</span>)[<span class="st">"num_sold"</span>]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>subsets[<span class="st">"subset3"</span>] <span class="op">=</span> data[</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    (data[<span class="st">"country"</span>] <span class="op">==</span> <span class="st">"France"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"store"</span>] <span class="op">==</span> <span class="st">"KaggleMart"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data[<span class="st">"product"</span>] <span class="op">==</span> <span class="st">"Kaggle Recipe Book"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>].set_index(<span class="st">"date"</span>)[<span class="st">"num_sold"</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    subsets,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">700</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Sales Data For Different Subsets"</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"value"</span>: <span class="st">"Sales"</span>, <span class="st">"date"</span>: <span class="st">"Date"</span>, <span class="st">"variable"</span>: <span class="st">""</span>},</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>fig.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>                            <div id="bbef70f4-a7fa-451d-abb3-9ff8122a07e0" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("bbef70f4-a7fa-451d-abb3-9ff8122a07e0")) {                    Plotly.newPlot(                        "bbef70f4-a7fa-451d-abb3-9ff8122a07e0",                        [{"hovertemplate":"=subset1<br>Date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"subset1","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"subset1","showlegend":true,"x":["2017-01-01","2017-01-02","2017-01-03","2017-01-04","2017-01-05","2017-01-06","2017-01-07","2017-01-08","2017-01-09","2017-01-10","2017-01-11","2017-01-12","2017-01-13","2017-01-14","2017-01-15","2017-01-16","2017-01-17","2017-01-18","2017-01-19","2017-01-20","2017-01-21","2017-01-22","2017-01-23","2017-01-24","2017-01-25","2017-01-26","2017-01-27","2017-01-28","2017-01-29","2017-01-30","2017-01-31","2017-02-01","2017-02-02","2017-02-03","2017-02-04","2017-02-05","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-11","2017-02-12","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-18","2017-02-19","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-25","2017-02-26","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-04","2017-03-05","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-11","2017-03-12","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-18","2017-03-19","2017-03-20","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-25","2017-03-26","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-01","2017-04-02","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-08","2017-04-09","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-15","2017-04-16","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-22","2017-04-23","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-04-29","2017-04-30","2017-05-01","2017-05-02","2017-05-03","2017-05-04","2017-05-05","2017-05-06","2017-05-07","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-13","2017-05-14","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-20","2017-05-21","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-27","2017-05-28","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-03","2017-06-04","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-10","2017-06-11","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-17","2017-06-18","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-24","2017-06-25","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-05","2017-08-06","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-11","2017-08-12","2017-08-13","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-19","2017-08-20","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-26","2017-08-27","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-02","2017-09-03","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-09","2017-09-10","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-16","2017-09-17","2017-09-18","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-23","2017-09-24","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-09-30","2017-10-01","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-07","2017-10-08","2017-10-09","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-14","2017-10-15","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-21","2017-10-22","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-28","2017-10-29","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-03","2017-11-04","2017-11-05","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-11","2017-11-12","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-18","2017-11-19","2017-11-20","2017-11-21","2017-11-22","2017-11-23","2017-11-24","2017-11-25","2017-11-26","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-02","2017-12-03","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-09","2017-12-10","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-16","2017-12-17","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-23","2017-12-24","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29","2017-12-30","2017-12-31","2018-01-01","2018-01-02","2018-01-03","2018-01-04","2018-01-05","2018-01-06","2018-01-07","2018-01-08","2018-01-09","2018-01-10","2018-01-11","2018-01-12","2018-01-13","2018-01-14","2018-01-15","2018-01-16","2018-01-17","2018-01-18","2018-01-19","2018-01-20","2018-01-21","2018-01-22","2018-01-23","2018-01-24","2018-01-25","2018-01-26","2018-01-27","2018-01-28","2018-01-29","2018-01-30","2018-01-31","2018-02-01","2018-02-02","2018-02-03","2018-02-04","2018-02-05","2018-02-06","2018-02-07","2018-02-08","2018-02-09","2018-02-10","2018-02-11","2018-02-12","2018-02-13","2018-02-14","2018-02-15","2018-02-16","2018-02-17","2018-02-18","2018-02-19","2018-02-20","2018-02-21","2018-02-22","2018-02-23","2018-02-24","2018-02-25","2018-02-26","2018-02-27","2018-02-28","2018-03-01","2018-03-02","2018-03-03","2018-03-04","2018-03-05","2018-03-06","2018-03-07","2018-03-08","2018-03-09","2018-03-10","2018-03-11","2018-03-12","2018-03-13","2018-03-14","2018-03-15","2018-03-16","2018-03-17","2018-03-18","2018-03-19","2018-03-20","2018-03-21","2018-03-22","2018-03-23","2018-03-24","2018-03-25","2018-03-26","2018-03-27","2018-03-28","2018-03-29","2018-03-30","2018-03-31","2018-04-01","2018-04-02","2018-04-03","2018-04-04","2018-04-05","2018-04-06","2018-04-07","2018-04-08","2018-04-09","2018-04-10","2018-04-11","2018-04-12","2018-04-13","2018-04-14","2018-04-15","2018-04-16","2018-04-17","2018-04-18","2018-04-19","2018-04-20","2018-04-21","2018-04-22","2018-04-23","2018-04-24","2018-04-25","2018-04-26","2018-04-27","2018-04-28","2018-04-29","2018-04-30","2018-05-01","2018-05-02","2018-05-03","2018-05-04","2018-05-05","2018-05-06","2018-05-07","2018-05-08","2018-05-09","2018-05-10","2018-05-11","2018-05-12","2018-05-13","2018-05-14","2018-05-15","2018-05-16","2018-05-17","2018-05-18","2018-05-19","2018-05-20","2018-05-21","2018-05-22","2018-05-23","2018-05-24","2018-05-25","2018-05-26","2018-05-27","2018-05-28","2018-05-29","2018-05-30","2018-05-31","2018-06-01","2018-06-02","2018-06-03","2018-06-04","2018-06-05","2018-06-06","2018-06-07","2018-06-08","2018-06-09","2018-06-10","2018-06-11","2018-06-12","2018-06-13","2018-06-14","2018-06-15","2018-06-16","2018-06-17","2018-06-18","2018-06-19","2018-06-20","2018-06-21","2018-06-22","2018-06-23","2018-06-24","2018-06-25","2018-06-26","2018-06-27","2018-06-28","2018-06-29","2018-06-30","2018-07-01","2018-07-02","2018-07-03","2018-07-04","2018-07-05","2018-07-06","2018-07-07","2018-07-08","2018-07-09","2018-07-10","2018-07-11","2018-07-12","2018-07-13","2018-07-14","2018-07-15","2018-07-16","2018-07-17","2018-07-18","2018-07-19","2018-07-20","2018-07-21","2018-07-22","2018-07-23","2018-07-24","2018-07-25","2018-07-26","2018-07-27","2018-07-28","2018-07-29","2018-07-30","2018-07-31","2018-08-01","2018-08-02","2018-08-03","2018-08-04","2018-08-05","2018-08-06","2018-08-07","2018-08-08","2018-08-09","2018-08-10","2018-08-11","2018-08-12","2018-08-13","2018-08-14","2018-08-15","2018-08-16","2018-08-17","2018-08-18","2018-08-19","2018-08-20","2018-08-21","2018-08-22","2018-08-23","2018-08-24","2018-08-25","2018-08-26","2018-08-27","2018-08-28","2018-08-29","2018-08-30","2018-08-31","2018-09-01","2018-09-02","2018-09-03","2018-09-04","2018-09-05","2018-09-06","2018-09-07","2018-09-08","2018-09-09","2018-09-10","2018-09-11","2018-09-12","2018-09-13","2018-09-14","2018-09-15","2018-09-16","2018-09-17","2018-09-18","2018-09-19","2018-09-20","2018-09-21","2018-09-22","2018-09-23","2018-09-24","2018-09-25","2018-09-26","2018-09-27","2018-09-28","2018-09-29","2018-09-30","2018-10-01","2018-10-02","2018-10-03","2018-10-04","2018-10-05","2018-10-06","2018-10-07","2018-10-08","2018-10-09","2018-10-10","2018-10-11","2018-10-12","2018-10-13","2018-10-14","2018-10-15","2018-10-16","2018-10-17","2018-10-18","2018-10-19","2018-10-20","2018-10-21","2018-10-22","2018-10-23","2018-10-24","2018-10-25","2018-10-26","2018-10-27","2018-10-28","2018-10-29","2018-10-30","2018-10-31","2018-11-01","2018-11-02","2018-11-03","2018-11-04","2018-11-05","2018-11-06","2018-11-07","2018-11-08","2018-11-09","2018-11-10","2018-11-11","2018-11-12","2018-11-13","2018-11-14","2018-11-15","2018-11-16","2018-11-17","2018-11-18","2018-11-19","2018-11-20","2018-11-21","2018-11-22","2018-11-23","2018-11-24","2018-11-25","2018-11-26","2018-11-27","2018-11-28","2018-11-29","2018-11-30","2018-12-01","2018-12-02","2018-12-03","2018-12-04","2018-12-05","2018-12-06","2018-12-07","2018-12-08","2018-12-09","2018-12-10","2018-12-11","2018-12-12","2018-12-13","2018-12-14","2018-12-15","2018-12-16","2018-12-17","2018-12-18","2018-12-19","2018-12-20","2018-12-21","2018-12-22","2018-12-23","2018-12-24","2018-12-25","2018-12-26","2018-12-27","2018-12-28","2018-12-29","2018-12-30","2018-12-31","2019-01-01","2019-01-02","2019-01-03","2019-01-04","2019-01-05","2019-01-06","2019-01-07","2019-01-08","2019-01-09","2019-01-10","2019-01-11","2019-01-12","2019-01-13","2019-01-14","2019-01-15","2019-01-16","2019-01-17","2019-01-18","2019-01-19","2019-01-20","2019-01-21","2019-01-22","2019-01-23","2019-01-24","2019-01-25","2019-01-26","2019-01-27","2019-01-28","2019-01-29","2019-01-30","2019-01-31","2019-02-01","2019-02-02","2019-02-03","2019-02-04","2019-02-05","2019-02-06","2019-02-07","2019-02-08","2019-02-09","2019-02-10","2019-02-11","2019-02-12","2019-02-13","2019-02-14","2019-02-15","2019-02-16","2019-02-17","2019-02-18","2019-02-19","2019-02-20","2019-02-21","2019-02-22","2019-02-23","2019-02-24","2019-02-25","2019-02-26","2019-02-27","2019-02-28","2019-03-01","2019-03-02","2019-03-03","2019-03-04","2019-03-05","2019-03-06","2019-03-07","2019-03-08","2019-03-09","2019-03-10","2019-03-11","2019-03-12","2019-03-13","2019-03-14","2019-03-15","2019-03-16","2019-03-17","2019-03-18","2019-03-19","2019-03-20","2019-03-21","2019-03-22","2019-03-23","2019-03-24","2019-03-25","2019-03-26","2019-03-27","2019-03-28","2019-03-29","2019-03-30","2019-03-31","2019-04-01","2019-04-02","2019-04-03","2019-04-04","2019-04-05","2019-04-06","2019-04-07","2019-04-08","2019-04-09","2019-04-10","2019-04-11","2019-04-12","2019-04-13","2019-04-14","2019-04-15","2019-04-16","2019-04-17","2019-04-18","2019-04-19","2019-04-20","2019-04-21","2019-04-22","2019-04-23","2019-04-24","2019-04-25","2019-04-26","2019-04-27","2019-04-28","2019-04-29","2019-04-30","2019-05-01","2019-05-02","2019-05-03","2019-05-04","2019-05-05","2019-05-06","2019-05-07","2019-05-08","2019-05-09","2019-05-10","2019-05-11","2019-05-12","2019-05-13","2019-05-14","2019-05-15","2019-05-16","2019-05-17","2019-05-18","2019-05-19","2019-05-20","2019-05-21","2019-05-22","2019-05-23","2019-05-24","2019-05-25","2019-05-26","2019-05-27","2019-05-28","2019-05-29","2019-05-30","2019-05-31","2019-06-01","2019-06-02","2019-06-03","2019-06-04","2019-06-05","2019-06-06","2019-06-07","2019-06-08","2019-06-09","2019-06-10","2019-06-11","2019-06-12","2019-06-13","2019-06-14","2019-06-15","2019-06-16","2019-06-17","2019-06-18","2019-06-19","2019-06-20","2019-06-21","2019-06-22","2019-06-23","2019-06-24","2019-06-25","2019-06-26","2019-06-27","2019-06-28","2019-06-29","2019-06-30","2019-07-01","2019-07-02","2019-07-03","2019-07-04","2019-07-05","2019-07-06","2019-07-07","2019-07-08","2019-07-09","2019-07-10","2019-07-11","2019-07-12","2019-07-13","2019-07-14","2019-07-15","2019-07-16","2019-07-17","2019-07-18","2019-07-19","2019-07-20","2019-07-21","2019-07-22","2019-07-23","2019-07-24","2019-07-25","2019-07-26","2019-07-27","2019-07-28","2019-07-29","2019-07-30","2019-07-31","2019-08-01","2019-08-02","2019-08-03","2019-08-04","2019-08-05","2019-08-06","2019-08-07","2019-08-08","2019-08-09","2019-08-10","2019-08-11","2019-08-12","2019-08-13","2019-08-14","2019-08-15","2019-08-16","2019-08-17","2019-08-18","2019-08-19","2019-08-20","2019-08-21","2019-08-22","2019-08-23","2019-08-24","2019-08-25","2019-08-26","2019-08-27","2019-08-28","2019-08-29","2019-08-30","2019-08-31","2019-09-01","2019-09-02","2019-09-03","2019-09-04","2019-09-05","2019-09-06","2019-09-07","2019-09-08","2019-09-09","2019-09-10","2019-09-11","2019-09-12","2019-09-13","2019-09-14","2019-09-15","2019-09-16","2019-09-17","2019-09-18","2019-09-19","2019-09-20","2019-09-21","2019-09-22","2019-09-23","2019-09-24","2019-09-25","2019-09-26","2019-09-27","2019-09-28","2019-09-29","2019-09-30","2019-10-01","2019-10-02","2019-10-03","2019-10-04","2019-10-05","2019-10-06","2019-10-07","2019-10-08","2019-10-09","2019-10-10","2019-10-11","2019-10-12","2019-10-13","2019-10-14","2019-10-15","2019-10-16","2019-10-17","2019-10-18","2019-10-19","2019-10-20","2019-10-21","2019-10-22","2019-10-23","2019-10-24","2019-10-25","2019-10-26","2019-10-27","2019-10-28","2019-10-29","2019-10-30","2019-10-31","2019-11-01","2019-11-02","2019-11-03","2019-11-04","2019-11-05","2019-11-06","2019-11-07","2019-11-08","2019-11-09","2019-11-10","2019-11-11","2019-11-12","2019-11-13","2019-11-14","2019-11-15","2019-11-16","2019-11-17","2019-11-18","2019-11-19","2019-11-20","2019-11-21","2019-11-22","2019-11-23","2019-11-24","2019-11-25","2019-11-26","2019-11-27","2019-11-28","2019-11-29","2019-11-30","2019-12-01","2019-12-02","2019-12-03","2019-12-04","2019-12-05","2019-12-06","2019-12-07","2019-12-08","2019-12-09","2019-12-10","2019-12-11","2019-12-12","2019-12-13","2019-12-14","2019-12-15","2019-12-16","2019-12-17","2019-12-18","2019-12-19","2019-12-20","2019-12-21","2019-12-22","2019-12-23","2019-12-24","2019-12-25","2019-12-26","2019-12-27","2019-12-28","2019-12-29","2019-12-30","2019-12-31","2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27","2020-03-28","2020-03-29","2020-03-30","2020-03-31","2020-04-01","2020-04-02","2020-04-03","2020-04-04","2020-04-05","2020-04-06","2020-04-07","2020-04-08","2020-04-09","2020-04-10","2020-04-11","2020-04-12","2020-04-13","2020-04-14","2020-04-15","2020-04-16","2020-04-17","2020-04-18","2020-04-19","2020-04-20","2020-04-21","2020-04-22","2020-04-23","2020-04-24","2020-04-25","2020-04-26","2020-04-27","2020-04-28","2020-04-29","2020-04-30","2020-05-01","2020-05-02","2020-05-03","2020-05-04","2020-05-05","2020-05-06","2020-05-07","2020-05-08","2020-05-09","2020-05-10","2020-05-11","2020-05-12","2020-05-13","2020-05-14","2020-05-15","2020-05-16","2020-05-17","2020-05-18","2020-05-19","2020-05-20","2020-05-21","2020-05-22","2020-05-23","2020-05-24","2020-05-25","2020-05-26","2020-05-27","2020-05-28","2020-05-29","2020-05-30","2020-05-31","2020-06-01","2020-06-02","2020-06-03","2020-06-04","2020-06-05","2020-06-06","2020-06-07","2020-06-08","2020-06-09","2020-06-10","2020-06-11","2020-06-12","2020-06-13","2020-06-14","2020-06-15","2020-06-16","2020-06-17","2020-06-18","2020-06-19","2020-06-20","2020-06-21","2020-06-22","2020-06-23","2020-06-24","2020-06-25","2020-06-26","2020-06-27","2020-06-28","2020-06-29","2020-06-30","2020-07-01","2020-07-02","2020-07-03","2020-07-04","2020-07-05","2020-07-06","2020-07-07","2020-07-08","2020-07-09","2020-07-10","2020-07-11","2020-07-12","2020-07-13","2020-07-14","2020-07-15","2020-07-16","2020-07-17","2020-07-18","2020-07-19","2020-07-20","2020-07-21","2020-07-22","2020-07-23","2020-07-24","2020-07-25","2020-07-26","2020-07-27","2020-07-28","2020-07-29","2020-07-30","2020-07-31","2020-08-01","2020-08-02","2020-08-03","2020-08-04","2020-08-05","2020-08-06","2020-08-07","2020-08-08","2020-08-09","2020-08-10","2020-08-11","2020-08-12","2020-08-13","2020-08-14","2020-08-15","2020-08-16","2020-08-17","2020-08-18","2020-08-19","2020-08-20","2020-08-21","2020-08-22","2020-08-23","2020-08-24","2020-08-25","2020-08-26","2020-08-27","2020-08-28","2020-08-29","2020-08-30","2020-08-31","2020-09-01","2020-09-02","2020-09-03","2020-09-04","2020-09-05","2020-09-06","2020-09-07","2020-09-08","2020-09-09","2020-09-10","2020-09-11","2020-09-12","2020-09-13","2020-09-14","2020-09-15","2020-09-16","2020-09-17","2020-09-18","2020-09-19","2020-09-20","2020-09-21","2020-09-22","2020-09-23","2020-09-24","2020-09-25","2020-09-26","2020-09-27","2020-09-28","2020-09-29","2020-09-30","2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29","2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11","2020-12-12","2020-12-13","2020-12-14","2020-12-15","2020-12-16","2020-12-17","2020-12-18","2020-12-19","2020-12-20","2020-12-21","2020-12-22","2020-12-23","2020-12-24","2020-12-25","2020-12-26","2020-12-27","2020-12-28","2020-12-29","2020-12-30","2020-12-31"],"xaxis":"x","y":[700,537,510,417,484,492,477,464,400,358,369,355,410,453,470,394,362,360,398,430,475,455,363,416,410,398,418,456,535,431,403,407,423,447,492,520,401,412,422,400,432,410,508,413,433,410,409,449,541,505,420,473,429,450,429,490,498,429,432,413,424,474,484,534,427,443,459,423,448,516,486,443,463,419,418,486,540,462,455,433,423,439,451,523,539,459,453,412,440,459,536,540,467,452,437,452,491,513,533,456,488,479,411,489,521,587,502,484,524,498,598,578,601,498,478,477,406,479,540,492,408,412,456,498,539,603,610,483,467,417,444,459,498,517,446,430,384,395,456,459,546,395,424,396,391,456,538,585,469,435,467,431,454,441,461,408,418,428,446,451,497,539,419,419,392,383,401,450,497,355,385,373,382,342,474,420,354,392,366,366,374,471,447,344,349,374,324,360,469,440,352,361,363,349,352,389,415,345,333,362,356,347,399,406,378,356,380,360,354,427,436,323,313,325,310,330,338,397,347,328,344,324,333,371,367,322,318,307,359,343,356,355,331,309,296,299,344,348,363,306,318,290,292,310,365,342,303,301,318,299,309,332,377,306,326,295,300,323,335,384,318,315,293,311,319,354,350,276,277,281,289,301,346,350,311,305,292,296,315,384,417,296,295,288,294,314,356,343,310,293,286,272,306,324,339,294,312,302,275,317,314,388,312,327,328,321,355,424,453,355,340,341,347,328,332,376,342,344,303,333,338,368,402,323,342,336,313,358,382,405,342,322,340,330,370,415,434,349,347,368,364,358,407,430,372,355,383,339,367,396,452,353,371,382,346,409,393,480,402,447,479,577,735,746,748,610,516,436,421,482,529,532,461,406,412,436,476,448,480,398,434,388,426,437,489,516,434,455,421,429,441,515,543,402,423,442,454,463,532,521,439,439,472,446,476,493,548,440,411,451,445,439,591,559,437,457,470,446,503,572,567,475,491,486,462,492,519,580,480,495,426,499,501,525,575,487,447,496,490,503,537,518,453,477,478,452,540,598,549,490,501,471,457,537,629,626,539,527,563,604,623,629,645,560,522,464,454,537,582,544,462,469,429,487,543,581,620,509,459,468,500,486,557,590,484,489,502,524,572,637,696,483,488,495,477,466,595,602,501,534,518,506,527,596,556,470,509,493,550,569,572,605,497,452,449,492,442,549,536,446,437,429,449,463,481,503,445,416,440,461,437,472,478,450,413,405,437,440,494,486,417,404,386,421,403,470,483,423,394,387,369,413,417,472,402,387,424,399,388,439,475,362,414,389,377,425,468,426,367,403,382,373,376,442,432,370,332,352,356,368,417,411,362,340,324,388,407,401,396,370,357,374,364,384,415,427,340,378,326,389,374,370,384,339,322,303,324,355,388,402,320,330,355,314,307,396,377,315,333,343,308,350,385,398,337,315,295,343,349,402,403,322,322,328,310,277,348,377,301,319,320,323,324,372,434,330,360,301,334,354,378,410,323,319,312,322,336,354,402,314,309,314,301,341,409,351,334,313,309,336,355,330,404,313,339,345,364,351,397,395,338,332,315,332,406,357,405,319,350,356,299,324,385,391,339,330,355,361,367,392,434,378,338,357,363,416,397,455,341,390,372,368,380,415,468,362,374,361,404,413,453,468,349,381,453,528,659,832,877,689,546,537,426,468,558,547,470,416,433,396,427,499,491,378,413,398,420,418,513,460,420,404,437,407,451,514,540,449,462,454,418,478,506,509,431,428,469,413,495,495,578,442,484,421,517,464,541,533,416,458,441,470,487,498,569,423,495,466,512,486,529,501,461,482,480,473,476,562,580,438,430,432,468,453,578,553,483,484,512,456,474,533,523,466,450,517,509,511,575,573,475,495,459,463,528,533,541,490,477,487,491,509,515,509,411,480,508,467,474,530,547,532,539,561,560,554,653,622,471,457,500,489,560,565,633,508,545,471,473,496,554,516,457,453,501,447,455,505,515,446,447,420,451,442,512,554,427,447,409,433,449,530,481,499,465,489,430,451,505,506,401,403,423,475,456,514,508,447,394,398,399,436,443,518,408,415,409,406,393,431,479,371,405,392,369,409,471,442,387,343,350,391,371,407,440,349,354,365,335,383,373,439,355,367,363,334,405,437,447,320,357,366,344,341,406,397,329,344,360,329,334,404,393,316,348,369,324,331,368,350,332,317,317,315,320,355,361,296,312,286,320,325,342,361,297,327,320,299,336,350,370,318,297,295,301,350,337,377,316,319,302,282,303,344,350,296,290,294,312,326,375,380,291,295,309,302,322,364,396,358,363,368,350,303,364,353,301,309,320,292,337,338,400,306,300,309,287,326,358,341,322,297,315,273,317,336,373,295,322,332,326,350,363,400,291,330,336,342,300,353,446,304,321,328,336,347,362,418,320,356,355,352,373,399,402,343,361,334,331,352,408,403,338,339,397,370,360,422,457,360,361,344,349,375,371,412,328,336,407,421,563,576,889,616,588,478,508,445,471,491,423,425,413,408,426,469,470,371,414,383,418,404,483,487,368,392,394,448,429,435,484,407,414,387,434,452,497,468,409,413,435,430,426,469,536,426,421,451,392,459,484,415,424,475,457,425,479,495,504,437,398,424,456,468,494,432,405,405,386,378,428,413,440,399,382,365,402,395,434,512,394,427,420,399,409,485,453,371,377,363,399,421,473,486,394,454,333,327,323,405,369,319,301,311,303,332,358,411,377,356,423,392,417,419,435,332,322,342,313,321,380,401,306,315,290,318,400,434,487,366,417,414,379,401,412,444,408,343,360,376,359,417,418,338,334,368,348,342,436,502,364,386,380,394,362,417,380,371,379,425,404,438,431,508,341,358,369,367,354,405,422,334,348,371,380,342,367,450,350,349,361,360,342,381,421,341,357,347,334,398,397,412,363,368,354,333,385,370,411,349,358,306,346,353,362,389,327,318,314,323,331,360,394,306,325,315,313,318,354,401,298,308,309,296,294,362,337,311,311,299,311,304,338,332,305,317,320,288,282,338,338,291,288,289,263,293,294,330,307,280,287,261,297,340,333,279,262,257,279,316,324,376,283,264,278,261,289,311,357,263,289,275,263,294,324,317,259,267,281,272,279,333,329,288,282,307,323,303,353,362,310,272,292,278,304,343,352,276,328,279,296,296,367,349,263,293,291,290,278,361,359,315,274,302,318,347,315,394,292,302,305,292,338,377,355,308,293,306,279,309,329,361,308,332,338,307,337,370,444,361,291,319,336,338,402,368,333,304,344,345,355,365,401,349,315,324,327,370,391,443,337,349,374,352,400,451,562,638,636,666,620],"yaxis":"y","type":"scattergl"},{"hovertemplate":"=subset2<br>Date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"subset2","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"subset2","showlegend":true,"x":["2017-01-01","2017-01-02","2017-01-03","2017-01-04","2017-01-05","2017-01-06","2017-01-07","2017-01-08","2017-01-09","2017-01-10","2017-01-11","2017-01-12","2017-01-13","2017-01-14","2017-01-15","2017-01-16","2017-01-17","2017-01-18","2017-01-19","2017-01-20","2017-01-21","2017-01-22","2017-01-23","2017-01-24","2017-01-25","2017-01-26","2017-01-27","2017-01-28","2017-01-29","2017-01-30","2017-01-31","2017-02-01","2017-02-02","2017-02-03","2017-02-04","2017-02-05","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-11","2017-02-12","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-18","2017-02-19","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-25","2017-02-26","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-04","2017-03-05","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-11","2017-03-12","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-18","2017-03-19","2017-03-20","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-25","2017-03-26","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-01","2017-04-02","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-08","2017-04-09","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-15","2017-04-16","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-22","2017-04-23","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-04-29","2017-04-30","2017-05-01","2017-05-02","2017-05-03","2017-05-04","2017-05-05","2017-05-06","2017-05-07","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-13","2017-05-14","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-20","2017-05-21","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-27","2017-05-28","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-03","2017-06-04","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-10","2017-06-11","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-17","2017-06-18","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-24","2017-06-25","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-05","2017-08-06","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-11","2017-08-12","2017-08-13","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-19","2017-08-20","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-26","2017-08-27","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-02","2017-09-03","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-09","2017-09-10","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-16","2017-09-17","2017-09-18","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-23","2017-09-24","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-09-30","2017-10-01","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-07","2017-10-08","2017-10-09","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-14","2017-10-15","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-21","2017-10-22","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-28","2017-10-29","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-03","2017-11-04","2017-11-05","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-11","2017-11-12","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-18","2017-11-19","2017-11-20","2017-11-21","2017-11-22","2017-11-23","2017-11-24","2017-11-25","2017-11-26","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-02","2017-12-03","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-09","2017-12-10","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-16","2017-12-17","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-23","2017-12-24","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29","2017-12-30","2017-12-31","2018-01-01","2018-01-02","2018-01-03","2018-01-04","2018-01-05","2018-01-06","2018-01-07","2018-01-08","2018-01-09","2018-01-10","2018-01-11","2018-01-12","2018-01-13","2018-01-14","2018-01-15","2018-01-16","2018-01-17","2018-01-18","2018-01-19","2018-01-20","2018-01-21","2018-01-22","2018-01-23","2018-01-24","2018-01-25","2018-01-26","2018-01-27","2018-01-28","2018-01-29","2018-01-30","2018-01-31","2018-02-01","2018-02-02","2018-02-03","2018-02-04","2018-02-05","2018-02-06","2018-02-07","2018-02-08","2018-02-09","2018-02-10","2018-02-11","2018-02-12","2018-02-13","2018-02-14","2018-02-15","2018-02-16","2018-02-17","2018-02-18","2018-02-19","2018-02-20","2018-02-21","2018-02-22","2018-02-23","2018-02-24","2018-02-25","2018-02-26","2018-02-27","2018-02-28","2018-03-01","2018-03-02","2018-03-03","2018-03-04","2018-03-05","2018-03-06","2018-03-07","2018-03-08","2018-03-09","2018-03-10","2018-03-11","2018-03-12","2018-03-13","2018-03-14","2018-03-15","2018-03-16","2018-03-17","2018-03-18","2018-03-19","2018-03-20","2018-03-21","2018-03-22","2018-03-23","2018-03-24","2018-03-25","2018-03-26","2018-03-27","2018-03-28","2018-03-29","2018-03-30","2018-03-31","2018-04-01","2018-04-02","2018-04-03","2018-04-04","2018-04-05","2018-04-06","2018-04-07","2018-04-08","2018-04-09","2018-04-10","2018-04-11","2018-04-12","2018-04-13","2018-04-14","2018-04-15","2018-04-16","2018-04-17","2018-04-18","2018-04-19","2018-04-20","2018-04-21","2018-04-22","2018-04-23","2018-04-24","2018-04-25","2018-04-26","2018-04-27","2018-04-28","2018-04-29","2018-04-30","2018-05-01","2018-05-02","2018-05-03","2018-05-04","2018-05-05","2018-05-06","2018-05-07","2018-05-08","2018-05-09","2018-05-10","2018-05-11","2018-05-12","2018-05-13","2018-05-14","2018-05-15","2018-05-16","2018-05-17","2018-05-18","2018-05-19","2018-05-20","2018-05-21","2018-05-22","2018-05-23","2018-05-24","2018-05-25","2018-05-26","2018-05-27","2018-05-28","2018-05-29","2018-05-30","2018-05-31","2018-06-01","2018-06-02","2018-06-03","2018-06-04","2018-06-05","2018-06-06","2018-06-07","2018-06-08","2018-06-09","2018-06-10","2018-06-11","2018-06-12","2018-06-13","2018-06-14","2018-06-15","2018-06-16","2018-06-17","2018-06-18","2018-06-19","2018-06-20","2018-06-21","2018-06-22","2018-06-23","2018-06-24","2018-06-25","2018-06-26","2018-06-27","2018-06-28","2018-06-29","2018-06-30","2018-07-01","2018-07-02","2018-07-03","2018-07-04","2018-07-05","2018-07-06","2018-07-07","2018-07-08","2018-07-09","2018-07-10","2018-07-11","2018-07-12","2018-07-13","2018-07-14","2018-07-15","2018-07-16","2018-07-17","2018-07-18","2018-07-19","2018-07-20","2018-07-21","2018-07-22","2018-07-23","2018-07-24","2018-07-25","2018-07-26","2018-07-27","2018-07-28","2018-07-29","2018-07-30","2018-07-31","2018-08-01","2018-08-02","2018-08-03","2018-08-04","2018-08-05","2018-08-06","2018-08-07","2018-08-08","2018-08-09","2018-08-10","2018-08-11","2018-08-12","2018-08-13","2018-08-14","2018-08-15","2018-08-16","2018-08-17","2018-08-18","2018-08-19","2018-08-20","2018-08-21","2018-08-22","2018-08-23","2018-08-24","2018-08-25","2018-08-26","2018-08-27","2018-08-28","2018-08-29","2018-08-30","2018-08-31","2018-09-01","2018-09-02","2018-09-03","2018-09-04","2018-09-05","2018-09-06","2018-09-07","2018-09-08","2018-09-09","2018-09-10","2018-09-11","2018-09-12","2018-09-13","2018-09-14","2018-09-15","2018-09-16","2018-09-17","2018-09-18","2018-09-19","2018-09-20","2018-09-21","2018-09-22","2018-09-23","2018-09-24","2018-09-25","2018-09-26","2018-09-27","2018-09-28","2018-09-29","2018-09-30","2018-10-01","2018-10-02","2018-10-03","2018-10-04","2018-10-05","2018-10-06","2018-10-07","2018-10-08","2018-10-09","2018-10-10","2018-10-11","2018-10-12","2018-10-13","2018-10-14","2018-10-15","2018-10-16","2018-10-17","2018-10-18","2018-10-19","2018-10-20","2018-10-21","2018-10-22","2018-10-23","2018-10-24","2018-10-25","2018-10-26","2018-10-27","2018-10-28","2018-10-29","2018-10-30","2018-10-31","2018-11-01","2018-11-02","2018-11-03","2018-11-04","2018-11-05","2018-11-06","2018-11-07","2018-11-08","2018-11-09","2018-11-10","2018-11-11","2018-11-12","2018-11-13","2018-11-14","2018-11-15","2018-11-16","2018-11-17","2018-11-18","2018-11-19","2018-11-20","2018-11-21","2018-11-22","2018-11-23","2018-11-24","2018-11-25","2018-11-26","2018-11-27","2018-11-28","2018-11-29","2018-11-30","2018-12-01","2018-12-02","2018-12-03","2018-12-04","2018-12-05","2018-12-06","2018-12-07","2018-12-08","2018-12-09","2018-12-10","2018-12-11","2018-12-12","2018-12-13","2018-12-14","2018-12-15","2018-12-16","2018-12-17","2018-12-18","2018-12-19","2018-12-20","2018-12-21","2018-12-22","2018-12-23","2018-12-24","2018-12-25","2018-12-26","2018-12-27","2018-12-28","2018-12-29","2018-12-30","2018-12-31","2019-01-01","2019-01-02","2019-01-03","2019-01-04","2019-01-05","2019-01-06","2019-01-07","2019-01-08","2019-01-09","2019-01-10","2019-01-11","2019-01-12","2019-01-13","2019-01-14","2019-01-15","2019-01-16","2019-01-17","2019-01-18","2019-01-19","2019-01-20","2019-01-21","2019-01-22","2019-01-23","2019-01-24","2019-01-25","2019-01-26","2019-01-27","2019-01-28","2019-01-29","2019-01-30","2019-01-31","2019-02-01","2019-02-02","2019-02-03","2019-02-04","2019-02-05","2019-02-06","2019-02-07","2019-02-08","2019-02-09","2019-02-10","2019-02-11","2019-02-12","2019-02-13","2019-02-14","2019-02-15","2019-02-16","2019-02-17","2019-02-18","2019-02-19","2019-02-20","2019-02-21","2019-02-22","2019-02-23","2019-02-24","2019-02-25","2019-02-26","2019-02-27","2019-02-28","2019-03-01","2019-03-02","2019-03-03","2019-03-04","2019-03-05","2019-03-06","2019-03-07","2019-03-08","2019-03-09","2019-03-10","2019-03-11","2019-03-12","2019-03-13","2019-03-14","2019-03-15","2019-03-16","2019-03-17","2019-03-18","2019-03-19","2019-03-20","2019-03-21","2019-03-22","2019-03-23","2019-03-24","2019-03-25","2019-03-26","2019-03-27","2019-03-28","2019-03-29","2019-03-30","2019-03-31","2019-04-01","2019-04-02","2019-04-03","2019-04-04","2019-04-05","2019-04-06","2019-04-07","2019-04-08","2019-04-09","2019-04-10","2019-04-11","2019-04-12","2019-04-13","2019-04-14","2019-04-15","2019-04-16","2019-04-17","2019-04-18","2019-04-19","2019-04-20","2019-04-21","2019-04-22","2019-04-23","2019-04-24","2019-04-25","2019-04-26","2019-04-27","2019-04-28","2019-04-29","2019-04-30","2019-05-01","2019-05-02","2019-05-03","2019-05-04","2019-05-05","2019-05-06","2019-05-07","2019-05-08","2019-05-09","2019-05-10","2019-05-11","2019-05-12","2019-05-13","2019-05-14","2019-05-15","2019-05-16","2019-05-17","2019-05-18","2019-05-19","2019-05-20","2019-05-21","2019-05-22","2019-05-23","2019-05-24","2019-05-25","2019-05-26","2019-05-27","2019-05-28","2019-05-29","2019-05-30","2019-05-31","2019-06-01","2019-06-02","2019-06-03","2019-06-04","2019-06-05","2019-06-06","2019-06-07","2019-06-08","2019-06-09","2019-06-10","2019-06-11","2019-06-12","2019-06-13","2019-06-14","2019-06-15","2019-06-16","2019-06-17","2019-06-18","2019-06-19","2019-06-20","2019-06-21","2019-06-22","2019-06-23","2019-06-24","2019-06-25","2019-06-26","2019-06-27","2019-06-28","2019-06-29","2019-06-30","2019-07-01","2019-07-02","2019-07-03","2019-07-04","2019-07-05","2019-07-06","2019-07-07","2019-07-08","2019-07-09","2019-07-10","2019-07-11","2019-07-12","2019-07-13","2019-07-14","2019-07-15","2019-07-16","2019-07-17","2019-07-18","2019-07-19","2019-07-20","2019-07-21","2019-07-22","2019-07-23","2019-07-24","2019-07-25","2019-07-26","2019-07-27","2019-07-28","2019-07-29","2019-07-30","2019-07-31","2019-08-01","2019-08-02","2019-08-03","2019-08-04","2019-08-05","2019-08-06","2019-08-07","2019-08-08","2019-08-09","2019-08-10","2019-08-11","2019-08-12","2019-08-13","2019-08-14","2019-08-15","2019-08-16","2019-08-17","2019-08-18","2019-08-19","2019-08-20","2019-08-21","2019-08-22","2019-08-23","2019-08-24","2019-08-25","2019-08-26","2019-08-27","2019-08-28","2019-08-29","2019-08-30","2019-08-31","2019-09-01","2019-09-02","2019-09-03","2019-09-04","2019-09-05","2019-09-06","2019-09-07","2019-09-08","2019-09-09","2019-09-10","2019-09-11","2019-09-12","2019-09-13","2019-09-14","2019-09-15","2019-09-16","2019-09-17","2019-09-18","2019-09-19","2019-09-20","2019-09-21","2019-09-22","2019-09-23","2019-09-24","2019-09-25","2019-09-26","2019-09-27","2019-09-28","2019-09-29","2019-09-30","2019-10-01","2019-10-02","2019-10-03","2019-10-04","2019-10-05","2019-10-06","2019-10-07","2019-10-08","2019-10-09","2019-10-10","2019-10-11","2019-10-12","2019-10-13","2019-10-14","2019-10-15","2019-10-16","2019-10-17","2019-10-18","2019-10-19","2019-10-20","2019-10-21","2019-10-22","2019-10-23","2019-10-24","2019-10-25","2019-10-26","2019-10-27","2019-10-28","2019-10-29","2019-10-30","2019-10-31","2019-11-01","2019-11-02","2019-11-03","2019-11-04","2019-11-05","2019-11-06","2019-11-07","2019-11-08","2019-11-09","2019-11-10","2019-11-11","2019-11-12","2019-11-13","2019-11-14","2019-11-15","2019-11-16","2019-11-17","2019-11-18","2019-11-19","2019-11-20","2019-11-21","2019-11-22","2019-11-23","2019-11-24","2019-11-25","2019-11-26","2019-11-27","2019-11-28","2019-11-29","2019-11-30","2019-12-01","2019-12-02","2019-12-03","2019-12-04","2019-12-05","2019-12-06","2019-12-07","2019-12-08","2019-12-09","2019-12-10","2019-12-11","2019-12-12","2019-12-13","2019-12-14","2019-12-15","2019-12-16","2019-12-17","2019-12-18","2019-12-19","2019-12-20","2019-12-21","2019-12-22","2019-12-23","2019-12-24","2019-12-25","2019-12-26","2019-12-27","2019-12-28","2019-12-29","2019-12-30","2019-12-31","2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27","2020-03-28","2020-03-29","2020-03-30","2020-03-31","2020-04-01","2020-04-02","2020-04-03","2020-04-04","2020-04-05","2020-04-06","2020-04-07","2020-04-08","2020-04-09","2020-04-10","2020-04-11","2020-04-12","2020-04-13","2020-04-14","2020-04-15","2020-04-16","2020-04-17","2020-04-18","2020-04-19","2020-04-20","2020-04-21","2020-04-22","2020-04-23","2020-04-24","2020-04-25","2020-04-26","2020-04-27","2020-04-28","2020-04-29","2020-04-30","2020-05-01","2020-05-02","2020-05-03","2020-05-04","2020-05-05","2020-05-06","2020-05-07","2020-05-08","2020-05-09","2020-05-10","2020-05-11","2020-05-12","2020-05-13","2020-05-14","2020-05-15","2020-05-16","2020-05-17","2020-05-18","2020-05-19","2020-05-20","2020-05-21","2020-05-22","2020-05-23","2020-05-24","2020-05-25","2020-05-26","2020-05-27","2020-05-28","2020-05-29","2020-05-30","2020-05-31","2020-06-01","2020-06-02","2020-06-03","2020-06-04","2020-06-05","2020-06-06","2020-06-07","2020-06-08","2020-06-09","2020-06-10","2020-06-11","2020-06-12","2020-06-13","2020-06-14","2020-06-15","2020-06-16","2020-06-17","2020-06-18","2020-06-19","2020-06-20","2020-06-21","2020-06-22","2020-06-23","2020-06-24","2020-06-25","2020-06-26","2020-06-27","2020-06-28","2020-06-29","2020-06-30","2020-07-01","2020-07-02","2020-07-03","2020-07-04","2020-07-05","2020-07-06","2020-07-07","2020-07-08","2020-07-09","2020-07-10","2020-07-11","2020-07-12","2020-07-13","2020-07-14","2020-07-15","2020-07-16","2020-07-17","2020-07-18","2020-07-19","2020-07-20","2020-07-21","2020-07-22","2020-07-23","2020-07-24","2020-07-25","2020-07-26","2020-07-27","2020-07-28","2020-07-29","2020-07-30","2020-07-31","2020-08-01","2020-08-02","2020-08-03","2020-08-04","2020-08-05","2020-08-06","2020-08-07","2020-08-08","2020-08-09","2020-08-10","2020-08-11","2020-08-12","2020-08-13","2020-08-14","2020-08-15","2020-08-16","2020-08-17","2020-08-18","2020-08-19","2020-08-20","2020-08-21","2020-08-22","2020-08-23","2020-08-24","2020-08-25","2020-08-26","2020-08-27","2020-08-28","2020-08-29","2020-08-30","2020-08-31","2020-09-01","2020-09-02","2020-09-03","2020-09-04","2020-09-05","2020-09-06","2020-09-07","2020-09-08","2020-09-09","2020-09-10","2020-09-11","2020-09-12","2020-09-13","2020-09-14","2020-09-15","2020-09-16","2020-09-17","2020-09-18","2020-09-19","2020-09-20","2020-09-21","2020-09-22","2020-09-23","2020-09-24","2020-09-25","2020-09-26","2020-09-27","2020-09-28","2020-09-29","2020-09-30","2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29","2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11","2020-12-12","2020-12-13","2020-12-14","2020-12-15","2020-12-16","2020-12-17","2020-12-18","2020-12-19","2020-12-20","2020-12-21","2020-12-22","2020-12-23","2020-12-24","2020-12-25","2020-12-26","2020-12-27","2020-12-28","2020-12-29","2020-12-30","2020-12-31"],"xaxis":"x","y":[187,158,131,134,129,119,122,132,98,102,93,92,114,111,117,93,94,100,104,93,111,99,99,100,98,87,103,106,115,92,101,95,97,98,111,109,95,89,96,102,95,109,115,93,93,83,86,90,100,98,92,83,88,87,93,93,104,86,85,85,91,96,114,101,86,87,85,83,97,99,112,77,85,89,88,91,98,105,83,87,84,78,90,96,97,84,87,92,87,89,96,98,88,86,91,86,84,109,92,91,90,83,96,85,96,109,96,85,97,95,98,117,121,85,88,86,92,94,94,98,84,96,93,96,96,110,123,94,94,91,91,87,96,106,88,94,80,96,94,109,117,97,87,94,91,97,108,114,108,102,103,88,108,106,108,93,101,98,116,104,120,130,98,97,100,100,103,111,120,99,106,109,95,104,108,127,104,99,95,101,110,111,125,100,103,105,110,113,121,121,111,103,113,108,113,118,127,109,108,118,108,117,136,138,115,114,126,121,118,135,137,114,108,106,102,111,123,131,117,114,115,113,113,147,138,109,111,132,130,138,152,142,129,130,119,114,119,136,143,121,115,125,116,129,145,139,130,125,122,116,128,129,128,120,117,112,119,124,131,134,111,122,119,109,117,139,145,129,123,116,123,134,122,139,111,116,125,115,127,139,141,113,120,108,106,136,141,141,120,119,117,118,129,123,147,106,125,114,112,119,135,159,119,119,117,123,118,146,168,134,126,130,120,120,139,132,125,136,129,138,123,135,144,114,116,117,123,123,140,129,118,116,111,111,127,142,153,109,112,117,107,123,127,136,113,104,108,117,128,133,131,103,104,111,108,126,124,126,104,119,142,179,200,232,202,162,135,126,129,134,146,138,116,109,109,110,116,121,135,107,105,109,98,104,123,127,114,114,105,106,97,125,122,103,108,102,104,111,110,120,105,106,92,94,104,100,124,94,101,104,100,107,115,120,96,94,96,106,108,123,111,100,93,98,89,93,108,108,107,100,101,96,101,104,108,101,100,87,89,100,109,121,93,99,96,88,90,104,113,92,102,95,94,97,100,116,95,94,101,95,106,136,125,92,99,89,92,92,109,110,104,97,95,94,94,113,100,92,93,99,96,103,118,106,102,90,106,110,118,140,127,104,109,87,101,102,132,134,115,116,108,104,113,118,119,102,102,102,105,107,134,137,106,107,105,105,104,124,126,110,113,108,100,106,122,134,106,104,110,103,118,124,121,100,105,106,113,108,127,132,104,112,108,111,120,124,121,103,106,120,114,116,124,140,119,112,114,110,105,134,132,115,117,116,129,120,145,148,117,131,132,128,125,143,143,121,114,129,113,118,135,146,120,134,109,128,141,140,146,124,126,116,133,135,148,171,146,125,127,128,145,149,144,110,128,131,124,150,139,158,130,127,126,133,135,140,151,128,128,122,122,140,144,153,135,132,135,125,124,145,155,126,130,122,136,134,135,161,123,134,118,123,128,147,150,131,139,129,123,135,153,145,131,122,133,136,136,154,142,126,130,135,132,128,132,152,123,133,125,126,126,154,168,130,128,129,136,144,142,141,131,130,126,128,132,168,161,116,121,106,117,126,147,131,127,126,121,126,132,145,135,112,116,117,116,118,132,137,111,115,116,116,118,130,140,108,115,113,106,121,139,131,117,130,142,151,197,228,252,160,150,135,111,123,157,152,124,116,107,104,116,123,122,105,104,108,106,99,121,130,114,100,104,107,112,125,128,97,103,100,90,96,114,120,101,93,101,100,108,105,115,113,92,102,98,103,111,112,87,85,102,94,100,118,114,102,93,97,94,108,112,115,93,84,92,93,102,110,119,88,95,97,90,100,110,114,93,95,91,92,94,103,107,95,95,88,89,101,109,108,86,85,90,87,93,114,115,89,83,92,86,91,102,110,87,88,90,90,97,93,122,92,98,90,103,104,109,133,102,98,102,96,109,111,118,107,104,97,96,102,114,123,93,102,99,94,98,100,120,99,92,98,100,105,110,111,98,92,96,100,113,119,120,111,115,120,109,112,124,116,95,99,112,118,113,135,135,109,105,108,103,106,116,130,106,97,96,111,106,125,136,110,110,105,98,114,136,128,106,101,106,105,109,127,142,111,109,111,114,120,124,135,112,112,124,131,150,139,143,112,109,112,124,116,132,135,113,114,118,118,131,124,133,123,121,103,124,127,135,164,141,132,130,118,132,142,152,116,113,119,124,123,143,158,133,125,122,127,130,132,149,120,125,120,127,127,146,161,124,124,127,121,129,143,148,131,115,127,123,127,142,144,129,125,136,114,144,138,144,119,125,125,120,134,136,154,121,123,120,120,133,139,151,110,117,125,128,114,143,158,126,120,123,117,127,148,154,130,140,130,121,117,128,140,104,122,119,142,149,157,140,123,122,106,121,120,124,140,117,111,112,110,119,132,124,117,102,116,116,124,132,133,105,106,111,109,108,116,130,105,105,107,105,105,126,128,105,108,110,120,138,196,234,179,178,147,130,127,133,131,118,113,111,117,110,120,120,100,95,99,97,102,113,113,89,97,96,95,103,114,123,92,98,98,101,105,106,105,93,96,94,95,97,116,128,92,90,88,91,93,105,110,92,92,90,85,84,103,116,95,97,90,88,90,103,97,83,78,74,82,85,95,90,74,77,80,84,89,92,92,74,77,80,75,80,88,100,70,74,81,73,87,84,87,77,80,62,68,66,73,73,62,70,65,63,64,71,77,67,67,68,72,76,84,84,71,66,61,68,64,77,76,60,60,68,65,71,91,95,89,82,87,77,86,85,82,71,66,76,70,81,82,88,72,78,75,77,87,96,103,76,86,80,75,83,93,88,87,89,87,98,105,109,119,92,88,85,83,91,91,99,91,95,90,96,96,105,110,85,86,81,85,94,112,105,81,95,97,92,110,113,124,99,96,98,94,107,113,114,101,103,98,101,104,115,131,96,103,101,112,122,136,145,109,116,108,114,110,128,122,100,108,106,108,112,123,126,103,103,109,109,108,130,133,114,105,121,118,138,129,127,116,118,108,107,109,125,126,120,117,113,119,106,120,128,111,105,118,115,126,131,130,118,109,108,104,128,127,132,111,113,103,108,113,130,145,96,108,106,123,123,138,144,116,115,109,117,118,130,137,118,111,111,116,122,132,135,114,113,113,110,129,139,136,114,118,110,111,125,136,133,119,114,114,126,135,143,149,106,115,112,121,127,140,155,118,129,138,115,113,126,133,116,113,107,104,121,129,129,103,99,110,97,108,117,131,102,109,98,107,119,118,133,105,110,99,104,110,126,135,106,104,107,94,115,142,160,168,192,183,164],"yaxis":"y","type":"scattergl"},{"hovertemplate":"=subset3<br>Date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"subset3","line":{"color":"#00cc96","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"subset3","showlegend":true,"x":["2017-01-01","2017-01-02","2017-01-03","2017-01-04","2017-01-05","2017-01-06","2017-01-07","2017-01-08","2017-01-09","2017-01-10","2017-01-11","2017-01-12","2017-01-13","2017-01-14","2017-01-15","2017-01-16","2017-01-17","2017-01-18","2017-01-19","2017-01-20","2017-01-21","2017-01-22","2017-01-23","2017-01-24","2017-01-25","2017-01-26","2017-01-27","2017-01-28","2017-01-29","2017-01-30","2017-01-31","2017-02-01","2017-02-02","2017-02-03","2017-02-04","2017-02-05","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-11","2017-02-12","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-18","2017-02-19","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-25","2017-02-26","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-04","2017-03-05","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-11","2017-03-12","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-18","2017-03-19","2017-03-20","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-25","2017-03-26","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-01","2017-04-02","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-08","2017-04-09","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-15","2017-04-16","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-22","2017-04-23","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-04-29","2017-04-30","2017-05-01","2017-05-02","2017-05-03","2017-05-04","2017-05-05","2017-05-06","2017-05-07","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-13","2017-05-14","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-20","2017-05-21","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-27","2017-05-28","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-03","2017-06-04","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-10","2017-06-11","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-17","2017-06-18","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-24","2017-06-25","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-05","2017-08-06","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-11","2017-08-12","2017-08-13","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-19","2017-08-20","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-26","2017-08-27","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-02","2017-09-03","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-09","2017-09-10","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-16","2017-09-17","2017-09-18","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-23","2017-09-24","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-09-30","2017-10-01","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-07","2017-10-08","2017-10-09","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-14","2017-10-15","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-21","2017-10-22","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-28","2017-10-29","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-03","2017-11-04","2017-11-05","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-11","2017-11-12","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-18","2017-11-19","2017-11-20","2017-11-21","2017-11-22","2017-11-23","2017-11-24","2017-11-25","2017-11-26","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-02","2017-12-03","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-09","2017-12-10","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-16","2017-12-17","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-23","2017-12-24","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29","2017-12-30","2017-12-31","2018-01-01","2018-01-02","2018-01-03","2018-01-04","2018-01-05","2018-01-06","2018-01-07","2018-01-08","2018-01-09","2018-01-10","2018-01-11","2018-01-12","2018-01-13","2018-01-14","2018-01-15","2018-01-16","2018-01-17","2018-01-18","2018-01-19","2018-01-20","2018-01-21","2018-01-22","2018-01-23","2018-01-24","2018-01-25","2018-01-26","2018-01-27","2018-01-28","2018-01-29","2018-01-30","2018-01-31","2018-02-01","2018-02-02","2018-02-03","2018-02-04","2018-02-05","2018-02-06","2018-02-07","2018-02-08","2018-02-09","2018-02-10","2018-02-11","2018-02-12","2018-02-13","2018-02-14","2018-02-15","2018-02-16","2018-02-17","2018-02-18","2018-02-19","2018-02-20","2018-02-21","2018-02-22","2018-02-23","2018-02-24","2018-02-25","2018-02-26","2018-02-27","2018-02-28","2018-03-01","2018-03-02","2018-03-03","2018-03-04","2018-03-05","2018-03-06","2018-03-07","2018-03-08","2018-03-09","2018-03-10","2018-03-11","2018-03-12","2018-03-13","2018-03-14","2018-03-15","2018-03-16","2018-03-17","2018-03-18","2018-03-19","2018-03-20","2018-03-21","2018-03-22","2018-03-23","2018-03-24","2018-03-25","2018-03-26","2018-03-27","2018-03-28","2018-03-29","2018-03-30","2018-03-31","2018-04-01","2018-04-02","2018-04-03","2018-04-04","2018-04-05","2018-04-06","2018-04-07","2018-04-08","2018-04-09","2018-04-10","2018-04-11","2018-04-12","2018-04-13","2018-04-14","2018-04-15","2018-04-16","2018-04-17","2018-04-18","2018-04-19","2018-04-20","2018-04-21","2018-04-22","2018-04-23","2018-04-24","2018-04-25","2018-04-26","2018-04-27","2018-04-28","2018-04-29","2018-04-30","2018-05-01","2018-05-02","2018-05-03","2018-05-04","2018-05-05","2018-05-06","2018-05-07","2018-05-08","2018-05-09","2018-05-10","2018-05-11","2018-05-12","2018-05-13","2018-05-14","2018-05-15","2018-05-16","2018-05-17","2018-05-18","2018-05-19","2018-05-20","2018-05-21","2018-05-22","2018-05-23","2018-05-24","2018-05-25","2018-05-26","2018-05-27","2018-05-28","2018-05-29","2018-05-30","2018-05-31","2018-06-01","2018-06-02","2018-06-03","2018-06-04","2018-06-05","2018-06-06","2018-06-07","2018-06-08","2018-06-09","2018-06-10","2018-06-11","2018-06-12","2018-06-13","2018-06-14","2018-06-15","2018-06-16","2018-06-17","2018-06-18","2018-06-19","2018-06-20","2018-06-21","2018-06-22","2018-06-23","2018-06-24","2018-06-25","2018-06-26","2018-06-27","2018-06-28","2018-06-29","2018-06-30","2018-07-01","2018-07-02","2018-07-03","2018-07-04","2018-07-05","2018-07-06","2018-07-07","2018-07-08","2018-07-09","2018-07-10","2018-07-11","2018-07-12","2018-07-13","2018-07-14","2018-07-15","2018-07-16","2018-07-17","2018-07-18","2018-07-19","2018-07-20","2018-07-21","2018-07-22","2018-07-23","2018-07-24","2018-07-25","2018-07-26","2018-07-27","2018-07-28","2018-07-29","2018-07-30","2018-07-31","2018-08-01","2018-08-02","2018-08-03","2018-08-04","2018-08-05","2018-08-06","2018-08-07","2018-08-08","2018-08-09","2018-08-10","2018-08-11","2018-08-12","2018-08-13","2018-08-14","2018-08-15","2018-08-16","2018-08-17","2018-08-18","2018-08-19","2018-08-20","2018-08-21","2018-08-22","2018-08-23","2018-08-24","2018-08-25","2018-08-26","2018-08-27","2018-08-28","2018-08-29","2018-08-30","2018-08-31","2018-09-01","2018-09-02","2018-09-03","2018-09-04","2018-09-05","2018-09-06","2018-09-07","2018-09-08","2018-09-09","2018-09-10","2018-09-11","2018-09-12","2018-09-13","2018-09-14","2018-09-15","2018-09-16","2018-09-17","2018-09-18","2018-09-19","2018-09-20","2018-09-21","2018-09-22","2018-09-23","2018-09-24","2018-09-25","2018-09-26","2018-09-27","2018-09-28","2018-09-29","2018-09-30","2018-10-01","2018-10-02","2018-10-03","2018-10-04","2018-10-05","2018-10-06","2018-10-07","2018-10-08","2018-10-09","2018-10-10","2018-10-11","2018-10-12","2018-10-13","2018-10-14","2018-10-15","2018-10-16","2018-10-17","2018-10-18","2018-10-19","2018-10-20","2018-10-21","2018-10-22","2018-10-23","2018-10-24","2018-10-25","2018-10-26","2018-10-27","2018-10-28","2018-10-29","2018-10-30","2018-10-31","2018-11-01","2018-11-02","2018-11-03","2018-11-04","2018-11-05","2018-11-06","2018-11-07","2018-11-08","2018-11-09","2018-11-10","2018-11-11","2018-11-12","2018-11-13","2018-11-14","2018-11-15","2018-11-16","2018-11-17","2018-11-18","2018-11-19","2018-11-20","2018-11-21","2018-11-22","2018-11-23","2018-11-24","2018-11-25","2018-11-26","2018-11-27","2018-11-28","2018-11-29","2018-11-30","2018-12-01","2018-12-02","2018-12-03","2018-12-04","2018-12-05","2018-12-06","2018-12-07","2018-12-08","2018-12-09","2018-12-10","2018-12-11","2018-12-12","2018-12-13","2018-12-14","2018-12-15","2018-12-16","2018-12-17","2018-12-18","2018-12-19","2018-12-20","2018-12-21","2018-12-22","2018-12-23","2018-12-24","2018-12-25","2018-12-26","2018-12-27","2018-12-28","2018-12-29","2018-12-30","2018-12-31","2019-01-01","2019-01-02","2019-01-03","2019-01-04","2019-01-05","2019-01-06","2019-01-07","2019-01-08","2019-01-09","2019-01-10","2019-01-11","2019-01-12","2019-01-13","2019-01-14","2019-01-15","2019-01-16","2019-01-17","2019-01-18","2019-01-19","2019-01-20","2019-01-21","2019-01-22","2019-01-23","2019-01-24","2019-01-25","2019-01-26","2019-01-27","2019-01-28","2019-01-29","2019-01-30","2019-01-31","2019-02-01","2019-02-02","2019-02-03","2019-02-04","2019-02-05","2019-02-06","2019-02-07","2019-02-08","2019-02-09","2019-02-10","2019-02-11","2019-02-12","2019-02-13","2019-02-14","2019-02-15","2019-02-16","2019-02-17","2019-02-18","2019-02-19","2019-02-20","2019-02-21","2019-02-22","2019-02-23","2019-02-24","2019-02-25","2019-02-26","2019-02-27","2019-02-28","2019-03-01","2019-03-02","2019-03-03","2019-03-04","2019-03-05","2019-03-06","2019-03-07","2019-03-08","2019-03-09","2019-03-10","2019-03-11","2019-03-12","2019-03-13","2019-03-14","2019-03-15","2019-03-16","2019-03-17","2019-03-18","2019-03-19","2019-03-20","2019-03-21","2019-03-22","2019-03-23","2019-03-24","2019-03-25","2019-03-26","2019-03-27","2019-03-28","2019-03-29","2019-03-30","2019-03-31","2019-04-01","2019-04-02","2019-04-03","2019-04-04","2019-04-05","2019-04-06","2019-04-07","2019-04-08","2019-04-09","2019-04-10","2019-04-11","2019-04-12","2019-04-13","2019-04-14","2019-04-15","2019-04-16","2019-04-17","2019-04-18","2019-04-19","2019-04-20","2019-04-21","2019-04-22","2019-04-23","2019-04-24","2019-04-25","2019-04-26","2019-04-27","2019-04-28","2019-04-29","2019-04-30","2019-05-01","2019-05-02","2019-05-03","2019-05-04","2019-05-05","2019-05-06","2019-05-07","2019-05-08","2019-05-09","2019-05-10","2019-05-11","2019-05-12","2019-05-13","2019-05-14","2019-05-15","2019-05-16","2019-05-17","2019-05-18","2019-05-19","2019-05-20","2019-05-21","2019-05-22","2019-05-23","2019-05-24","2019-05-25","2019-05-26","2019-05-27","2019-05-28","2019-05-29","2019-05-30","2019-05-31","2019-06-01","2019-06-02","2019-06-03","2019-06-04","2019-06-05","2019-06-06","2019-06-07","2019-06-08","2019-06-09","2019-06-10","2019-06-11","2019-06-12","2019-06-13","2019-06-14","2019-06-15","2019-06-16","2019-06-17","2019-06-18","2019-06-19","2019-06-20","2019-06-21","2019-06-22","2019-06-23","2019-06-24","2019-06-25","2019-06-26","2019-06-27","2019-06-28","2019-06-29","2019-06-30","2019-07-01","2019-07-02","2019-07-03","2019-07-04","2019-07-05","2019-07-06","2019-07-07","2019-07-08","2019-07-09","2019-07-10","2019-07-11","2019-07-12","2019-07-13","2019-07-14","2019-07-15","2019-07-16","2019-07-17","2019-07-18","2019-07-19","2019-07-20","2019-07-21","2019-07-22","2019-07-23","2019-07-24","2019-07-25","2019-07-26","2019-07-27","2019-07-28","2019-07-29","2019-07-30","2019-07-31","2019-08-01","2019-08-02","2019-08-03","2019-08-04","2019-08-05","2019-08-06","2019-08-07","2019-08-08","2019-08-09","2019-08-10","2019-08-11","2019-08-12","2019-08-13","2019-08-14","2019-08-15","2019-08-16","2019-08-17","2019-08-18","2019-08-19","2019-08-20","2019-08-21","2019-08-22","2019-08-23","2019-08-24","2019-08-25","2019-08-26","2019-08-27","2019-08-28","2019-08-29","2019-08-30","2019-08-31","2019-09-01","2019-09-02","2019-09-03","2019-09-04","2019-09-05","2019-09-06","2019-09-07","2019-09-08","2019-09-09","2019-09-10","2019-09-11","2019-09-12","2019-09-13","2019-09-14","2019-09-15","2019-09-16","2019-09-17","2019-09-18","2019-09-19","2019-09-20","2019-09-21","2019-09-22","2019-09-23","2019-09-24","2019-09-25","2019-09-26","2019-09-27","2019-09-28","2019-09-29","2019-09-30","2019-10-01","2019-10-02","2019-10-03","2019-10-04","2019-10-05","2019-10-06","2019-10-07","2019-10-08","2019-10-09","2019-10-10","2019-10-11","2019-10-12","2019-10-13","2019-10-14","2019-10-15","2019-10-16","2019-10-17","2019-10-18","2019-10-19","2019-10-20","2019-10-21","2019-10-22","2019-10-23","2019-10-24","2019-10-25","2019-10-26","2019-10-27","2019-10-28","2019-10-29","2019-10-30","2019-10-31","2019-11-01","2019-11-02","2019-11-03","2019-11-04","2019-11-05","2019-11-06","2019-11-07","2019-11-08","2019-11-09","2019-11-10","2019-11-11","2019-11-12","2019-11-13","2019-11-14","2019-11-15","2019-11-16","2019-11-17","2019-11-18","2019-11-19","2019-11-20","2019-11-21","2019-11-22","2019-11-23","2019-11-24","2019-11-25","2019-11-26","2019-11-27","2019-11-28","2019-11-29","2019-11-30","2019-12-01","2019-12-02","2019-12-03","2019-12-04","2019-12-05","2019-12-06","2019-12-07","2019-12-08","2019-12-09","2019-12-10","2019-12-11","2019-12-12","2019-12-13","2019-12-14","2019-12-15","2019-12-16","2019-12-17","2019-12-18","2019-12-19","2019-12-20","2019-12-21","2019-12-22","2019-12-23","2019-12-24","2019-12-25","2019-12-26","2019-12-27","2019-12-28","2019-12-29","2019-12-30","2019-12-31","2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27","2020-03-28","2020-03-29","2020-03-30","2020-03-31","2020-04-01","2020-04-02","2020-04-03","2020-04-04","2020-04-05","2020-04-06","2020-04-07","2020-04-08","2020-04-09","2020-04-10","2020-04-11","2020-04-12","2020-04-13","2020-04-14","2020-04-15","2020-04-16","2020-04-17","2020-04-18","2020-04-19","2020-04-20","2020-04-21","2020-04-22","2020-04-23","2020-04-24","2020-04-25","2020-04-26","2020-04-27","2020-04-28","2020-04-29","2020-04-30","2020-05-01","2020-05-02","2020-05-03","2020-05-04","2020-05-05","2020-05-06","2020-05-07","2020-05-08","2020-05-09","2020-05-10","2020-05-11","2020-05-12","2020-05-13","2020-05-14","2020-05-15","2020-05-16","2020-05-17","2020-05-18","2020-05-19","2020-05-20","2020-05-21","2020-05-22","2020-05-23","2020-05-24","2020-05-25","2020-05-26","2020-05-27","2020-05-28","2020-05-29","2020-05-30","2020-05-31","2020-06-01","2020-06-02","2020-06-03","2020-06-04","2020-06-05","2020-06-06","2020-06-07","2020-06-08","2020-06-09","2020-06-10","2020-06-11","2020-06-12","2020-06-13","2020-06-14","2020-06-15","2020-06-16","2020-06-17","2020-06-18","2020-06-19","2020-06-20","2020-06-21","2020-06-22","2020-06-23","2020-06-24","2020-06-25","2020-06-26","2020-06-27","2020-06-28","2020-06-29","2020-06-30","2020-07-01","2020-07-02","2020-07-03","2020-07-04","2020-07-05","2020-07-06","2020-07-07","2020-07-08","2020-07-09","2020-07-10","2020-07-11","2020-07-12","2020-07-13","2020-07-14","2020-07-15","2020-07-16","2020-07-17","2020-07-18","2020-07-19","2020-07-20","2020-07-21","2020-07-22","2020-07-23","2020-07-24","2020-07-25","2020-07-26","2020-07-27","2020-07-28","2020-07-29","2020-07-30","2020-07-31","2020-08-01","2020-08-02","2020-08-03","2020-08-04","2020-08-05","2020-08-06","2020-08-07","2020-08-08","2020-08-09","2020-08-10","2020-08-11","2020-08-12","2020-08-13","2020-08-14","2020-08-15","2020-08-16","2020-08-17","2020-08-18","2020-08-19","2020-08-20","2020-08-21","2020-08-22","2020-08-23","2020-08-24","2020-08-25","2020-08-26","2020-08-27","2020-08-28","2020-08-29","2020-08-30","2020-08-31","2020-09-01","2020-09-02","2020-09-03","2020-09-04","2020-09-05","2020-09-06","2020-09-07","2020-09-08","2020-09-09","2020-09-10","2020-09-11","2020-09-12","2020-09-13","2020-09-14","2020-09-15","2020-09-16","2020-09-17","2020-09-18","2020-09-19","2020-09-20","2020-09-21","2020-09-22","2020-09-23","2020-09-24","2020-09-25","2020-09-26","2020-09-27","2020-09-28","2020-09-29","2020-09-30","2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29","2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11","2020-12-12","2020-12-13","2020-12-14","2020-12-15","2020-12-16","2020-12-17","2020-12-18","2020-12-19","2020-12-20","2020-12-21","2020-12-22","2020-12-23","2020-12-24","2020-12-25","2020-12-26","2020-12-27","2020-12-28","2020-12-29","2020-12-30","2020-12-31"],"xaxis":"x","y":[407,286,252,281,259,274,279,281,213,204,181,208,214,270,266,210,220,208,189,223,241,222,219,200,215,210,224,244,251,204,184,192,228,208,242,257,185,200,218,206,224,229,232,193,214,211,208,203,238,239,202,214,209,213,230,234,249,194,211,199,187,213,215,250,210,184,215,201,226,202,230,194,199,193,204,215,215,224,198,157,178,192,209,247,242,192,178,189,198,195,221,216,182,187,194,194,198,221,230,188,205,192,189,187,213,218,187,187,201,222,207,223,264,209,198,194,200,180,226,218,183,197,201,185,217,242,225,184,195,218,200,210,225,217,196,178,171,167,170,208,213,181,180,183,169,185,200,232,195,209,183,182,187,189,201,174,154,173,191,197,204,219,199,179,167,165,191,185,193,158,166,174,168,172,186,205,171,191,159,167,173,201,191,176,177,182,166,176,211,211,174,173,171,165,184,199,233,181,193,190,196,199,202,203,166,158,173,182,186,191,205,169,167,177,176,194,189,195,194,184,185,166,174,191,220,174,178,183,182,211,223,243,206,184,185,196,200,203,230,172,189,183,157,182,199,211,176,169,194,194,171,205,227,188,173,201,185,188,217,219,200,194,189,198,194,232,223,179,179,206,191,210,227,249,203,193,190,198,215,226,238,185,208,191,205,231,225,247,174,196,177,218,190,228,236,213,200,205,192,223,221,268,198,189,212,223,234,253,305,244,225,212,211,231,254,251,226,235,235,287,256,259,268,212,230,219,213,240,229,254,205,223,229,215,216,239,266,207,233,231,209,230,247,257,214,215,223,229,216,271,274,227,233,234,231,233,249,266,249,254,298,384,426,473,479,336,273,273,249,282,319,321,264,229,234,225,258,240,288,246,216,226,223,248,282,276,209,241,226,234,263,249,282,249,254,218,211,230,257,297,232,245,227,225,241,268,282,246,230,228,239,231,250,272,220,226,228,218,242,216,263,233,204,217,233,220,269,269,225,231,223,192,247,257,240,225,217,227,222,246,240,273,226,226,241,212,236,270,265,224,214,229,206,207,238,239,191,226,216,247,266,269,272,211,235,207,212,211,236,229,212,185,194,202,215,240,221,212,195,205,197,197,227,243,203,201,200,224,233,239,240,212,232,198,202,219,259,295,236,247,219,214,209,210,225,179,206,216,209,227,241,285,208,184,184,190,195,226,237,191,192,174,193,208,204,227,182,185,179,178,197,217,235,191,185,193,191,201,210,219,201,198,177,180,196,213,233,179,184,184,181,179,207,226,182,184,179,195,181,232,227,209,198,212,209,222,243,242,172,180,190,169,205,209,231,184,198,183,194,195,197,239,203,204,173,192,190,225,231,176,192,199,210,212,254,260,231,220,205,187,208,226,230,198,193,189,188,205,244,225,200,216,188,181,232,222,237,210,214,205,175,204,258,255,213,202,207,208,224,228,266,196,217,201,226,206,239,231,218,209,222,196,212,237,258,198,208,195,200,213,243,281,222,189,218,219,210,250,275,214,217,223,203,229,264,252,215,237,231,219,245,256,301,270,235,238,238,232,256,275,225,224,249,263,275,283,294,211,241,219,224,237,253,257,214,217,232,225,237,266,266,223,252,247,229,246,273,294,242,224,221,226,252,247,299,227,226,211,236,235,256,294,230,251,262,316,360,472,456,392,298,268,226,256,269,306,235,217,226,240,234,265,295,237,236,230,230,236,249,294,222,226,245,214,221,249,264,211,215,213,202,228,251,268,216,218,228,241,229,268,255,218,229,220,230,221,258,239,213,209,229,226,227,274,266,217,206,226,219,229,259,267,206,206,208,201,227,236,246,199,221,217,192,205,250,258,223,239,198,201,217,246,242,205,211,205,218,210,239,250,184,196,187,200,231,214,253,210,208,208,200,205,211,244,191,188,206,192,202,213,251,203,211,184,215,208,232,263,217,186,189,205,210,246,267,224,204,209,195,206,255,258,209,182,205,185,193,214,234,185,176,190,183,200,225,212,178,180,171,178,191,220,214,198,206,211,193,184,208,207,189,180,189,184,195,231,248,177,191,177,177,199,213,218,175,192,162,168,199,206,217,175,168,174,165,205,172,211,158,171,176,175,186,199,204,182,187,209,192,218,223,229,185,174,183,193,189,204,212,179,180,176,177,175,208,216,177,192,181,166,194,219,202,156,186,181,179,200,230,262,218,201,198,198,196,228,222,179,190,180,174,197,229,223,184,184,184,204,193,201,231,193,191,177,199,198,239,202,200,201,201,199,221,222,239,189,196,193,184,211,210,225,201,208,206,206,211,227,255,191,222,204,181,212,246,254,201,194,206,212,211,243,241,199,213,209,196,236,241,271,215,212,217,215,237,229,269,227,259,241,217,231,272,274,231,217,214,240,262,291,301,216,237,213,212,240,251,260,212,209,211,226,252,245,258,228,205,208,224,235,238,269,230,223,239,211,238,258,264,211,228,211,207,221,255,266,216,206,236,236,325,401,450,383,363,307,307,283,306,332,272,286,244,269,268,293,310,247,253,255,262,246,285,305,253,255,237,250,254,279,289,260,212,234,238,246,292,283,238,225,261,245,267,305,301,239,234,263,237,251,304,312,235,231,232,251,253,248,273,265,224,226,242,233,266,221,204,197,221,204,224,244,243,228,217,216,205,239,243,242,207,193,202,177,211,217,242,216,209,201,200,217,217,241,185,189,170,179,171,188,191,153,142,160,152,176,181,187,157,154,175,168,183,211,203,160,150,151,151,172,174,195,149,147,155,157,180,199,228,192,189,198,175,185,215,214,194,177,170,196,192,191,219,177,167,163,179,170,189,199,187,189,177,161,190,183,193,187,184,187,192,199,208,220,184,168,187,175,193,205,198,175,171,180,202,191,217,208,199,175,179,180,177,210,200,173,188,162,183,194,212,218,196,166,174,190,214,220,206,185,192,179,181,218,240,249,213,180,194,201,213,215,218,194,179,192,168,205,227,239,182,189,186,189,202,202,242,196,181,198,193,196,230,243,203,215,230,220,228,234,247,201,185,209,202,207,211,219,198,194,194,191,221,246,241,210,192,191,209,211,232,234,192,211,194,202,223,240,246,202,210,195,212,219,242,261,202,209,212,214,237,252,269,215,208,214,218,215,247,286,223,237,216,217,250,255,276,248,221,246,224,234,243,284,220,223,245,246,217,249,277,224,253,256,261,282,290,304,250,246,215,245,266,304,322,257,265,240,238,257,263,272,257,236,232,218,254,279,297,243,237,230,242,268,277,264,235,240,230,239,273,283,284,220,261,241,228,226,277,291,239,248,242,262,273,316,388,380,447,445,394],"yaxis":"y","type":"scattergl"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"Sales Data For Different Subsets"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('bbef70f4-a7fa-451d-abb3-9ff8122a07e0');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Looking at the plot, especially in the <code>Subset1</code>, there is a yearly seasonality in the sales. Also there is a sharp rise in the sales around New Year’s Eve.</p>
<p>Before modelling, we have to check whether any extra data transformation is needed. Since the data has 48 subsets like the 3 subsets above, it has to be arranged such that a subset’s all values for 4 years are in a sequence before continuing to another subset. Let’s create a sample DataFrame to illustrate this point.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sample_countries <span class="op">=</span> [<span class="st">"Germany"</span>, <span class="st">"France"</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sample_stores <span class="op">=</span> [<span class="st">"KaggleRama"</span>, <span class="st">"KaggleMart"</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sample_timepoints <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>sample_num_sold <span class="op">=</span> np.tile([<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>], <span class="dv">4</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> pandas.MultiIndex.from_product(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    [sample_countries, sample_stores, sample_timepoints]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>example <span class="op">=</span> pandas.DataFrame(index<span class="op">=</span>idx, data<span class="op">=</span>{<span class="st">"num_sold"</span>: sample_num_sold})</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>num_sold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">Germany</th>
      <th rowspan="4" valign="top">KaggleRama</th>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">KaggleMart</th>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
    </tr>
    <tr>
      <th rowspan="8" valign="top">France</th>
      <th rowspan="4" valign="top">KaggleRama</th>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">KaggleMart</th>
      <th>0</th>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Now transform the whole data.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> to_datetime</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First sort the data and drop the row_id column since we don't need it.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>transformed_data <span class="op">=</span> data.sort_values(by<span class="op">=</span>[<span class="st">"country"</span>, <span class="st">"store"</span>, <span class="st">"product"</span>, <span class="st">"date"</span>]).drop(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"row_id"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the date column to pandas Datetime</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>transformed_data[<span class="st">"date"</span>] <span class="op">=</span> to_datetime(transformed_data[<span class="st">"date"</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>transformed_data <span class="op">=</span> transformed_data.set_index([<span class="st">"country"</span>, <span class="st">"store"</span>, <span class="st">"product"</span>, <span class="st">"date"</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>transformed_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>num_sold</th>
    </tr>
    <tr>
      <th>country</th>
      <th>store</th>
      <th>product</th>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">Belgium</th>
      <th rowspan="5" valign="top">KaggleMart</th>
      <th rowspan="5" valign="top">Kaggle Advanced Techniques</th>
      <th>2017-01-01</th>
      <td>663</td>
    </tr>
    <tr>
      <th>2017-01-02</th>
      <td>514</td>
    </tr>
    <tr>
      <th>2017-01-03</th>
      <td>549</td>
    </tr>
    <tr>
      <th>2017-01-04</th>
      <td>477</td>
    </tr>
    <tr>
      <th>2017-01-05</th>
      <td>447</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Spain</th>
      <th rowspan="5" valign="top">KaggleRama</th>
      <th rowspan="5" valign="top">Kaggle for Kids: One Smart Goose</th>
      <th>2020-12-27</th>
      <td>204</td>
    </tr>
    <tr>
      <th>2020-12-28</th>
      <td>212</td>
    </tr>
    <tr>
      <th>2020-12-29</th>
      <td>242</td>
    </tr>
    <tr>
      <th>2020-12-30</th>
      <td>239</td>
    </tr>
    <tr>
      <th>2020-12-31</th>
      <td>202</td>
    </tr>
  </tbody>
</table>
<p>70128 rows × 1 columns</p>
</div>
</div>
</div>
</section>
<section id="modelling" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Modelling</h1>
<p>The data is ready to model. We will create several different models for forecasting: ARIMA, Regression with ARIMAX and XGBoost, and Deep Learning with Long Short Term Memory (LSTM). Each model may need another data transformation but it will be easy to transform from the data that we have already preprocessed.</p>
<p>We will not tune the hyperparameters rigorously at first, just enough to get reasonable forecasts. After we went through all of them, I will create a custom performance metric for an assumed business case and then we will compare each model according to this metric.</p>
<section id="stl-arima" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="stl-arima"><span class="header-section-number">3.1</span> STL-ARIMA</h2>
<p>Autoregressive Integrated Moving Average (ARIMA) is a statistical method used for forecasting. It uses values at previous time points to predict current value (autoregression) and these regressions’ errors (moving average). Main assumption of ARIMA is that the time series should be stationary meaning its value is independent of time. Trend and seasonality makes the time series non-stationary. To make time series stationary we can use “differencing” - simply subtracting the value at t-1 from the value at t. “Integrated” part of the ARIMA is referring to the differencing order to make time series stationary.</p>
<p>ARIMA consists of three parts each having their own order - Autoregression p, Integration d, and Moving Average q. We will use Autocorrelation Function and Partial Autocorrelation Function graphs to select correct orders.</p>
<p>Moving to our data, just by looking the above plots we can say there is a strong seasonality in the time series but to quantify it we will use Kwiatkowski-Phillips-Schmidt-Shin (KPSS) test to check for stationarity.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> kpss</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>kpss_test <span class="op">=</span> kpss(transformed_data)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"p-value of KPSS test is: </span><span class="sc">{</span>kpss_test[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value of KPSS test is: 0.01</code></pre>
</div>
</div>
<p>Null hypothesis of KPSS test is that the series is stationary. Since the p-value of our test result is smaller that 0.05 we can reject the null hypothesis and state that the series is non-stationary.</p>
<p>Before creating the ARIMA model we have to remove trend and seasonality from the data. We could use the seasonal variant of ARIMA called <strong>SARIMA</strong>; however, our data’s frequency is a day so it has a periodicity of 365 days. SARIMA models are more suitable for monthly or quarterly data; therefore we will use <strong>Seasonal-Trend Decomposition Using LOESS (STL)</strong> method to remove trend and seasonality from the data.</p>
<div class="cell fig-cap-location-bottom" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> STL</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting plot style and size</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"darkgrid"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.rc(<span class="st">"figure"</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.rc(<span class="st">"font"</span>, size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sample subset to plot</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> transformed_data.loc[<span class="st">"Germany"</span>, <span class="st">"KaggleRama"</span>, <span class="st">"Kaggle Advanced Techniques"</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the decomposed parts of the time series</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>stl <span class="op">=</span> STL(subset, period<span class="op">=</span><span class="dv">365</span>, seasonal<span class="op">=</span><span class="dv">7</span>, trend_deg<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>decomp <span class="op">=</span> stl.fit()</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> decomp.plot()</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>fig.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="book_sales_forecasting_files/figure-html/cell-11-output-1.png" width="662" height="470" class="figure-img"></p>
<p></p><figcaption class="figure-caption">STL Decomposition Results</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Above code decomposed the subset time series to three parts: trend, season, and residuals. Before creating ARIMA model, we still have to make sure that the residual part is non-stationary. We will test for stationarity with KPSS again and use differencing until it is stationary. This differencing degree will determine our I(d) parameter in the ARIMA model.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>diff_test <span class="op">=</span> kpss(decomp.resid)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"p-value of KPSS test is: </span><span class="sc">{</span>diff_test[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value of KPSS test is: 0.1</code></pre>
</div>
</div>
<p>Residual are stationary according to test so we won’t need a differencing in our model and therefore d degree will be 0. For the AR(p) order, we will look at the autocorrelation graphs. For the MA(q) order, we will try values and select the model with the lowest <strong>AIC (Akaike’s Information Criteria)</strong>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plot_acf(decomp.resid)<span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plot_pacf(decomp.resid)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="book_sales_forecasting_files/figure-html/cell-13-output-1.png" width="583" height="430" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="book_sales_forecasting_files/figure-html/cell-13-output-2.png" width="583" height="430" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Partial Autocorrelation Function shows statistically significant correlations at lags up to 7; thus we will start with AR(7). Now it is a good time to split our subset to train and test parts. Train data will be the first three years’ data and the test will be last year’s data.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.forecasting.stl <span class="im">import</span> STLForecast, STLForecastResults</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.model_selection <span class="im">import</span> temporal_train_test_split</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split subset to train-test</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>train_subset, test_subset_pretuning <span class="op">=</span> temporal_train_test_split(subset, test_size<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define STLForecast model</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>stl_forecast <span class="op">=</span> STLForecast(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    train_subset,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>ARIMA,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    model_kwargs<span class="op">=</span>{<span class="st">"order"</span>: (<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"trend"</span>: <span class="st">"t"</span>},</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    period<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">=</span><span class="dv">1095</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    robust<span class="op">=</span><span class="va">False</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> stl_forecast.fit()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the last year</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> model.forecast(steps<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_forecasts(y_true, y_pred, title<span class="op">=</span><span class="st">"Forecasts"</span>, width<span class="op">=</span><span class="dv">700</span>, height<span class="op">=</span><span class="dv">500</span>):</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame to store both series</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    series <span class="op">=</span> pandas.DataFrame()</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    series[<span class="st">"Observed"</span>] <span class="op">=</span> y_true</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    series[<span class="st">"Predicted"</span>] <span class="op">=</span> y_pred</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define plot attributes</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.line(</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        series, </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width, </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height, </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>title,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span>{</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span>: <span class="st">"Sales"</span>,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">"variable"</span>: <span class="st">""</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>plot_forecasts(test_subset_pretuning[<span class="st">"num_sold"</span>], forecast, title<span class="op">=</span><span class="st">"STL-ARIMA Forecasts with (7,0,0)"</span>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="b15f6ebc-8499-4383-bb0b-b9e5659c644b" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("b15f6ebc-8499-4383-bb0b-b9e5659c644b")) {                    Plotly.newPlot(                        "b15f6ebc-8499-4383-bb0b-b9e5659c644b",                        [{"hovertemplate":"=Observed<br>date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":["2020-01-01T00:00:00","2020-01-02T00:00:00","2020-01-03T00:00:00","2020-01-04T00:00:00","2020-01-05T00:00:00","2020-01-06T00:00:00","2020-01-07T00:00:00","2020-01-08T00:00:00","2020-01-09T00:00:00","2020-01-10T00:00:00","2020-01-11T00:00:00","2020-01-12T00:00:00","2020-01-13T00:00:00","2020-01-14T00:00:00","2020-01-15T00:00:00","2020-01-16T00:00:00","2020-01-17T00:00:00","2020-01-18T00:00:00","2020-01-19T00:00:00","2020-01-20T00:00:00","2020-01-21T00:00:00","2020-01-22T00:00:00","2020-01-23T00:00:00","2020-01-24T00:00:00","2020-01-25T00:00:00","2020-01-26T00:00:00","2020-01-27T00:00:00","2020-01-28T00:00:00","2020-01-29T00:00:00","2020-01-30T00:00:00","2020-01-31T00:00:00","2020-02-01T00:00:00","2020-02-02T00:00:00","2020-02-03T00:00:00","2020-02-04T00:00:00","2020-02-05T00:00:00","2020-02-06T00:00:00","2020-02-07T00:00:00","2020-02-08T00:00:00","2020-02-09T00:00:00","2020-02-10T00:00:00","2020-02-11T00:00:00","2020-02-12T00:00:00","2020-02-13T00:00:00","2020-02-14T00:00:00","2020-02-15T00:00:00","2020-02-16T00:00:00","2020-02-17T00:00:00","2020-02-18T00:00:00","2020-02-19T00:00:00","2020-02-20T00:00:00","2020-02-21T00:00:00","2020-02-22T00:00:00","2020-02-23T00:00:00","2020-02-24T00:00:00","2020-02-25T00:00:00","2020-02-26T00:00:00","2020-02-27T00:00:00","2020-02-28T00:00:00","2020-02-29T00:00:00","2020-03-01T00:00:00","2020-03-02T00:00:00","2020-03-03T00:00:00","2020-03-04T00:00:00","2020-03-05T00:00:00","2020-03-06T00:00:00","2020-03-07T00:00:00","2020-03-08T00:00:00","2020-03-09T00:00:00","2020-03-10T00:00:00","2020-03-11T00:00:00","2020-03-12T00:00:00","2020-03-13T00:00:00","2020-03-14T00:00:00","2020-03-15T00:00:00","2020-03-16T00:00:00","2020-03-17T00:00:00","2020-03-18T00:00:00","2020-03-19T00:00:00","2020-03-20T00:00:00","2020-03-21T00:00:00","2020-03-22T00:00:00","2020-03-23T00:00:00","2020-03-24T00:00:00","2020-03-25T00:00:00","2020-03-26T00:00:00","2020-03-27T00:00:00","2020-03-28T00:00:00","2020-03-29T00:00:00","2020-03-30T00:00:00","2020-03-31T00:00:00","2020-04-01T00:00:00","2020-04-02T00:00:00","2020-04-03T00:00:00","2020-04-04T00:00:00","2020-04-05T00:00:00","2020-04-06T00:00:00","2020-04-07T00:00:00","2020-04-08T00:00:00","2020-04-09T00:00:00","2020-04-10T00:00:00","2020-04-11T00:00:00","2020-04-12T00:00:00","2020-04-13T00:00:00","2020-04-14T00:00:00","2020-04-15T00:00:00","2020-04-16T00:00:00","2020-04-17T00:00:00","2020-04-18T00:00:00","2020-04-19T00:00:00","2020-04-20T00:00:00","2020-04-21T00:00:00","2020-04-22T00:00:00","2020-04-23T00:00:00","2020-04-24T00:00:00","2020-04-25T00:00:00","2020-04-26T00:00:00","2020-04-27T00:00:00","2020-04-28T00:00:00","2020-04-29T00:00:00","2020-04-30T00:00:00","2020-05-01T00:00:00","2020-05-02T00:00:00","2020-05-03T00:00:00","2020-05-04T00:00:00","2020-05-05T00:00:00","2020-05-06T00:00:00","2020-05-07T00:00:00","2020-05-08T00:00:00","2020-05-09T00:00:00","2020-05-10T00:00:00","2020-05-11T00:00:00","2020-05-12T00:00:00","2020-05-13T00:00:00","2020-05-14T00:00:00","2020-05-15T00:00:00","2020-05-16T00:00:00","2020-05-17T00:00:00","2020-05-18T00:00:00","2020-05-19T00:00:00","2020-05-20T00:00:00","2020-05-21T00:00:00","2020-05-22T00:00:00","2020-05-23T00:00:00","2020-05-24T00:00:00","2020-05-25T00:00:00","2020-05-26T00:00:00","2020-05-27T00:00:00","2020-05-28T00:00:00","2020-05-29T00:00:00","2020-05-30T00:00:00","2020-05-31T00:00:00","2020-06-01T00:00:00","2020-06-02T00:00:00","2020-06-03T00:00:00","2020-06-04T00:00:00","2020-06-05T00:00:00","2020-06-06T00:00:00","2020-06-07T00:00:00","2020-06-08T00:00:00","2020-06-09T00:00:00","2020-06-10T00:00:00","2020-06-11T00:00:00","2020-06-12T00:00:00","2020-06-13T00:00:00","2020-06-14T00:00:00","2020-06-15T00:00:00","2020-06-16T00:00:00","2020-06-17T00:00:00","2020-06-18T00:00:00","2020-06-19T00:00:00","2020-06-20T00:00:00","2020-06-21T00:00:00","2020-06-22T00:00:00","2020-06-23T00:00:00","2020-06-24T00:00:00","2020-06-25T00:00:00","2020-06-26T00:00:00","2020-06-27T00:00:00","2020-06-28T00:00:00","2020-06-29T00:00:00","2020-06-30T00:00:00","2020-07-01T00:00:00","2020-07-02T00:00:00","2020-07-03T00:00:00","2020-07-04T00:00:00","2020-07-05T00:00:00","2020-07-06T00:00:00","2020-07-07T00:00:00","2020-07-08T00:00:00","2020-07-09T00:00:00","2020-07-10T00:00:00","2020-07-11T00:00:00","2020-07-12T00:00:00","2020-07-13T00:00:00","2020-07-14T00:00:00","2020-07-15T00:00:00","2020-07-16T00:00:00","2020-07-17T00:00:00","2020-07-18T00:00:00","2020-07-19T00:00:00","2020-07-20T00:00:00","2020-07-21T00:00:00","2020-07-22T00:00:00","2020-07-23T00:00:00","2020-07-24T00:00:00","2020-07-25T00:00:00","2020-07-26T00:00:00","2020-07-27T00:00:00","2020-07-28T00:00:00","2020-07-29T00:00:00","2020-07-30T00:00:00","2020-07-31T00:00:00","2020-08-01T00:00:00","2020-08-02T00:00:00","2020-08-03T00:00:00","2020-08-04T00:00:00","2020-08-05T00:00:00","2020-08-06T00:00:00","2020-08-07T00:00:00","2020-08-08T00:00:00","2020-08-09T00:00:00","2020-08-10T00:00:00","2020-08-11T00:00:00","2020-08-12T00:00:00","2020-08-13T00:00:00","2020-08-14T00:00:00","2020-08-15T00:00:00","2020-08-16T00:00:00","2020-08-17T00:00:00","2020-08-18T00:00:00","2020-08-19T00:00:00","2020-08-20T00:00:00","2020-08-21T00:00:00","2020-08-22T00:00:00","2020-08-23T00:00:00","2020-08-24T00:00:00","2020-08-25T00:00:00","2020-08-26T00:00:00","2020-08-27T00:00:00","2020-08-28T00:00:00","2020-08-29T00:00:00","2020-08-30T00:00:00","2020-08-31T00:00:00","2020-09-01T00:00:00","2020-09-02T00:00:00","2020-09-03T00:00:00","2020-09-04T00:00:00","2020-09-05T00:00:00","2020-09-06T00:00:00","2020-09-07T00:00:00","2020-09-08T00:00:00","2020-09-09T00:00:00","2020-09-10T00:00:00","2020-09-11T00:00:00","2020-09-12T00:00:00","2020-09-13T00:00:00","2020-09-14T00:00:00","2020-09-15T00:00:00","2020-09-16T00:00:00","2020-09-17T00:00:00","2020-09-18T00:00:00","2020-09-19T00:00:00","2020-09-20T00:00:00","2020-09-21T00:00:00","2020-09-22T00:00:00","2020-09-23T00:00:00","2020-09-24T00:00:00","2020-09-25T00:00:00","2020-09-26T00:00:00","2020-09-27T00:00:00","2020-09-28T00:00:00","2020-09-29T00:00:00","2020-09-30T00:00:00","2020-10-01T00:00:00","2020-10-02T00:00:00","2020-10-03T00:00:00","2020-10-04T00:00:00","2020-10-05T00:00:00","2020-10-06T00:00:00","2020-10-07T00:00:00","2020-10-08T00:00:00","2020-10-09T00:00:00","2020-10-10T00:00:00","2020-10-11T00:00:00","2020-10-12T00:00:00","2020-10-13T00:00:00","2020-10-14T00:00:00","2020-10-15T00:00:00","2020-10-16T00:00:00","2020-10-17T00:00:00","2020-10-18T00:00:00","2020-10-19T00:00:00","2020-10-20T00:00:00","2020-10-21T00:00:00","2020-10-22T00:00:00","2020-10-23T00:00:00","2020-10-24T00:00:00","2020-10-25T00:00:00","2020-10-26T00:00:00","2020-10-27T00:00:00","2020-10-28T00:00:00","2020-10-29T00:00:00","2020-10-30T00:00:00","2020-10-31T00:00:00","2020-11-01T00:00:00","2020-11-02T00:00:00","2020-11-03T00:00:00","2020-11-04T00:00:00","2020-11-05T00:00:00","2020-11-06T00:00:00","2020-11-07T00:00:00","2020-11-08T00:00:00","2020-11-09T00:00:00","2020-11-10T00:00:00","2020-11-11T00:00:00","2020-11-12T00:00:00","2020-11-13T00:00:00","2020-11-14T00:00:00","2020-11-15T00:00:00","2020-11-16T00:00:00","2020-11-17T00:00:00","2020-11-18T00:00:00","2020-11-19T00:00:00","2020-11-20T00:00:00","2020-11-21T00:00:00","2020-11-22T00:00:00","2020-11-23T00:00:00","2020-11-24T00:00:00","2020-11-25T00:00:00","2020-11-26T00:00:00","2020-11-27T00:00:00","2020-11-28T00:00:00","2020-11-29T00:00:00","2020-11-30T00:00:00","2020-12-01T00:00:00","2020-12-02T00:00:00","2020-12-03T00:00:00","2020-12-04T00:00:00","2020-12-05T00:00:00","2020-12-06T00:00:00","2020-12-07T00:00:00","2020-12-08T00:00:00","2020-12-09T00:00:00","2020-12-10T00:00:00","2020-12-11T00:00:00","2020-12-12T00:00:00","2020-12-13T00:00:00","2020-12-14T00:00:00","2020-12-15T00:00:00","2020-12-16T00:00:00","2020-12-17T00:00:00","2020-12-18T00:00:00","2020-12-19T00:00:00","2020-12-20T00:00:00","2020-12-21T00:00:00","2020-12-22T00:00:00","2020-12-23T00:00:00","2020-12-24T00:00:00","2020-12-25T00:00:00","2020-12-26T00:00:00","2020-12-27T00:00:00","2020-12-28T00:00:00","2020-12-29T00:00:00","2020-12-30T00:00:00","2020-12-31T00:00:00"],"xaxis":"x","y":[185.0,151.0,165.0,173.0,163.0,161.0,147.0,143.0,141.0,135.0,157.0,171.0,136.0,148.0,134.0,142.0,142.0,168.0,165.0,137.0,128.0,150.0,149.0,142.0,156.0,178.0,146.0,142.0,148.0,139.0,156.0,157.0,175.0,144.0,143.0,148.0,143.0,152.0,155.0,174.0,157.0,151.0,148.0,147.0,146.0,177.0,181.0,157.0,141.0,136.0,148.0,164.0,175.0,180.0,153.0,153.0,156.0,152.0,148.0,192.0,161.0,138.0,147.0,138.0,127.0,138.0,160.0,160.0,129.0,137.0,130.0,144.0,142.0,165.0,160.0,149.0,142.0,139.0,132.0,147.0,150.0,153.0,131.0,133.0,144.0,138.0,137.0,165.0,181.0,129.0,142.0,127.0,113.0,126.0,128.0,137.0,113.0,123.0,121.0,107.0,113.0,136.0,137.0,122.0,127.0,140.0,137.0,155.0,149.0,148.0,128.0,115.0,113.0,107.0,114.0,128.0,136.0,111.0,115.0,110.0,117.0,134.0,147.0,143.0,140.0,133.0,150.0,131.0,135.0,143.0,146.0,124.0,121.0,115.0,129.0,116.0,144.0,141.0,115.0,124.0,129.0,119.0,135.0,135.0,153.0,137.0,129.0,126.0,121.0,127.0,134.0,125.0,133.0,124.0,143.0,138.0,149.0,145.0,150.0,126.0,140.0,124.0,124.0,128.0,144.0,140.0,118.0,115.0,128.0,112.0,113.0,147.0,131.0,111.0,122.0,115.0,119.0,121.0,132.0,134.0,118.0,112.0,121.0,125.0,133.0,142.0,140.0,127.0,125.0,116.0,117.0,123.0,132.0,142.0,116.0,129.0,115.0,120.0,122.0,135.0,140.0,103.0,108.0,119.0,105.0,113.0,129.0,136.0,108.0,99.0,111.0,100.0,102.0,117.0,121.0,113.0,121.0,111.0,107.0,111.0,119.0,122.0,108.0,98.0,110.0,91.0,119.0,115.0,123.0,86.0,98.0,105.0,103.0,100.0,104.0,127.0,104.0,94.0,108.0,107.0,101.0,110.0,106.0,98.0,100.0,107.0,98.0,99.0,120.0,125.0,94.0,99.0,94.0,93.0,107.0,108.0,126.0,86.0,93.0,90.0,105.0,107.0,113.0,96.0,93.0,85.0,91.0,90.0,109.0,108.0,110.0,96.0,99.0,99.0,100.0,108.0,103.0,133.0,106.0,106.0,112.0,104.0,111.0,125.0,126.0,94.0,100.0,100.0,95.0,110.0,111.0,131.0,92.0,98.0,95.0,98.0,109.0,119.0,122.0,104.0,91.0,97.0,96.0,105.0,111.0,114.0,95.0,97.0,106.0,96.0,107.0,125.0,118.0,107.0,105.0,98.0,99.0,103.0,118.0,138.0,112.0,111.0,104.0,113.0,108.0,131.0,127.0,109.0,110.0,108.0,112.0,116.0,119.0,135.0,121.0,109.0,117.0,121.0,112.0,123.0,127.0,112.0,117.0,118.0,109.0,116.0,128.0,150.0,104.0,116.0,110.0,112.0,124.0,138.0,161.0,114.0,127.0,118.0,122.0,123.0,172.0,195.0,198.0,225.0,245.0,218.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":["2020-01-01T00:00:00","2020-01-02T00:00:00","2020-01-03T00:00:00","2020-01-04T00:00:00","2020-01-05T00:00:00","2020-01-06T00:00:00","2020-01-07T00:00:00","2020-01-08T00:00:00","2020-01-09T00:00:00","2020-01-10T00:00:00","2020-01-11T00:00:00","2020-01-12T00:00:00","2020-01-13T00:00:00","2020-01-14T00:00:00","2020-01-15T00:00:00","2020-01-16T00:00:00","2020-01-17T00:00:00","2020-01-18T00:00:00","2020-01-19T00:00:00","2020-01-20T00:00:00","2020-01-21T00:00:00","2020-01-22T00:00:00","2020-01-23T00:00:00","2020-01-24T00:00:00","2020-01-25T00:00:00","2020-01-26T00:00:00","2020-01-27T00:00:00","2020-01-28T00:00:00","2020-01-29T00:00:00","2020-01-30T00:00:00","2020-01-31T00:00:00","2020-02-01T00:00:00","2020-02-02T00:00:00","2020-02-03T00:00:00","2020-02-04T00:00:00","2020-02-05T00:00:00","2020-02-06T00:00:00","2020-02-07T00:00:00","2020-02-08T00:00:00","2020-02-09T00:00:00","2020-02-10T00:00:00","2020-02-11T00:00:00","2020-02-12T00:00:00","2020-02-13T00:00:00","2020-02-14T00:00:00","2020-02-15T00:00:00","2020-02-16T00:00:00","2020-02-17T00:00:00","2020-02-18T00:00:00","2020-02-19T00:00:00","2020-02-20T00:00:00","2020-02-21T00:00:00","2020-02-22T00:00:00","2020-02-23T00:00:00","2020-02-24T00:00:00","2020-02-25T00:00:00","2020-02-26T00:00:00","2020-02-27T00:00:00","2020-02-28T00:00:00","2020-02-29T00:00:00","2020-03-01T00:00:00","2020-03-02T00:00:00","2020-03-03T00:00:00","2020-03-04T00:00:00","2020-03-05T00:00:00","2020-03-06T00:00:00","2020-03-07T00:00:00","2020-03-08T00:00:00","2020-03-09T00:00:00","2020-03-10T00:00:00","2020-03-11T00:00:00","2020-03-12T00:00:00","2020-03-13T00:00:00","2020-03-14T00:00:00","2020-03-15T00:00:00","2020-03-16T00:00:00","2020-03-17T00:00:00","2020-03-18T00:00:00","2020-03-19T00:00:00","2020-03-20T00:00:00","2020-03-21T00:00:00","2020-03-22T00:00:00","2020-03-23T00:00:00","2020-03-24T00:00:00","2020-03-25T00:00:00","2020-03-26T00:00:00","2020-03-27T00:00:00","2020-03-28T00:00:00","2020-03-29T00:00:00","2020-03-30T00:00:00","2020-03-31T00:00:00","2020-04-01T00:00:00","2020-04-02T00:00:00","2020-04-03T00:00:00","2020-04-04T00:00:00","2020-04-05T00:00:00","2020-04-06T00:00:00","2020-04-07T00:00:00","2020-04-08T00:00:00","2020-04-09T00:00:00","2020-04-10T00:00:00","2020-04-11T00:00:00","2020-04-12T00:00:00","2020-04-13T00:00:00","2020-04-14T00:00:00","2020-04-15T00:00:00","2020-04-16T00:00:00","2020-04-17T00:00:00","2020-04-18T00:00:00","2020-04-19T00:00:00","2020-04-20T00:00:00","2020-04-21T00:00:00","2020-04-22T00:00:00","2020-04-23T00:00:00","2020-04-24T00:00:00","2020-04-25T00:00:00","2020-04-26T00:00:00","2020-04-27T00:00:00","2020-04-28T00:00:00","2020-04-29T00:00:00","2020-04-30T00:00:00","2020-05-01T00:00:00","2020-05-02T00:00:00","2020-05-03T00:00:00","2020-05-04T00:00:00","2020-05-05T00:00:00","2020-05-06T00:00:00","2020-05-07T00:00:00","2020-05-08T00:00:00","2020-05-09T00:00:00","2020-05-10T00:00:00","2020-05-11T00:00:00","2020-05-12T00:00:00","2020-05-13T00:00:00","2020-05-14T00:00:00","2020-05-15T00:00:00","2020-05-16T00:00:00","2020-05-17T00:00:00","2020-05-18T00:00:00","2020-05-19T00:00:00","2020-05-20T00:00:00","2020-05-21T00:00:00","2020-05-22T00:00:00","2020-05-23T00:00:00","2020-05-24T00:00:00","2020-05-25T00:00:00","2020-05-26T00:00:00","2020-05-27T00:00:00","2020-05-28T00:00:00","2020-05-29T00:00:00","2020-05-30T00:00:00","2020-05-31T00:00:00","2020-06-01T00:00:00","2020-06-02T00:00:00","2020-06-03T00:00:00","2020-06-04T00:00:00","2020-06-05T00:00:00","2020-06-06T00:00:00","2020-06-07T00:00:00","2020-06-08T00:00:00","2020-06-09T00:00:00","2020-06-10T00:00:00","2020-06-11T00:00:00","2020-06-12T00:00:00","2020-06-13T00:00:00","2020-06-14T00:00:00","2020-06-15T00:00:00","2020-06-16T00:00:00","2020-06-17T00:00:00","2020-06-18T00:00:00","2020-06-19T00:00:00","2020-06-20T00:00:00","2020-06-21T00:00:00","2020-06-22T00:00:00","2020-06-23T00:00:00","2020-06-24T00:00:00","2020-06-25T00:00:00","2020-06-26T00:00:00","2020-06-27T00:00:00","2020-06-28T00:00:00","2020-06-29T00:00:00","2020-06-30T00:00:00","2020-07-01T00:00:00","2020-07-02T00:00:00","2020-07-03T00:00:00","2020-07-04T00:00:00","2020-07-05T00:00:00","2020-07-06T00:00:00","2020-07-07T00:00:00","2020-07-08T00:00:00","2020-07-09T00:00:00","2020-07-10T00:00:00","2020-07-11T00:00:00","2020-07-12T00:00:00","2020-07-13T00:00:00","2020-07-14T00:00:00","2020-07-15T00:00:00","2020-07-16T00:00:00","2020-07-17T00:00:00","2020-07-18T00:00:00","2020-07-19T00:00:00","2020-07-20T00:00:00","2020-07-21T00:00:00","2020-07-22T00:00:00","2020-07-23T00:00:00","2020-07-24T00:00:00","2020-07-25T00:00:00","2020-07-26T00:00:00","2020-07-27T00:00:00","2020-07-28T00:00:00","2020-07-29T00:00:00","2020-07-30T00:00:00","2020-07-31T00:00:00","2020-08-01T00:00:00","2020-08-02T00:00:00","2020-08-03T00:00:00","2020-08-04T00:00:00","2020-08-05T00:00:00","2020-08-06T00:00:00","2020-08-07T00:00:00","2020-08-08T00:00:00","2020-08-09T00:00:00","2020-08-10T00:00:00","2020-08-11T00:00:00","2020-08-12T00:00:00","2020-08-13T00:00:00","2020-08-14T00:00:00","2020-08-15T00:00:00","2020-08-16T00:00:00","2020-08-17T00:00:00","2020-08-18T00:00:00","2020-08-19T00:00:00","2020-08-20T00:00:00","2020-08-21T00:00:00","2020-08-22T00:00:00","2020-08-23T00:00:00","2020-08-24T00:00:00","2020-08-25T00:00:00","2020-08-26T00:00:00","2020-08-27T00:00:00","2020-08-28T00:00:00","2020-08-29T00:00:00","2020-08-30T00:00:00","2020-08-31T00:00:00","2020-09-01T00:00:00","2020-09-02T00:00:00","2020-09-03T00:00:00","2020-09-04T00:00:00","2020-09-05T00:00:00","2020-09-06T00:00:00","2020-09-07T00:00:00","2020-09-08T00:00:00","2020-09-09T00:00:00","2020-09-10T00:00:00","2020-09-11T00:00:00","2020-09-12T00:00:00","2020-09-13T00:00:00","2020-09-14T00:00:00","2020-09-15T00:00:00","2020-09-16T00:00:00","2020-09-17T00:00:00","2020-09-18T00:00:00","2020-09-19T00:00:00","2020-09-20T00:00:00","2020-09-21T00:00:00","2020-09-22T00:00:00","2020-09-23T00:00:00","2020-09-24T00:00:00","2020-09-25T00:00:00","2020-09-26T00:00:00","2020-09-27T00:00:00","2020-09-28T00:00:00","2020-09-29T00:00:00","2020-09-30T00:00:00","2020-10-01T00:00:00","2020-10-02T00:00:00","2020-10-03T00:00:00","2020-10-04T00:00:00","2020-10-05T00:00:00","2020-10-06T00:00:00","2020-10-07T00:00:00","2020-10-08T00:00:00","2020-10-09T00:00:00","2020-10-10T00:00:00","2020-10-11T00:00:00","2020-10-12T00:00:00","2020-10-13T00:00:00","2020-10-14T00:00:00","2020-10-15T00:00:00","2020-10-16T00:00:00","2020-10-17T00:00:00","2020-10-18T00:00:00","2020-10-19T00:00:00","2020-10-20T00:00:00","2020-10-21T00:00:00","2020-10-22T00:00:00","2020-10-23T00:00:00","2020-10-24T00:00:00","2020-10-25T00:00:00","2020-10-26T00:00:00","2020-10-27T00:00:00","2020-10-28T00:00:00","2020-10-29T00:00:00","2020-10-30T00:00:00","2020-10-31T00:00:00","2020-11-01T00:00:00","2020-11-02T00:00:00","2020-11-03T00:00:00","2020-11-04T00:00:00","2020-11-05T00:00:00","2020-11-06T00:00:00","2020-11-07T00:00:00","2020-11-08T00:00:00","2020-11-09T00:00:00","2020-11-10T00:00:00","2020-11-11T00:00:00","2020-11-12T00:00:00","2020-11-13T00:00:00","2020-11-14T00:00:00","2020-11-15T00:00:00","2020-11-16T00:00:00","2020-11-17T00:00:00","2020-11-18T00:00:00","2020-11-19T00:00:00","2020-11-20T00:00:00","2020-11-21T00:00:00","2020-11-22T00:00:00","2020-11-23T00:00:00","2020-11-24T00:00:00","2020-11-25T00:00:00","2020-11-26T00:00:00","2020-11-27T00:00:00","2020-11-28T00:00:00","2020-11-29T00:00:00","2020-11-30T00:00:00","2020-12-01T00:00:00","2020-12-02T00:00:00","2020-12-03T00:00:00","2020-12-04T00:00:00","2020-12-05T00:00:00","2020-12-06T00:00:00","2020-12-07T00:00:00","2020-12-08T00:00:00","2020-12-09T00:00:00","2020-12-10T00:00:00","2020-12-11T00:00:00","2020-12-12T00:00:00","2020-12-13T00:00:00","2020-12-14T00:00:00","2020-12-15T00:00:00","2020-12-16T00:00:00","2020-12-17T00:00:00","2020-12-18T00:00:00","2020-12-19T00:00:00","2020-12-20T00:00:00","2020-12-21T00:00:00","2020-12-22T00:00:00","2020-12-23T00:00:00","2020-12-24T00:00:00","2020-12-25T00:00:00","2020-12-26T00:00:00","2020-12-27T00:00:00","2020-12-28T00:00:00","2020-12-29T00:00:00","2020-12-30T00:00:00","2020-12-31T00:00:00"],"xaxis":"x","y":[181.27905859165503,169.59182498284548,146.90711032363095,150.3267719156084,173.40972519485803,165.22546327159228,152.12900547507812,149.36603366358528,140.69167148481432,139.63319430139262,150.84485458147563,146.9403765876934,155.79282993216447,140.7839257619122,128.87297273344802,148.56771537350224,134.30741477048957,148.5182456666381,163.89026088141833,158.9302061861003,149.06601938168947,139.329618017103,137.3323517806436,146.41441115644471,162.8478404866695,180.4499959706974,172.97291374701715,152.83786148362628,137.98605062088828,156.9259222313837,146.82390620310983,139.35120265311713,160.76208484623268,185.62082572933252,145.79999845206987,143.30905970103277,149.25847517531497,151.61217757205,148.92576851736027,164.55163884037816,188.8024313610976,151.87060546341246,131.2942923212134,159.2820691110029,160.82079385576344,145.91740608244723,170.69779590744065,195.78566948909935,159.43328160757892,154.45108606795324,160.62839501948932,164.64662257602413,161.28230388487793,178.2883055891125,191.1120434106803,163.32011955796202,158.70237539050444,154.85340656772226,157.06600838806153,156.40148403322195,185.56664183209887,202.5519969230839,165.44301595030765,162.19288950866536,155.1566368293886,148.6328232580158,161.18291754009456,184.71507057456625,193.10688303429993,150.60358283474244,156.34382769833724,171.76738591246104,143.52948983156392,162.97769458460047,165.5186013387699,191.47438598281423,157.47401040127994,150.14740835643494,158.99855027885897,163.14006144142866,175.56985351696028,193.71633067600789,191.5682920168652,166.89024073301124,148.6336189725194,169.59693153494925,141.92708271305935,161.88517937691034,188.16014118822238,193.51116836251094,181.16764780935378,145.66209964947146,175.95764896628452,187.2085431983436,187.2105009119105,189.38286332307598,207.47436731193267,174.7336868146756,146.93976632359602,152.9800577215553,163.11420678472075,176.56009188387577,198.2958510117292,183.46114440210343,156.89022003857178,156.53741488613204,151.83687618665095,153.64454428558534,157.1657918306475,183.56460045189598,202.71249353908317,173.55201565452217,180.29381803466578,174.1817317791093,194.0375128870358,188.00693958774002,202.162644848515,203.1609983034685,156.38476981145212,150.61388575342363,157.86486220634646,159.98232131987828,176.30632160095797,193.5298310053686,201.49002966385206,180.5731143697111,164.7350203740238,176.00633722931536,150.36765305848513,161.8792599717464,176.531089563983,176.07199306572562,180.55694977256724,156.84231349682372,158.39206066890802,158.95893427268854,168.61130894311248,182.52431142322465,195.34377916512238,152.57666689616272,151.30211512233612,153.65537842234426,157.0641301174075,152.70776964855625,178.6034004428445,187.22644995673994,154.43009531969804,136.08817319982356,163.68796802581298,139.37542452675032,150.18626189192778,176.14654642707765,186.34161301352174,171.29320938506936,160.09222768255958,149.85924798020272,152.72581469581326,165.73326138304236,170.7318742372808,163.89769793573797,137.88760908347098,126.83635633509383,144.67678222158324,152.73124463227464,164.44849962602686,181.19510912597414,188.3053934154703,142.29549114953878,145.1242421963098,140.87977069974116,145.12214893369057,147.93344929884708,164.03509858497293,181.94031603672224,142.29423138001337,128.77714832352783,125.4214834671166,127.37374379592914,137.1383377682845,150.35163384744692,168.79084532429752,136.50860482079452,138.53442098196547,126.7825607533131,127.2447645842231,129.72455275065525,141.52407743390214,152.08899349336707,133.78593460544832,131.07810035876798,125.98913088845825,126.55413086513747,127.21301186435706,142.4613762387955,148.39004395236904,129.33054946105918,116.0890929570366,124.0765645897347,121.59477053771353,123.30948477058035,137.37903954318372,148.0205287080192,132.4273896545406,119.27990447314207,115.06222190803064,111.04677296046856,115.0519378724381,136.86940155676814,149.02415416651323,122.46926401855694,112.72362793021188,116.5235896428128,119.93058424742321,125.35514359304432,130.80031233440477,127.47708794095135,121.02491126816206,112.06531119301582,109.5192988717859,119.47768481600596,130.0049500380649,125.01028341540078,126.97747486305825,118.92712227478242,101.42504935644826,106.926031392211,111.03404341998366,111.94557477965174,122.37027903508624,118.9651522607564,122.37232046700045,102.46855209931962,105.5209097055405,104.28292944865977,113.3997842117881,118.16181972202936,128.86815855153017,109.07889316712769,108.10192258970957,101.4240819119174,105.64361596921343,109.14472717622914,122.41120454239928,121.47242365348697,104.22575138035617,106.2663863210982,109.67367831543078,105.97834483174242,103.60847028685012,120.57587732223334,127.92749426619537,104.21463747072855,103.46058993947722,105.16705595246015,98.38669394632777,107.99931819033297,123.8465911053401,130.78468166317708,115.72582586904556,98.76656414043237,103.16518310573363,97.03882224047456,104.65149832118836,111.96505949577924,130.9795057993803,103.43386672600238,103.42772896150187,96.12552264158742,94.2338555586787,108.35974883555758,116.91678045687027,122.03391255719707,107.37691719938191,88.81951614479385,92.1800889240902,96.9336483016189,108.69599180198125,130.17677348582416,139.81894681391148,123.73087482725867,117.40816936385632,118.17055187398249,107.58689164032401,112.85367812287943,110.9709113481687,137.72454910970117,111.19662526810694,96.91212712812569,91.57193234612024,111.44578783964246,103.35780326307236,114.00885628065785,116.32264318147014,112.33731585250224,95.07920350418033,101.13204437341696,101.64235337798495,106.11451873389814,114.72747711575303,129.07947326502708,105.9358658915526,104.2379040729814,105.22632171048696,96.15599674385324,114.96549442587968,124.58728743681954,123.90119008609636,113.4028141930583,101.04218522647378,111.1889991886547,104.95161912282666,110.67609566599342,124.58829374835688,125.49172394262382,109.36578718588174,113.74424716244253,99.39550886398166,110.46608719744195,106.22877535118901,125.18796153584694,140.8480339610493,112.05943145840693,105.04497266662136,106.20068276829616,112.86078971485486,118.230559353514,123.08717306825248,146.60652123395698,114.85613119922175,111.54261072062724,113.68960517163498,113.57259155724782,121.43803387699802,134.39734145268628,134.65578012901275,116.76466637271153,118.35735049181802,103.70089556180682,117.40805281286706,126.1415480238877,135.98950761741938,144.60283468960813,131.27187521155832,105.81769253655085,126.55427799988804,114.71895673540533,124.74285949852657,134.45009592881397,140.8288433480887,129.32205519333675,110.97056715520988,115.31423548132271,112.67546543258302,122.35337937222573,138.62077047899172,144.1785163948991,138.38144413928035,128.87168040965534,134.2798916884911,144.632407162188,180.3016066391805,243.84185286747064,284.8571206766421,224.26537622590712,217.23946359335977,181.15558765094096],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"date"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"STL-ARIMA Forecasts with (7,0,0)"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b15f6ebc-8499-4383-bb0b-b9e5659c644b');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">

<table class="simpletable">
<caption>STL Decomposition and SARIMAX Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>   <td>1095</td>   
</tr>
<tr>
  <th>Model:</th>            <td>ARIMA(7, 0, 0)</td>  <th>  Log Likelihood     </th> <td>-3477.975</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sun, 18 Dec 2022</td> <th>  AIC                </th> <td>6973.950</td> 
</tr>
<tr>
  <th>Time:</th>                <td>12:13:26</td>     <th>  BIC                </th> <td>7018.937</td> 
</tr>
<tr>
  <th>Sample:</th>             <td>01-01-2017</td>    <th>  HQIC               </th> <td>6990.973</td> 
</tr>
<tr>
  <th></th>                   <td>- 12-31-2019</td>   <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P&gt;|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>x1</th>     <td>    0.0074</td> <td>    0.135</td> <td>    0.055</td> <td> 0.956</td> <td>   -0.258</td> <td>    0.273</td>
</tr>
<tr>
  <th>ar.L1</th>  <td>    0.1083</td> <td>    0.019</td> <td>    5.696</td> <td> 0.000</td> <td>    0.071</td> <td>    0.146</td>
</tr>
<tr>
  <th>ar.L2</th>  <td>    0.1827</td> <td>    0.021</td> <td>    8.721</td> <td> 0.000</td> <td>    0.142</td> <td>    0.224</td>
</tr>
<tr>
  <th>ar.L3</th>  <td>    0.1113</td> <td>    0.018</td> <td>    6.122</td> <td> 0.000</td> <td>    0.076</td> <td>    0.147</td>
</tr>
<tr>
  <th>ar.L4</th>  <td>    0.1520</td> <td>    0.020</td> <td>    7.456</td> <td> 0.000</td> <td>    0.112</td> <td>    0.192</td>
</tr>
<tr>
  <th>ar.L5</th>  <td>    0.0204</td> <td>    0.020</td> <td>    1.024</td> <td> 0.306</td> <td>   -0.019</td> <td>    0.060</td>
</tr>
<tr>
  <th>ar.L6</th>  <td>   -0.0949</td> <td>    0.020</td> <td>   -4.857</td> <td> 0.000</td> <td>   -0.133</td> <td>   -0.057</td>
</tr>
<tr>
  <th>ar.L7</th>  <td>    0.5200</td> <td>    0.017</td> <td>   30.557</td> <td> 0.000</td> <td>    0.487</td> <td>    0.553</td>
</tr>
<tr>
  <th>sigma2</th> <td>   33.3182</td> <td>    0.864</td> <td>   38.550</td> <td> 0.000</td> <td>   31.624</td> <td>   35.012</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>8.57</td> <th>  Jarque-Bera (JB):  </th> <td>629.83</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.00</td> <th>  Prob(JB):          </th>  <td>0.00</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>1.06</td> <th>  Skew:              </th>  <td>-0.10</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.60</td> <th>  Kurtosis:          </th>  <td>6.71</td> 
</tr>
</tbody></table>
<table class="simpletable">
<caption>STL Configuration</caption>
<tbody><tr>
  <th>Period:                </th> <td>          365</td> <th>      Trend Length:          </th> <td>         1095</td>
</tr>
<tr>
  <th>Seasonal:              </th> <td>            7</td> <th>      Trend deg:             </th> <td>            1</td>
</tr>
<tr>
  <th>Seasonal deg:          </th> <td>            1</td> <th>      Trend jump:            </th> <td>            1</td>
</tr>
<tr>
  <th>Seasonal jump:         </th> <td>            1</td> <th>      Low pass:              </th> <td>          367</td>
</tr>
<tr>
  <th>Robust:                </th> <td>        False</td> <th>      Low pass deg:          </th> <td>            1</td>
</tr>
</tbody></table><br><br>Warnings:<br>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</div>
</div>
<p>The forecast looks pretty good already; however, from the summary we detect that p-value for Ljung-Box test is smaller than 0.05. The null hypothesis of Ljung-Box test is that residuals of the model after fitting ARIMA does not contain autocorrelations. Smaller than 0.05 p-value shows that our model could not capture the autocorrelations of the model fully. So will try different q orders and select the one which has the smallest AIC value and the case where the residuals are significantly autocorrelated (p &gt; 0.05).</p>
<div class="cell" data-cache="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>q_orders <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">8</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> q_orders:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    stl_forecast <span class="op">=</span> STLForecast(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        train_subset,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>ARIMA,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        model_kwargs<span class="op">=</span>{<span class="st">"order"</span>: (<span class="dv">7</span>, <span class="dv">0</span>, q), <span class="st">"trend"</span>: <span class="st">"t"</span>},</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        period<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        trend<span class="op">=</span><span class="dv">1095</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        robust<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> stl_forecast.fit()</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> model.forecast(steps<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    results.append(model.model_result.aic)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best q is </span><span class="sc">{</span>results<span class="sc">.</span>index(<span class="bu">min</span>(results))<span class="sc">}</span><span class="ss"> with AIC value of </span><span class="sc">{</span><span class="bu">min</span>(results)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best q is 7 with AIC value of 6781.7431055363095</code></pre>
</div>
</div>
<p>Let’s check the summary again with q value of 7.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>stl_forecast <span class="op">=</span> STLForecast(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    train_subset,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>ARIMA,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    model_kwargs<span class="op">=</span>{<span class="st">"order"</span>: (<span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">7</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"trend"</span>: <span class="st">"t"</span>},</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    period<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">=</span><span class="dv">1095</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    robust<span class="op">=</span><span class="va">False</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> stl_forecast.fit()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the last year</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> model.forecast(steps<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>plot_forecasts(test_subset_pretuning[<span class="st">"num_sold"</span>], forecast, title<span class="op">=</span><span class="st">"STL-ARIMA Forecasts with (7,0,7)"</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="00e2e109-aad5-4b9c-856d-a33a218fdde9" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("00e2e109-aad5-4b9c-856d-a33a218fdde9")) {                    Plotly.newPlot(                        "00e2e109-aad5-4b9c-856d-a33a218fdde9",                        [{"hovertemplate":"=Observed<br>date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":["2020-01-01T00:00:00","2020-01-02T00:00:00","2020-01-03T00:00:00","2020-01-04T00:00:00","2020-01-05T00:00:00","2020-01-06T00:00:00","2020-01-07T00:00:00","2020-01-08T00:00:00","2020-01-09T00:00:00","2020-01-10T00:00:00","2020-01-11T00:00:00","2020-01-12T00:00:00","2020-01-13T00:00:00","2020-01-14T00:00:00","2020-01-15T00:00:00","2020-01-16T00:00:00","2020-01-17T00:00:00","2020-01-18T00:00:00","2020-01-19T00:00:00","2020-01-20T00:00:00","2020-01-21T00:00:00","2020-01-22T00:00:00","2020-01-23T00:00:00","2020-01-24T00:00:00","2020-01-25T00:00:00","2020-01-26T00:00:00","2020-01-27T00:00:00","2020-01-28T00:00:00","2020-01-29T00:00:00","2020-01-30T00:00:00","2020-01-31T00:00:00","2020-02-01T00:00:00","2020-02-02T00:00:00","2020-02-03T00:00:00","2020-02-04T00:00:00","2020-02-05T00:00:00","2020-02-06T00:00:00","2020-02-07T00:00:00","2020-02-08T00:00:00","2020-02-09T00:00:00","2020-02-10T00:00:00","2020-02-11T00:00:00","2020-02-12T00:00:00","2020-02-13T00:00:00","2020-02-14T00:00:00","2020-02-15T00:00:00","2020-02-16T00:00:00","2020-02-17T00:00:00","2020-02-18T00:00:00","2020-02-19T00:00:00","2020-02-20T00:00:00","2020-02-21T00:00:00","2020-02-22T00:00:00","2020-02-23T00:00:00","2020-02-24T00:00:00","2020-02-25T00:00:00","2020-02-26T00:00:00","2020-02-27T00:00:00","2020-02-28T00:00:00","2020-02-29T00:00:00","2020-03-01T00:00:00","2020-03-02T00:00:00","2020-03-03T00:00:00","2020-03-04T00:00:00","2020-03-05T00:00:00","2020-03-06T00:00:00","2020-03-07T00:00:00","2020-03-08T00:00:00","2020-03-09T00:00:00","2020-03-10T00:00:00","2020-03-11T00:00:00","2020-03-12T00:00:00","2020-03-13T00:00:00","2020-03-14T00:00:00","2020-03-15T00:00:00","2020-03-16T00:00:00","2020-03-17T00:00:00","2020-03-18T00:00:00","2020-03-19T00:00:00","2020-03-20T00:00:00","2020-03-21T00:00:00","2020-03-22T00:00:00","2020-03-23T00:00:00","2020-03-24T00:00:00","2020-03-25T00:00:00","2020-03-26T00:00:00","2020-03-27T00:00:00","2020-03-28T00:00:00","2020-03-29T00:00:00","2020-03-30T00:00:00","2020-03-31T00:00:00","2020-04-01T00:00:00","2020-04-02T00:00:00","2020-04-03T00:00:00","2020-04-04T00:00:00","2020-04-05T00:00:00","2020-04-06T00:00:00","2020-04-07T00:00:00","2020-04-08T00:00:00","2020-04-09T00:00:00","2020-04-10T00:00:00","2020-04-11T00:00:00","2020-04-12T00:00:00","2020-04-13T00:00:00","2020-04-14T00:00:00","2020-04-15T00:00:00","2020-04-16T00:00:00","2020-04-17T00:00:00","2020-04-18T00:00:00","2020-04-19T00:00:00","2020-04-20T00:00:00","2020-04-21T00:00:00","2020-04-22T00:00:00","2020-04-23T00:00:00","2020-04-24T00:00:00","2020-04-25T00:00:00","2020-04-26T00:00:00","2020-04-27T00:00:00","2020-04-28T00:00:00","2020-04-29T00:00:00","2020-04-30T00:00:00","2020-05-01T00:00:00","2020-05-02T00:00:00","2020-05-03T00:00:00","2020-05-04T00:00:00","2020-05-05T00:00:00","2020-05-06T00:00:00","2020-05-07T00:00:00","2020-05-08T00:00:00","2020-05-09T00:00:00","2020-05-10T00:00:00","2020-05-11T00:00:00","2020-05-12T00:00:00","2020-05-13T00:00:00","2020-05-14T00:00:00","2020-05-15T00:00:00","2020-05-16T00:00:00","2020-05-17T00:00:00","2020-05-18T00:00:00","2020-05-19T00:00:00","2020-05-20T00:00:00","2020-05-21T00:00:00","2020-05-22T00:00:00","2020-05-23T00:00:00","2020-05-24T00:00:00","2020-05-25T00:00:00","2020-05-26T00:00:00","2020-05-27T00:00:00","2020-05-28T00:00:00","2020-05-29T00:00:00","2020-05-30T00:00:00","2020-05-31T00:00:00","2020-06-01T00:00:00","2020-06-02T00:00:00","2020-06-03T00:00:00","2020-06-04T00:00:00","2020-06-05T00:00:00","2020-06-06T00:00:00","2020-06-07T00:00:00","2020-06-08T00:00:00","2020-06-09T00:00:00","2020-06-10T00:00:00","2020-06-11T00:00:00","2020-06-12T00:00:00","2020-06-13T00:00:00","2020-06-14T00:00:00","2020-06-15T00:00:00","2020-06-16T00:00:00","2020-06-17T00:00:00","2020-06-18T00:00:00","2020-06-19T00:00:00","2020-06-20T00:00:00","2020-06-21T00:00:00","2020-06-22T00:00:00","2020-06-23T00:00:00","2020-06-24T00:00:00","2020-06-25T00:00:00","2020-06-26T00:00:00","2020-06-27T00:00:00","2020-06-28T00:00:00","2020-06-29T00:00:00","2020-06-30T00:00:00","2020-07-01T00:00:00","2020-07-02T00:00:00","2020-07-03T00:00:00","2020-07-04T00:00:00","2020-07-05T00:00:00","2020-07-06T00:00:00","2020-07-07T00:00:00","2020-07-08T00:00:00","2020-07-09T00:00:00","2020-07-10T00:00:00","2020-07-11T00:00:00","2020-07-12T00:00:00","2020-07-13T00:00:00","2020-07-14T00:00:00","2020-07-15T00:00:00","2020-07-16T00:00:00","2020-07-17T00:00:00","2020-07-18T00:00:00","2020-07-19T00:00:00","2020-07-20T00:00:00","2020-07-21T00:00:00","2020-07-22T00:00:00","2020-07-23T00:00:00","2020-07-24T00:00:00","2020-07-25T00:00:00","2020-07-26T00:00:00","2020-07-27T00:00:00","2020-07-28T00:00:00","2020-07-29T00:00:00","2020-07-30T00:00:00","2020-07-31T00:00:00","2020-08-01T00:00:00","2020-08-02T00:00:00","2020-08-03T00:00:00","2020-08-04T00:00:00","2020-08-05T00:00:00","2020-08-06T00:00:00","2020-08-07T00:00:00","2020-08-08T00:00:00","2020-08-09T00:00:00","2020-08-10T00:00:00","2020-08-11T00:00:00","2020-08-12T00:00:00","2020-08-13T00:00:00","2020-08-14T00:00:00","2020-08-15T00:00:00","2020-08-16T00:00:00","2020-08-17T00:00:00","2020-08-18T00:00:00","2020-08-19T00:00:00","2020-08-20T00:00:00","2020-08-21T00:00:00","2020-08-22T00:00:00","2020-08-23T00:00:00","2020-08-24T00:00:00","2020-08-25T00:00:00","2020-08-26T00:00:00","2020-08-27T00:00:00","2020-08-28T00:00:00","2020-08-29T00:00:00","2020-08-30T00:00:00","2020-08-31T00:00:00","2020-09-01T00:00:00","2020-09-02T00:00:00","2020-09-03T00:00:00","2020-09-04T00:00:00","2020-09-05T00:00:00","2020-09-06T00:00:00","2020-09-07T00:00:00","2020-09-08T00:00:00","2020-09-09T00:00:00","2020-09-10T00:00:00","2020-09-11T00:00:00","2020-09-12T00:00:00","2020-09-13T00:00:00","2020-09-14T00:00:00","2020-09-15T00:00:00","2020-09-16T00:00:00","2020-09-17T00:00:00","2020-09-18T00:00:00","2020-09-19T00:00:00","2020-09-20T00:00:00","2020-09-21T00:00:00","2020-09-22T00:00:00","2020-09-23T00:00:00","2020-09-24T00:00:00","2020-09-25T00:00:00","2020-09-26T00:00:00","2020-09-27T00:00:00","2020-09-28T00:00:00","2020-09-29T00:00:00","2020-09-30T00:00:00","2020-10-01T00:00:00","2020-10-02T00:00:00","2020-10-03T00:00:00","2020-10-04T00:00:00","2020-10-05T00:00:00","2020-10-06T00:00:00","2020-10-07T00:00:00","2020-10-08T00:00:00","2020-10-09T00:00:00","2020-10-10T00:00:00","2020-10-11T00:00:00","2020-10-12T00:00:00","2020-10-13T00:00:00","2020-10-14T00:00:00","2020-10-15T00:00:00","2020-10-16T00:00:00","2020-10-17T00:00:00","2020-10-18T00:00:00","2020-10-19T00:00:00","2020-10-20T00:00:00","2020-10-21T00:00:00","2020-10-22T00:00:00","2020-10-23T00:00:00","2020-10-24T00:00:00","2020-10-25T00:00:00","2020-10-26T00:00:00","2020-10-27T00:00:00","2020-10-28T00:00:00","2020-10-29T00:00:00","2020-10-30T00:00:00","2020-10-31T00:00:00","2020-11-01T00:00:00","2020-11-02T00:00:00","2020-11-03T00:00:00","2020-11-04T00:00:00","2020-11-05T00:00:00","2020-11-06T00:00:00","2020-11-07T00:00:00","2020-11-08T00:00:00","2020-11-09T00:00:00","2020-11-10T00:00:00","2020-11-11T00:00:00","2020-11-12T00:00:00","2020-11-13T00:00:00","2020-11-14T00:00:00","2020-11-15T00:00:00","2020-11-16T00:00:00","2020-11-17T00:00:00","2020-11-18T00:00:00","2020-11-19T00:00:00","2020-11-20T00:00:00","2020-11-21T00:00:00","2020-11-22T00:00:00","2020-11-23T00:00:00","2020-11-24T00:00:00","2020-11-25T00:00:00","2020-11-26T00:00:00","2020-11-27T00:00:00","2020-11-28T00:00:00","2020-11-29T00:00:00","2020-11-30T00:00:00","2020-12-01T00:00:00","2020-12-02T00:00:00","2020-12-03T00:00:00","2020-12-04T00:00:00","2020-12-05T00:00:00","2020-12-06T00:00:00","2020-12-07T00:00:00","2020-12-08T00:00:00","2020-12-09T00:00:00","2020-12-10T00:00:00","2020-12-11T00:00:00","2020-12-12T00:00:00","2020-12-13T00:00:00","2020-12-14T00:00:00","2020-12-15T00:00:00","2020-12-16T00:00:00","2020-12-17T00:00:00","2020-12-18T00:00:00","2020-12-19T00:00:00","2020-12-20T00:00:00","2020-12-21T00:00:00","2020-12-22T00:00:00","2020-12-23T00:00:00","2020-12-24T00:00:00","2020-12-25T00:00:00","2020-12-26T00:00:00","2020-12-27T00:00:00","2020-12-28T00:00:00","2020-12-29T00:00:00","2020-12-30T00:00:00","2020-12-31T00:00:00"],"xaxis":"x","y":[185.0,151.0,165.0,173.0,163.0,161.0,147.0,143.0,141.0,135.0,157.0,171.0,136.0,148.0,134.0,142.0,142.0,168.0,165.0,137.0,128.0,150.0,149.0,142.0,156.0,178.0,146.0,142.0,148.0,139.0,156.0,157.0,175.0,144.0,143.0,148.0,143.0,152.0,155.0,174.0,157.0,151.0,148.0,147.0,146.0,177.0,181.0,157.0,141.0,136.0,148.0,164.0,175.0,180.0,153.0,153.0,156.0,152.0,148.0,192.0,161.0,138.0,147.0,138.0,127.0,138.0,160.0,160.0,129.0,137.0,130.0,144.0,142.0,165.0,160.0,149.0,142.0,139.0,132.0,147.0,150.0,153.0,131.0,133.0,144.0,138.0,137.0,165.0,181.0,129.0,142.0,127.0,113.0,126.0,128.0,137.0,113.0,123.0,121.0,107.0,113.0,136.0,137.0,122.0,127.0,140.0,137.0,155.0,149.0,148.0,128.0,115.0,113.0,107.0,114.0,128.0,136.0,111.0,115.0,110.0,117.0,134.0,147.0,143.0,140.0,133.0,150.0,131.0,135.0,143.0,146.0,124.0,121.0,115.0,129.0,116.0,144.0,141.0,115.0,124.0,129.0,119.0,135.0,135.0,153.0,137.0,129.0,126.0,121.0,127.0,134.0,125.0,133.0,124.0,143.0,138.0,149.0,145.0,150.0,126.0,140.0,124.0,124.0,128.0,144.0,140.0,118.0,115.0,128.0,112.0,113.0,147.0,131.0,111.0,122.0,115.0,119.0,121.0,132.0,134.0,118.0,112.0,121.0,125.0,133.0,142.0,140.0,127.0,125.0,116.0,117.0,123.0,132.0,142.0,116.0,129.0,115.0,120.0,122.0,135.0,140.0,103.0,108.0,119.0,105.0,113.0,129.0,136.0,108.0,99.0,111.0,100.0,102.0,117.0,121.0,113.0,121.0,111.0,107.0,111.0,119.0,122.0,108.0,98.0,110.0,91.0,119.0,115.0,123.0,86.0,98.0,105.0,103.0,100.0,104.0,127.0,104.0,94.0,108.0,107.0,101.0,110.0,106.0,98.0,100.0,107.0,98.0,99.0,120.0,125.0,94.0,99.0,94.0,93.0,107.0,108.0,126.0,86.0,93.0,90.0,105.0,107.0,113.0,96.0,93.0,85.0,91.0,90.0,109.0,108.0,110.0,96.0,99.0,99.0,100.0,108.0,103.0,133.0,106.0,106.0,112.0,104.0,111.0,125.0,126.0,94.0,100.0,100.0,95.0,110.0,111.0,131.0,92.0,98.0,95.0,98.0,109.0,119.0,122.0,104.0,91.0,97.0,96.0,105.0,111.0,114.0,95.0,97.0,106.0,96.0,107.0,125.0,118.0,107.0,105.0,98.0,99.0,103.0,118.0,138.0,112.0,111.0,104.0,113.0,108.0,131.0,127.0,109.0,110.0,108.0,112.0,116.0,119.0,135.0,121.0,109.0,117.0,121.0,112.0,123.0,127.0,112.0,117.0,118.0,109.0,116.0,128.0,150.0,104.0,116.0,110.0,112.0,124.0,138.0,161.0,114.0,127.0,118.0,122.0,123.0,172.0,195.0,198.0,225.0,245.0,218.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>date=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":["2020-01-01T00:00:00","2020-01-02T00:00:00","2020-01-03T00:00:00","2020-01-04T00:00:00","2020-01-05T00:00:00","2020-01-06T00:00:00","2020-01-07T00:00:00","2020-01-08T00:00:00","2020-01-09T00:00:00","2020-01-10T00:00:00","2020-01-11T00:00:00","2020-01-12T00:00:00","2020-01-13T00:00:00","2020-01-14T00:00:00","2020-01-15T00:00:00","2020-01-16T00:00:00","2020-01-17T00:00:00","2020-01-18T00:00:00","2020-01-19T00:00:00","2020-01-20T00:00:00","2020-01-21T00:00:00","2020-01-22T00:00:00","2020-01-23T00:00:00","2020-01-24T00:00:00","2020-01-25T00:00:00","2020-01-26T00:00:00","2020-01-27T00:00:00","2020-01-28T00:00:00","2020-01-29T00:00:00","2020-01-30T00:00:00","2020-01-31T00:00:00","2020-02-01T00:00:00","2020-02-02T00:00:00","2020-02-03T00:00:00","2020-02-04T00:00:00","2020-02-05T00:00:00","2020-02-06T00:00:00","2020-02-07T00:00:00","2020-02-08T00:00:00","2020-02-09T00:00:00","2020-02-10T00:00:00","2020-02-11T00:00:00","2020-02-12T00:00:00","2020-02-13T00:00:00","2020-02-14T00:00:00","2020-02-15T00:00:00","2020-02-16T00:00:00","2020-02-17T00:00:00","2020-02-18T00:00:00","2020-02-19T00:00:00","2020-02-20T00:00:00","2020-02-21T00:00:00","2020-02-22T00:00:00","2020-02-23T00:00:00","2020-02-24T00:00:00","2020-02-25T00:00:00","2020-02-26T00:00:00","2020-02-27T00:00:00","2020-02-28T00:00:00","2020-02-29T00:00:00","2020-03-01T00:00:00","2020-03-02T00:00:00","2020-03-03T00:00:00","2020-03-04T00:00:00","2020-03-05T00:00:00","2020-03-06T00:00:00","2020-03-07T00:00:00","2020-03-08T00:00:00","2020-03-09T00:00:00","2020-03-10T00:00:00","2020-03-11T00:00:00","2020-03-12T00:00:00","2020-03-13T00:00:00","2020-03-14T00:00:00","2020-03-15T00:00:00","2020-03-16T00:00:00","2020-03-17T00:00:00","2020-03-18T00:00:00","2020-03-19T00:00:00","2020-03-20T00:00:00","2020-03-21T00:00:00","2020-03-22T00:00:00","2020-03-23T00:00:00","2020-03-24T00:00:00","2020-03-25T00:00:00","2020-03-26T00:00:00","2020-03-27T00:00:00","2020-03-28T00:00:00","2020-03-29T00:00:00","2020-03-30T00:00:00","2020-03-31T00:00:00","2020-04-01T00:00:00","2020-04-02T00:00:00","2020-04-03T00:00:00","2020-04-04T00:00:00","2020-04-05T00:00:00","2020-04-06T00:00:00","2020-04-07T00:00:00","2020-04-08T00:00:00","2020-04-09T00:00:00","2020-04-10T00:00:00","2020-04-11T00:00:00","2020-04-12T00:00:00","2020-04-13T00:00:00","2020-04-14T00:00:00","2020-04-15T00:00:00","2020-04-16T00:00:00","2020-04-17T00:00:00","2020-04-18T00:00:00","2020-04-19T00:00:00","2020-04-20T00:00:00","2020-04-21T00:00:00","2020-04-22T00:00:00","2020-04-23T00:00:00","2020-04-24T00:00:00","2020-04-25T00:00:00","2020-04-26T00:00:00","2020-04-27T00:00:00","2020-04-28T00:00:00","2020-04-29T00:00:00","2020-04-30T00:00:00","2020-05-01T00:00:00","2020-05-02T00:00:00","2020-05-03T00:00:00","2020-05-04T00:00:00","2020-05-05T00:00:00","2020-05-06T00:00:00","2020-05-07T00:00:00","2020-05-08T00:00:00","2020-05-09T00:00:00","2020-05-10T00:00:00","2020-05-11T00:00:00","2020-05-12T00:00:00","2020-05-13T00:00:00","2020-05-14T00:00:00","2020-05-15T00:00:00","2020-05-16T00:00:00","2020-05-17T00:00:00","2020-05-18T00:00:00","2020-05-19T00:00:00","2020-05-20T00:00:00","2020-05-21T00:00:00","2020-05-22T00:00:00","2020-05-23T00:00:00","2020-05-24T00:00:00","2020-05-25T00:00:00","2020-05-26T00:00:00","2020-05-27T00:00:00","2020-05-28T00:00:00","2020-05-29T00:00:00","2020-05-30T00:00:00","2020-05-31T00:00:00","2020-06-01T00:00:00","2020-06-02T00:00:00","2020-06-03T00:00:00","2020-06-04T00:00:00","2020-06-05T00:00:00","2020-06-06T00:00:00","2020-06-07T00:00:00","2020-06-08T00:00:00","2020-06-09T00:00:00","2020-06-10T00:00:00","2020-06-11T00:00:00","2020-06-12T00:00:00","2020-06-13T00:00:00","2020-06-14T00:00:00","2020-06-15T00:00:00","2020-06-16T00:00:00","2020-06-17T00:00:00","2020-06-18T00:00:00","2020-06-19T00:00:00","2020-06-20T00:00:00","2020-06-21T00:00:00","2020-06-22T00:00:00","2020-06-23T00:00:00","2020-06-24T00:00:00","2020-06-25T00:00:00","2020-06-26T00:00:00","2020-06-27T00:00:00","2020-06-28T00:00:00","2020-06-29T00:00:00","2020-06-30T00:00:00","2020-07-01T00:00:00","2020-07-02T00:00:00","2020-07-03T00:00:00","2020-07-04T00:00:00","2020-07-05T00:00:00","2020-07-06T00:00:00","2020-07-07T00:00:00","2020-07-08T00:00:00","2020-07-09T00:00:00","2020-07-10T00:00:00","2020-07-11T00:00:00","2020-07-12T00:00:00","2020-07-13T00:00:00","2020-07-14T00:00:00","2020-07-15T00:00:00","2020-07-16T00:00:00","2020-07-17T00:00:00","2020-07-18T00:00:00","2020-07-19T00:00:00","2020-07-20T00:00:00","2020-07-21T00:00:00","2020-07-22T00:00:00","2020-07-23T00:00:00","2020-07-24T00:00:00","2020-07-25T00:00:00","2020-07-26T00:00:00","2020-07-27T00:00:00","2020-07-28T00:00:00","2020-07-29T00:00:00","2020-07-30T00:00:00","2020-07-31T00:00:00","2020-08-01T00:00:00","2020-08-02T00:00:00","2020-08-03T00:00:00","2020-08-04T00:00:00","2020-08-05T00:00:00","2020-08-06T00:00:00","2020-08-07T00:00:00","2020-08-08T00:00:00","2020-08-09T00:00:00","2020-08-10T00:00:00","2020-08-11T00:00:00","2020-08-12T00:00:00","2020-08-13T00:00:00","2020-08-14T00:00:00","2020-08-15T00:00:00","2020-08-16T00:00:00","2020-08-17T00:00:00","2020-08-18T00:00:00","2020-08-19T00:00:00","2020-08-20T00:00:00","2020-08-21T00:00:00","2020-08-22T00:00:00","2020-08-23T00:00:00","2020-08-24T00:00:00","2020-08-25T00:00:00","2020-08-26T00:00:00","2020-08-27T00:00:00","2020-08-28T00:00:00","2020-08-29T00:00:00","2020-08-30T00:00:00","2020-08-31T00:00:00","2020-09-01T00:00:00","2020-09-02T00:00:00","2020-09-03T00:00:00","2020-09-04T00:00:00","2020-09-05T00:00:00","2020-09-06T00:00:00","2020-09-07T00:00:00","2020-09-08T00:00:00","2020-09-09T00:00:00","2020-09-10T00:00:00","2020-09-11T00:00:00","2020-09-12T00:00:00","2020-09-13T00:00:00","2020-09-14T00:00:00","2020-09-15T00:00:00","2020-09-16T00:00:00","2020-09-17T00:00:00","2020-09-18T00:00:00","2020-09-19T00:00:00","2020-09-20T00:00:00","2020-09-21T00:00:00","2020-09-22T00:00:00","2020-09-23T00:00:00","2020-09-24T00:00:00","2020-09-25T00:00:00","2020-09-26T00:00:00","2020-09-27T00:00:00","2020-09-28T00:00:00","2020-09-29T00:00:00","2020-09-30T00:00:00","2020-10-01T00:00:00","2020-10-02T00:00:00","2020-10-03T00:00:00","2020-10-04T00:00:00","2020-10-05T00:00:00","2020-10-06T00:00:00","2020-10-07T00:00:00","2020-10-08T00:00:00","2020-10-09T00:00:00","2020-10-10T00:00:00","2020-10-11T00:00:00","2020-10-12T00:00:00","2020-10-13T00:00:00","2020-10-14T00:00:00","2020-10-15T00:00:00","2020-10-16T00:00:00","2020-10-17T00:00:00","2020-10-18T00:00:00","2020-10-19T00:00:00","2020-10-20T00:00:00","2020-10-21T00:00:00","2020-10-22T00:00:00","2020-10-23T00:00:00","2020-10-24T00:00:00","2020-10-25T00:00:00","2020-10-26T00:00:00","2020-10-27T00:00:00","2020-10-28T00:00:00","2020-10-29T00:00:00","2020-10-30T00:00:00","2020-10-31T00:00:00","2020-11-01T00:00:00","2020-11-02T00:00:00","2020-11-03T00:00:00","2020-11-04T00:00:00","2020-11-05T00:00:00","2020-11-06T00:00:00","2020-11-07T00:00:00","2020-11-08T00:00:00","2020-11-09T00:00:00","2020-11-10T00:00:00","2020-11-11T00:00:00","2020-11-12T00:00:00","2020-11-13T00:00:00","2020-11-14T00:00:00","2020-11-15T00:00:00","2020-11-16T00:00:00","2020-11-17T00:00:00","2020-11-18T00:00:00","2020-11-19T00:00:00","2020-11-20T00:00:00","2020-11-21T00:00:00","2020-11-22T00:00:00","2020-11-23T00:00:00","2020-11-24T00:00:00","2020-11-25T00:00:00","2020-11-26T00:00:00","2020-11-27T00:00:00","2020-11-28T00:00:00","2020-11-29T00:00:00","2020-11-30T00:00:00","2020-12-01T00:00:00","2020-12-02T00:00:00","2020-12-03T00:00:00","2020-12-04T00:00:00","2020-12-05T00:00:00","2020-12-06T00:00:00","2020-12-07T00:00:00","2020-12-08T00:00:00","2020-12-09T00:00:00","2020-12-10T00:00:00","2020-12-11T00:00:00","2020-12-12T00:00:00","2020-12-13T00:00:00","2020-12-14T00:00:00","2020-12-15T00:00:00","2020-12-16T00:00:00","2020-12-17T00:00:00","2020-12-18T00:00:00","2020-12-19T00:00:00","2020-12-20T00:00:00","2020-12-21T00:00:00","2020-12-22T00:00:00","2020-12-23T00:00:00","2020-12-24T00:00:00","2020-12-25T00:00:00","2020-12-26T00:00:00","2020-12-27T00:00:00","2020-12-28T00:00:00","2020-12-29T00:00:00","2020-12-30T00:00:00","2020-12-31T00:00:00"],"xaxis":"x","y":[180.18672966468597,169.62020175253556,146.66831733137568,151.18254633698479,175.13382264329397,168.4912198689006,153.6419786535307,148.83706371497271,139.25337873914972,139.92706751288418,151.9660936717208,149.0316014484915,157.07452993674366,143.39582736511565,127.26843913230925,148.15916518237105,137.1857162110501,150.27655784664663,164.51349499820708,157.71798614569704,153.18677812983597,139.09634866137495,138.03537828241994,149.0697000263032,163.58004019111004,180.89318926622389,172.29293851445192,158.74483795249623,137.52105946098507,156.732923396556,149.12000713868875,140.99142107449762,162.46878891840234,184.95205910042415,151.28852100616876,142.12622532058185,149.6085525240514,154.99269068342602,151.18163285853325,165.92692640477208,187.4158849853758,157.6223491360081,130.91258939936415,160.4722925795062,164.07194987293087,147.62040304744474,172.04639020937782,195.0855806298655,165.99286331262488,154.124358386439,161.52046308058834,167.67445992187302,163.41515972073773,180.41455089435647,190.79791283481467,169.6096348029307,158.03902769179143,156.12982467634959,160.75472337598507,158.93612023426246,187.62386853715464,202.0664524331982,171.80374451724452,162.01962109553295,157.0577791255219,152.39503625261392,163.45426388919654,186.7838783550725,193.14827021982717,157.43375093741258,156.31894952810825,173.64948260490377,147.23846689705377,165.49223279093692,168.0866268680655,191.9212397670842,164.2128630147284,149.99862616791077,161.17904718960085,167.29172111122637,178.38028143974967,196.35532222740315,192.0631183025066,173.67952668020692,148.81010583404682,172.2541846737329,146.23341797892257,164.61401693079245,190.87035705016336,194.40846830132372,188.26222274386444,146.01895193482414,178.73793753455544,191.55656901215144,190.11035817645782,192.45244285321735,208.74035918760802,181.83956757729425,147.3009387277675,156.0265469763201,167.776754493097,179.6940035236859,201.51187924617057,184.87948743491566,164.05582584973402,157.14444822820607,155.27147981749897,158.48433773606018,160.32221770632736,186.90289250034698,204.46164699594817,180.93266642432718,181.0920561706653,177.81284762010736,198.97040262230473,191.30874619388516,205.7894586401655,205.2411706466739,163.82803303064327,151.49468105914832,161.752762503377,165.15624828919326,179.8060900430497,197.3416477880553,203.7735866267406,188.08909792317957,165.82703141875396,180.22918368669698,155.71948589431412,165.4607078122664,180.50172440076204,178.64648971526708,188.2378304617545,158.1300243239826,162.84699107203448,164.43117090933018,172.3329260570229,186.74801449812585,198.2188484431835,160.34488615947615,152.72103297515642,158.36456411434494,162.7355718791692,156.60816356628536,183.03141844124409,190.32770064121027,162.28245803615695,137.70641525451623,168.69909866749074,145.21823048638612,154.20303442331263,180.75789999374456,189.71015092199934,179.28346604209872,161.90977525685767,155.11736880315956,158.70258294679218,169.8938145675856,175.57921395516766,167.54314929555773,145.9773339106766,128.81631856612248,150.18747845962446,158.88305078275323,168.77949303776998,186.2564675755935,192.184541821913,150.4785393259781,147.30265522142216,146.67083707087346,151.43735863082907,152.40247128018493,169.29564873836722,186.07100445385478,150.6016400585876,131.15906432259965,131.46346207056447,133.82880271418492,141.7582416881826,155.84036458907167,173.17995845823648,144.92212142713876,141.09957617770507,133.07439718213567,133.86053599116067,134.5132278539494,147.23168294834312,156.7112648470366,142.30020734391604,133.8457058995697,132.54617116287173,133.32612302943127,132.15445570566357,148.37804833971077,153.25199111403415,137.9635180614672,119.06501269676005,130.88271080759085,128.50850092917432,128.41000417466435,143.520458431292,153.1261493129408,141.17105596181736,122.45356756982059,122.11415037396989,118.11251971892733,120.32346608529288,143.2319449888486,154.3583989815102,131.3200382268976,116.10548288967126,123.8290994792898,127.14685688922506,130.79049144616886,137.37769797295638,133.04118812491197,129.9933515286028,115.6605218745627,117.06918013141251,126.8357696908565,135.60762055653873,131.8107602601392,132.77319209395904,128.01037011422994,105.22850758381259,114.7164764127696,118.53884229850142,117.72363255102056,129.39256000540104,124.98322257674509,131.5684785533835,106.48614157120551,113.5552643453801,111.93415434697529,119.35066271650149,125.4018853055628,135.10751866201696,118.39445113323876,112.33773709012851,109.69663437435196,113.43616447392431,115.27079530959026,129.87316538536948,127.93334376900953,113.66039003983298,110.7182707408895,118.18078204726882,113.91451073521063,109.91533738601413,128.25923962837794,134.60399950559136,113.76778145036465,108.13201585413532,113.9095002468622,106.4666653382757,114.48675802188659,131.74868835304937,137.67485937987612,125.40177109834292,103.66060613106671,112.13901652931747,105.25974869226118,111.32143787272899,120.08769050306263,138.08274425517033,113.2335279262499,108.54373266138886,105.3274368871324,102.59686295324525,115.21624565298563,125.25957973218226,129.34614161129187,117.30065282688061,94.15962910051877,101.60945583584899,105.43913936724424,115.73993186970614,138.73782963474017,147.33807917965652,133.78182144890167,122.97461591661924,127.82431337463613,116.23343093514757,120.08679766143298,119.75071900966395,145.4495267612367,121.37628185937487,102.70493400576075,101.4471258160435,120.23406098188582,110.78316224986438,123.00692544273457,124.25054280697185,122.64665714412077,101.0997383559806,111.22729856418096,110.5729014401352,113.73346242967429,123.94228496219998,137.20833216250276,116.37742274800453,110.48771391005349,115.53905514249087,105.22828960856823,122.77963338062716,134.01858118460822,132.22979114728602,123.97834632084553,107.52152886202455,121.71655597877155,114.16625355688507,118.68782186551726,134.23539120365925,134.01787913911343,120.0766502445156,120.45398446030124,110.13617025070474,119.82372900129964,114.43955069886609,135.04951846455677,149.57002580741025,122.90783510508764,111.9861161808748,117.15215444630974,122.36150335123051,126.64186445080989,133.16250076218745,155.52315121740807,125.84393169003766,118.71541561392061,124.84949773790174,123.21704106498132,130.05178434404982,144.68557527230575,143.76537177508663,127.89343377329342,125.7623083984888,115.06737368744172,127.1970283960373,134.9591457841229,146.48937164378773,153.90395377122078,142.5436351796227,113.45539119386362,138.12525624469365,124.65292484640986,133.7656320078698,145.16064483067467,150.320412692923,140.73867307205498,118.84114311293159,127.08756172109092,122.7552142606288,131.58287609513977,149.54099498047248,153.85924702696732,149.94458886663915,136.97533406837138,146.2537485935579,154.85884725258126,189.73908131352366,254.9704955925914,294.72586268861505,235.97694835593538,225.57644067071703,193.32807198442487],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"date"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"STL-ARIMA Forecasts with (7,0,7)"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('00e2e109-aad5-4b9c-856d-a33a218fdde9');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">

<table class="simpletable">
<caption>STL Decomposition and SARIMAX Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>   <td>1095</td>   
</tr>
<tr>
  <th>Model:</th>            <td>ARIMA(7, 0, 7)</td>  <th>  Log Likelihood     </th> <td>-3374.872</td>
</tr>
<tr>
  <th>Date:</th>            <td>Sun, 18 Dec 2022</td> <th>  AIC                </th> <td>6781.743</td> 
</tr>
<tr>
  <th>Time:</th>                <td>12:13:38</td>     <th>  BIC                </th> <td>6861.719</td> 
</tr>
<tr>
  <th>Sample:</th>             <td>01-01-2017</td>    <th>  HQIC               </th> <td>6812.005</td> 
</tr>
<tr>
  <th></th>                   <td>- 12-31-2019</td>   <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P&gt;|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>x1</th>     <td>    0.0307</td> <td>    0.042</td> <td>    0.725</td> <td> 0.468</td> <td>   -0.052</td> <td>    0.114</td>
</tr>
<tr>
  <th>ar.L1</th>  <td>   -0.5356</td> <td>    0.018</td> <td>  -29.124</td> <td> 0.000</td> <td>   -0.572</td> <td>   -0.500</td>
</tr>
<tr>
  <th>ar.L2</th>  <td>   -0.5941</td> <td>    0.025</td> <td>  -24.214</td> <td> 0.000</td> <td>   -0.642</td> <td>   -0.546</td>
</tr>
<tr>
  <th>ar.L3</th>  <td>   -0.2172</td> <td>    0.022</td> <td>   -9.847</td> <td> 0.000</td> <td>   -0.260</td> <td>   -0.174</td>
</tr>
<tr>
  <th>ar.L4</th>  <td>    0.3197</td> <td>    0.016</td> <td>   19.906</td> <td> 0.000</td> <td>    0.288</td> <td>    0.351</td>
</tr>
<tr>
  <th>ar.L5</th>  <td>    0.6246</td> <td>    0.022</td> <td>   28.755</td> <td> 0.000</td> <td>    0.582</td> <td>    0.667</td>
</tr>
<tr>
  <th>ar.L6</th>  <td>    0.4675</td> <td>    0.024</td> <td>   19.285</td> <td> 0.000</td> <td>    0.420</td> <td>    0.515</td>
</tr>
<tr>
  <th>ar.L7</th>  <td>    0.9349</td> <td>    0.018</td> <td>   52.310</td> <td> 0.000</td> <td>    0.900</td> <td>    0.970</td>
</tr>
<tr>
  <th>ma.L1</th>  <td>    0.8207</td> <td>    0.022</td> <td>   36.479</td> <td> 0.000</td> <td>    0.777</td> <td>    0.865</td>
</tr>
<tr>
  <th>ma.L2</th>  <td>    1.0375</td> <td>    0.034</td> <td>   30.775</td> <td> 0.000</td> <td>    0.971</td> <td>    1.104</td>
</tr>
<tr>
  <th>ma.L3</th>  <td>    0.7876</td> <td>    0.045</td> <td>   17.633</td> <td> 0.000</td> <td>    0.700</td> <td>    0.875</td>
</tr>
<tr>
  <th>ma.L4</th>  <td>    0.3276</td> <td>    0.046</td> <td>    7.110</td> <td> 0.000</td> <td>    0.237</td> <td>    0.418</td>
</tr>
<tr>
  <th>ma.L5</th>  <td>   -0.1245</td> <td>    0.040</td> <td>   -3.140</td> <td> 0.002</td> <td>   -0.202</td> <td>   -0.047</td>
</tr>
<tr>
  <th>ma.L6</th>  <td>   -0.1949</td> <td>    0.029</td> <td>   -6.761</td> <td> 0.000</td> <td>   -0.251</td> <td>   -0.138</td>
</tr>
<tr>
  <th>ma.L7</th>  <td>   -0.6672</td> <td>    0.021</td> <td>  -32.522</td> <td> 0.000</td> <td>   -0.707</td> <td>   -0.627</td>
</tr>
<tr>
  <th>sigma2</th> <td>   27.4791</td> <td>    0.830</td> <td>   33.092</td> <td> 0.000</td> <td>   25.852</td> <td>   29.107</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.21</td> <th>  Jarque-Bera (JB):  </th> <td>359.53</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.65</td> <th>  Prob(JB):          </th>  <td>0.00</td> 
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>1.08</td> <th>  Skew:              </th>  <td>0.07</td> 
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.47</td> <th>  Kurtosis:          </th>  <td>5.80</td> 
</tr>
</tbody></table>
<table class="simpletable">
<caption>STL Configuration</caption>
<tbody><tr>
  <th>Period:                </th> <td>          365</td> <th>      Trend Length:          </th> <td>         1095</td>
</tr>
<tr>
  <th>Seasonal:              </th> <td>            7</td> <th>      Trend deg:             </th> <td>            1</td>
</tr>
<tr>
  <th>Seasonal deg:          </th> <td>            1</td> <th>      Trend jump:            </th> <td>            1</td>
</tr>
<tr>
  <th>Seasonal jump:         </th> <td>            1</td> <th>      Low pass:              </th> <td>          367</td>
</tr>
<tr>
  <th>Robust:                </th> <td>        False</td> <th>      Low pass deg:          </th> <td>            1</td>
</tr>
</tbody></table><br><br>Warnings:<br>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</div>
</div>
<p>Finally calculate the mean absolute percentage error (MAPE) and R2 Score as a benchmark.</p>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_percentage_error, r2_score</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for STL-ARIMA model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_subset_pretuning, forecast)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for STL-ARIMA model is: </span><span class="sc">{</span>r2_score(test_subset_pretuning, forecast)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for STL-ARIMA model is: 0.18646794982275017
R2 Score for STL-ARIMA model is: -0.6091132358371121</code></pre>
</div>
</div>
</section>
<section id="forecasting-with-exogenous-regressors" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="forecasting-with-exogenous-regressors"><span class="header-section-number">3.2</span> Forecasting with Exogenous Regressors</h2>
<p>Now we will move to the forecasting which uses exogenous variables as features. To achieve that, firstly, we will convert the datetime of the series to tabular features and then add holidays. We will also use some libraries dedicated to feature extraction from time series.</p>
<section id="arimax" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="arimax"><span class="header-section-number">3.2.1</span> ARIMAX</h3>
<p>For ARIMAX model, we will create a <code>feature_matrix</code> which has the date related features and lagged values as predictors.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> featuretools <span class="im">as</span> ft</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, OneHotEncoder</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holidays</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.deterministic <span class="im">import</span> Fourier</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># First we will create an EntitySet</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>entity_set <span class="op">=</span> ft.EntitySet()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.sort_values(by<span class="op">=</span>[<span class="st">"country"</span>, <span class="st">"store"</span>, <span class="st">"product"</span>, <span class="st">"date"</span>])</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify index and time_index columns</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>entity_set.add_dataframe(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    dataframe_name<span class="op">=</span><span class="st">"Datetime Features"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    dataframe<span class="op">=</span>data,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"row_id"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    time_index<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>feature_matrix, feature_defs <span class="op">=</span> ft.dfs(</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    entityset<span class="op">=</span>entity_set,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    target_dataframe_name<span class="op">=</span><span class="st">"Datetime Features"</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    trans_primitives<span class="op">=</span>[<span class="st">"DAY"</span>, <span class="st">"MONTH"</span>, <span class="st">"WEEKDAY"</span>, <span class="st">"YEAR"</span>],</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Label encode the year column</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>year_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>feature_matrix[<span class="st">"YEAR(date)"</span>] <span class="op">=</span> year_encoder.fit_transform(feature_matrix[<span class="st">"YEAR(date)"</span>])</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the holidays for each country</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>holidays_country <span class="op">=</span> [holidays.country_holidays(i) <span class="cf">for</span> i <span class="kw">in</span> data[<span class="st">"country"</span>].unique()]</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the original date column for comparison</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>feature_matrix[<span class="st">"date"</span>] <span class="op">=</span> to_datetime(data[<span class="st">"date"</span>])</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co">Check dates for local holidays. </span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="co">If there is a holiday on the date add their local name to holiday_name, else add "No Holiday".</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>holiday_name <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_matrix)):</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"Belgium"</span>:</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">0</span>]:</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">0</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"France"</span>:</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">1</span>]:</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">1</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"Germany"</span>:</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">2</span>]:</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">2</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"Italy"</span>:</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">3</span>]:</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">3</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"Poland"</span>:</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">4</span>]:</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">4</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> feature_matrix[<span class="st">"country"</span>][i] <span class="op">==</span> <span class="st">"Spain"</span>:</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_matrix[<span class="st">"date"</span>][i] <span class="kw">in</span> holidays_country[<span class="dv">5</span>]:</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(holidays_country[<span class="dv">5</span>].get(feature_matrix[<span class="st">"date"</span>][i]))</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>            holiday_name.append(<span class="st">"No Holiday"</span>)</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>feature_matrix[<span class="st">"HolidayName"</span>] <span class="op">=</span> holiday_name</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataframe so that date is sequential</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>feature_matrix <span class="op">=</span> feature_matrix.sort_values(</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span>[<span class="st">"country"</span>, <span class="st">"store"</span>, <span class="st">"product"</span>, <span class="st">"date"</span>], ignore_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="co">Check for the closeness of days to holidays. If a day is in the spectrum of 3 days before -</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="co">3 days after of a holiday, label it as Close.</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>holiday_closeness <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_matrix)):</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_matrix[<span class="st">"HolidayName"</span>][i] <span class="op">!=</span> <span class="st">"No Holiday"</span>:</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>        holiday_closeness.append(<span class="st">"Holiday"</span>)</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">list</span>(<span class="st">"No Holiday"</span> <span class="op">==</span> feature_matrix[<span class="st">"HolidayName"</span>][i <span class="op">-</span> <span class="dv">3</span> : i <span class="op">+</span> <span class="dv">4</span>])) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>            holiday_closeness.append(<span class="st">"Close"</span>)</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">False</span> <span class="kw">in</span> <span class="bu">list</span>(</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">"No Holiday"</span> <span class="op">==</span> feature_matrix[<span class="st">"HolidayName"</span>][i <span class="op">-</span> <span class="dv">3</span> : i <span class="op">+</span> <span class="dv">4</span>]</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>            holiday_closeness.append(<span class="st">"Close"</span>)</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>            holiday_closeness.append(<span class="st">"Distant"</span>)</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>feature_matrix[<span class="st">"HolidayCloseness"</span>] <span class="op">=</span> holiday_closeness</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode holiday closeness</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>feature_matrix <span class="op">=</span> pandas.get_dummies(</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>    feature_matrix,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country"</span>,</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"store"</span>,</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product"</span>,</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DAY(date)"</span>,</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">"MONTH(date)"</span>,</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">"WEEKDAY(date)"</span>,</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">"YEAR(date)"</span>,</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HolidayCloseness"</span>,</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>    drop_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic Fourier Terms</span></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a><span class="co">## Yearly</span></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>yearly_fourier_terms <span class="op">=</span> Fourier(<span class="dv">365</span>, <span class="dv">3</span>)</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1461</span>)</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>yearly_fourier_terms <span class="op">=</span> yearly_fourier_terms.in_sample(index)</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>cloning_func <span class="op">=</span> <span class="kw">lambda</span> x: np.tile(x, <span class="dv">48</span>)</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>yearly_fourier_terms <span class="op">=</span> yearly_fourier_terms.<span class="bu">apply</span>(func<span class="op">=</span>cloning_func, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>feature_matrix <span class="op">=</span> feature_matrix.join(yearly_fourier_terms, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit columns</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>feature_matrix <span class="op">=</span> pandas.DataFrame.join(</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>    feature_matrix.drop(columns<span class="op">=</span>[<span class="st">"num_sold"</span>, <span class="st">"HolidayName"</span>]),</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>    feature_matrix[<span class="st">"num_sold"</span>],</span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>feature_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th>country_France</th>
      <th>country_Germany</th>
      <th>country_Italy</th>
      <th>country_Poland</th>
      <th>country_Spain</th>
      <th>store_KaggleRama</th>
      <th>product_Kaggle Getting Started</th>
      <th>product_Kaggle Recipe Book</th>
      <th>product_Kaggle for Kids: One Smart Goose</th>
      <th>...</th>
      <th>YEAR(date)_3</th>
      <th>HolidayCloseness_Distant</th>
      <th>HolidayCloseness_Holiday</th>
      <th>sin(1,365)</th>
      <th>cos(1,365)</th>
      <th>sin(2,365)</th>
      <th>cos(2,365)</th>
      <th>sin(3,365)</th>
      <th>cos(3,365)</th>
      <th>num_sold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0.000000e+00</td>
      <td>1.000000</td>
      <td>0.000000e+00</td>
      <td>1.000000</td>
      <td>0.000000e+00</td>
      <td>1.000000</td>
      <td>663</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017-01-02</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.721336e-02</td>
      <td>0.999852</td>
      <td>3.442161e-02</td>
      <td>0.999407</td>
      <td>5.161967e-02</td>
      <td>0.998667</td>
      <td>514</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-01-03</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.442161e-02</td>
      <td>0.999407</td>
      <td>6.880243e-02</td>
      <td>0.997630</td>
      <td>1.031017e-01</td>
      <td>0.994671</td>
      <td>549</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-01-04</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.161967e-02</td>
      <td>0.998667</td>
      <td>1.031017e-01</td>
      <td>0.994671</td>
      <td>1.543088e-01</td>
      <td>0.988023</td>
      <td>477</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-01-05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>6.880243e-02</td>
      <td>0.997630</td>
      <td>1.372788e-01</td>
      <td>0.990532</td>
      <td>2.051045e-01</td>
      <td>0.978740</td>
      <td>447</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>70123</th>
      <td>2020-12-27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>-6.880243e-02</td>
      <td>0.997630</td>
      <td>-1.372788e-01</td>
      <td>0.990532</td>
      <td>-2.051045e-01</td>
      <td>0.978740</td>
      <td>204</td>
    </tr>
    <tr>
      <th>70124</th>
      <td>2020-12-28</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>-5.161967e-02</td>
      <td>0.998667</td>
      <td>-1.031017e-01</td>
      <td>0.994671</td>
      <td>-1.543088e-01</td>
      <td>0.988023</td>
      <td>212</td>
    </tr>
    <tr>
      <th>70125</th>
      <td>2020-12-29</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>-3.442161e-02</td>
      <td>0.999407</td>
      <td>-6.880243e-02</td>
      <td>0.997630</td>
      <td>-1.031017e-01</td>
      <td>0.994671</td>
      <td>242</td>
    </tr>
    <tr>
      <th>70126</th>
      <td>2020-12-30</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>-1.721336e-02</td>
      <td>0.999852</td>
      <td>-3.442161e-02</td>
      <td>0.999407</td>
      <td>-5.161967e-02</td>
      <td>0.998667</td>
      <td>239</td>
    </tr>
    <tr>
      <th>70127</th>
      <td>2020-12-31</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>-9.797174e-16</td>
      <td>1.000000</td>
      <td>-1.959435e-15</td>
      <td>1.000000</td>
      <td>-2.939152e-15</td>
      <td>1.000000</td>
      <td>202</td>
    </tr>
  </tbody>
</table>
<p>70128 rows × 69 columns</p>
</div>
</div>
</div>
<p>The feature matrix is almost ready for use in ARIMAX model. To summarize what we have done so far regarding the features, we have transformed the time points to categorical variables - day of the month, weekday, and year and added holidays. To better account for the effect of holidays, we have created three dummy holidays variables: Close, Distant and Holiday. Then to capture yearly seasonality we have added Fourier terms with period of 365. After creating the subset we can discard the country, product and store variables since we are training the models for each combination and they add nothing of value for forecasting in this case.</p>
<p>Let’s create the ARIMAX model and forecast with the same subset.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.statespace.sarimax <span class="im">import</span> SARIMAX</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the same subset but this time with features.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>subset_reg <span class="op">=</span> feature_matrix[</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    (feature_matrix[<span class="st">"country_Germany"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (feature_matrix[<span class="st">"store_KaggleRama"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (feature_matrix[<span class="st">"product_Kaggle Recipe Book"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>subset_reg <span class="op">=</span> subset_reg.drop(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_France"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Germany"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Poland"</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Italy"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Spain"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"store_KaggleRama"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Getting Started"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Recipe Book"</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle for Kids: One Smart Goose"</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Train - Test Split</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>train_reg, test_reg <span class="op">=</span> temporal_train_test_split(subset_reg, test_size<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Define endogenous and exogenous variables</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>endog <span class="op">=</span> train_reg[<span class="st">"num_sold"</span>]</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>exog <span class="op">=</span> train_reg.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the same orders as previous ARIMA model</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>arimax_model <span class="op">=</span> ARIMA(</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    order<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>), endog<span class="op">=</span>endog, trend<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>], exog<span class="op">=</span>exog, enforce_stationarity<span class="op">=</span><span class="va">True</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>arimax_results <span class="op">=</span> arimax_model.fit()</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the last year</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>forecast_reg <span class="op">=</span> arimax_results.forecast(<span class="dv">366</span>, exog<span class="op">=</span>test_reg.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>))</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>test_reg <span class="op">=</span> test_reg.set_index(forecast_reg.index)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>plot_forecasts(test_reg[<span class="st">"num_sold"</span>], forecast_reg, title<span class="op">=</span><span class="st">"ARIMAX Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="1d909d81-49db-4865-9367-9759e727a8c5" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("1d909d81-49db-4865-9367-9759e727a8c5")) {                    Plotly.newPlot(                        "1d909d81-49db-4865-9367-9759e727a8c5",                        [{"hovertemplate":"=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":[1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1139,1140,1141,1142,1143,1144,1145,1146,1147,1148,1149,1150,1151,1152,1153,1154,1155,1156,1157,1158,1159,1160,1161,1162,1163,1164,1165,1166,1167,1168,1169,1170,1171,1172,1173,1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223,1224,1225,1226,1227,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,1249,1250,1251,1252,1253,1254,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1286,1287,1288,1289,1290,1291,1292,1293,1294,1295,1296,1297,1298,1299,1300,1301,1302,1303,1304,1305,1306,1307,1308,1309,1310,1311,1312,1313,1314,1315,1316,1317,1318,1319,1320,1321,1322,1323,1324,1325,1326,1327,1328,1329,1330,1331,1332,1333,1334,1335,1336,1337,1338,1339,1340,1341,1342,1343,1344,1345,1346,1347,1348,1349,1350,1351,1352,1353,1354,1355,1356,1357,1358,1359,1360,1361,1362,1363,1364,1365,1366,1367,1368,1369,1370,1371,1372,1373,1374,1375,1376,1377,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1389,1390,1391,1392,1393,1394,1395,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,1425,1426,1427,1428,1429,1430,1431,1432,1433,1434,1435,1436,1437,1438,1439,1440,1441,1442,1443,1444,1445,1446,1447,1448,1449,1450,1451,1452,1453,1454,1455,1456,1457,1458,1459,1460],"xaxis":"x","y":[142.0,98.0,109.0,102.0,116.0,99.0,83.0,90.0,84.0,91.0,93.0,113.0,78.0,89.0,87.0,88.0,89.0,101.0,101.0,82.0,92.0,88.0,91.0,90.0,102.0,99.0,89.0,88.0,90.0,85.0,89.0,103.0,104.0,87.0,84.0,83.0,86.0,91.0,102.0,97.0,91.0,85.0,87.0,88.0,85.0,92.0,91.0,84.0,83.0,83.0,81.0,82.0,89.0,105.0,83.0,83.0,81.0,76.0,80.0,99.0,86.0,78.0,77.0,70.0,72.0,70.0,86.0,86.0,67.0,75.0,73.0,71.0,73.0,78.0,93.0,69.0,67.0,66.0,74.0,76.0,80.0,92.0,72.0,71.0,69.0,69.0,66.0,76.0,73.0,65.0,72.0,61.0,55.0,56.0,60.0,69.0,55.0,54.0,59.0,58.0,60.0,69.0,71.0,56.0,64.0,64.0,59.0,66.0,74.0,76.0,52.0,55.0,48.0,54.0,55.0,57.0,66.0,57.0,55.0,53.0,55.0,59.0,69.0,75.0,65.0,63.0,67.0,68.0,63.0,67.0,69.0,64.0,56.0,52.0,56.0,62.0,69.0,68.0,57.0,58.0,60.0,58.0,61.0,74.0,75.0,65.0,63.0,61.0,62.0,68.0,65.0,68.0,65.0,63.0,60.0,62.0,70.0,75.0,79.0,63.0,63.0,60.0,69.0,64.0,70.0,70.0,61.0,56.0,60.0,58.0,62.0,75.0,74.0,57.0,65.0,58.0,59.0,59.0,73.0,73.0,60.0,66.0,68.0,65.0,65.0,70.0,77.0,62.0,66.0,67.0,70.0,67.0,69.0,68.0,64.0,65.0,61.0,61.0,68.0,69.0,76.0,56.0,63.0,64.0,59.0,66.0,75.0,76.0,61.0,64.0,65.0,60.0,69.0,76.0,79.0,67.0,66.0,70.0,64.0,64.0,81.0,78.0,70.0,64.0,69.0,70.0,61.0,78.0,78.0,71.0,67.0,77.0,72.0,72.0,71.0,78.0,69.0,73.0,69.0,69.0,67.0,80.0,86.0,66.0,70.0,70.0,72.0,75.0,86.0,83.0,71.0,63.0,72.0,71.0,67.0,81.0,82.0,73.0,65.0,77.0,61.0,81.0,89.0,79.0,69.0,76.0,68.0,76.0,77.0,82.0,91.0,68.0,71.0,71.0,82.0,72.0,90.0,103.0,77.0,80.0,86.0,90.0,86.0,94.0,98.0,78.0,77.0,77.0,84.0,89.0,95.0,102.0,80.0,84.0,84.0,80.0,71.0,81.0,99.0,79.0,76.0,79.0,81.0,86.0,100.0,96.0,76.0,74.0,86.0,82.0,76.0,91.0,100.0,80.0,87.0,80.0,81.0,87.0,97.0,104.0,79.0,76.0,87.0,76.0,86.0,98.0,95.0,76.0,88.0,82.0,83.0,91.0,87.0,90.0,84.0,83.0,83.0,82.0,87.0,85.0,107.0,85.0,80.0,88.0,78.0,86.0,99.0,98.0,86.0,82.0,84.0,89.0,85.0,102.0,90.0,79.0,83.0,87.0,84.0,94.0,122.0,131.0,126.0,157.0,169.0,143.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":[1095,1096,1097,1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1139,1140,1141,1142,1143,1144,1145,1146,1147,1148,1149,1150,1151,1152,1153,1154,1155,1156,1157,1158,1159,1160,1161,1162,1163,1164,1165,1166,1167,1168,1169,1170,1171,1172,1173,1174,1175,1176,1177,1178,1179,1180,1181,1182,1183,1184,1185,1186,1187,1188,1189,1190,1191,1192,1193,1194,1195,1196,1197,1198,1199,1200,1201,1202,1203,1204,1205,1206,1207,1208,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1223,1224,1225,1226,1227,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242,1243,1244,1245,1246,1247,1248,1249,1250,1251,1252,1253,1254,1255,1256,1257,1258,1259,1260,1261,1262,1263,1264,1265,1266,1267,1268,1269,1270,1271,1272,1273,1274,1275,1276,1277,1278,1279,1280,1281,1282,1283,1284,1285,1286,1287,1288,1289,1290,1291,1292,1293,1294,1295,1296,1297,1298,1299,1300,1301,1302,1303,1304,1305,1306,1307,1308,1309,1310,1311,1312,1313,1314,1315,1316,1317,1318,1319,1320,1321,1322,1323,1324,1325,1326,1327,1328,1329,1330,1331,1332,1333,1334,1335,1336,1337,1338,1339,1340,1341,1342,1343,1344,1345,1346,1347,1348,1349,1350,1351,1352,1353,1354,1355,1356,1357,1358,1359,1360,1361,1362,1363,1364,1365,1366,1367,1368,1369,1370,1371,1372,1373,1374,1375,1376,1377,1378,1379,1380,1381,1382,1383,1384,1385,1386,1387,1388,1389,1390,1391,1392,1393,1394,1395,1396,1397,1398,1399,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1419,1420,1421,1422,1423,1424,1425,1426,1427,1428,1429,1430,1431,1432,1433,1434,1435,1436,1437,1438,1439,1440,1441,1442,1443,1444,1445,1446,1447,1448,1449,1450,1451,1452,1453,1454,1455,1456,1457,1458,1459,1460],"xaxis":"x","y":[158.652329057326,151.8187186626335,154.27568675571143,159.47901243563354,162.9362607120949,143.23108172415448,141.79406652567474,138.0144601100334,136.40276511734274,138.13523789021903,145.5225062067455,149.39106046328666,134.35557295769877,130.7114766838157,129.9031259641394,129.9881002437904,133.90066854998685,141.38369204701485,146.99931247749484,129.39037203993857,127.07491875816376,127.15648867450659,126.53630874922914,131.9242394450186,139.15699800901172,146.3833041294262,130.32682274031515,130.88946163715065,134.39884543649634,133.7548629470119,135.04152539367738,144.2791272211499,147.89490599195614,130.81944116245836,130.27870158749732,128.13995614536498,128.12946217795877,133.2078970891415,138.3112389195732,143.3589527315586,124.0523024137155,122.9896623698393,121.35602958463687,124.26610694896485,126.0213386034523,132.92418430880326,138.85015192974575,120.93709493330454,119.39786517018462,118.99447486619714,118.95167155982298,121.7121452393425,129.27339443691716,134.31141183714018,117.75426311792839,115.88492490852563,117.05695809744465,118.56233259150903,124.22835704823721,135.26844336907203,143.60089284724882,123.54174378571808,122.88959963384627,123.54353200852215,121.39890576458069,125.40454175593246,134.15531568831636,137.50271410402468,119.02826093219616,116.29881274443719,116.5849597410356,115.0989208531087,122.17720665812928,127.75473383353068,133.04882481473396,115.59643537623435,114.40045879385255,114.34544460199506,114.2201541398936,118.47070284097259,125.17285105200233,131.23858889078798,113.00501880315406,113.2649375283102,112.9727406794351,114.5084876441282,120.38529383056083,130.06334295735485,139.67037023635353,121.54106840814993,117.83709145685134,116.317084616071,114.39161672853339,119.40137815596299,128.12816460535302,132.23794790464473,114.89002883551619,113.60710866972833,111.46885433127298,111.1071513999806,113.17054922728099,122.3313510797611,127.05368308676367,111.8847147136843,109.7206830616719,109.45958181589766,110.04302803173357,115.90992734437827,123.7990930294311,129.78478801612653,112.52410463679871,110.5356021561752,110.93114803404006,110.61325194253504,116.29666333782548,123.81930774940945,131.33271034230074,115.56137564683993,114.8942698442633,118.6883103318933,118.3295953216412,123.05138734664999,129.60832705783676,136.42340240428194,119.69584884295861,118.13426594359794,118.40769904255619,119.76822491045877,121.51696514004122,128.65704501737775,133.22669870431918,115.95760994102218,113.36135810895976,116.52413081577703,114.52419674996096,118.02911216526388,125.99804126955094,131.90586857487253,112.58441784202276,111.15130798267576,111.2885165585909,109.37615972721402,114.29593778099363,121.28892204130707,128.4601300548059,111.74071087212786,111.78242503251838,113.36370981321198,115.0892954341424,121.02389176781737,127.95443507745446,131.001270018393,114.86460054279831,112.13820970334245,112.71363724612763,113.35728965976315,116.70141125948385,124.30019296911007,131.17871228100552,110.85092998082584,108.76455288681257,107.15939060281657,107.33414308139777,109.72385793992561,120.29967065881542,123.91263227109181,105.44289978211337,104.29396107906904,104.14199955663966,103.89999846324113,107.57985771781998,115.262612586312,119.94043688887086,102.18841782145333,100.21043509416631,101.47280266555904,100.95855827122,106.27108900877667,115.55859944106967,123.19783580113719,108.97975872386846,107.10594550672565,107.94420991620913,105.78761980352763,110.57319831349261,119.08383202504291,122.9865721584212,105.44178424446392,105.48765432411466,103.17599989539556,102.65414661596972,105.41123800314371,113.60166711483663,118.2093294547561,103.78227267040745,100.69871824900126,100.37631604056625,100.91782190751223,105.2484162534202,113.136453405677,119.14237489976526,101.92383849143384,99.99991616148102,100.48293378506364,100.2758037055664,106.09362101671674,113.77459871976035,121.4704903140355,105.90596871837084,106.98454569926018,111.03430981784669,110.95578243473886,112.83293569356164,119.32751931345878,123.5832855565613,107.17177131355433,107.31812398477024,105.88869322760883,106.60863370716898,112.43742863490642,118.30973426387665,124.1436171938632,105.63885359154318,105.39227077904857,104.58725758917912,108.33686662744873,110.94085273311875,118.69996042137542,125.48796145274392,108.44096214763596,107.77006189244085,108.23552304208111,109.06035161903034,112.68551116296503,121.1067943582677,126.99851452883476,111.28708967166864,110.25388567062541,112.25089440862722,114.56856325247026,121.03272917862932,132.85538751047207,138.7089056584537,118.88902765516616,115.05721072085639,113.44569282291968,114.74834166678973,120.11308233897353,126.29062154900942,132.77840689734307,116.74813575580072,113.57850541024436,113.38870348514781,112.4451553384075,117.2678779786073,123.92501886774784,133.30231360846346,113.91210868507102,112.49955352449388,113.13989019236513,113.53620792805005,117.82311306643527,125.64592651862576,132.0006190727449,113.54100874842325,112.70753631818721,112.37620825637669,114.04062737474322,117.90584688922459,127.20907560495658,135.01386155623766,119.35900925048745,121.90125197367189,120.00027893524631,120.27157947621536,122.33405530737951,130.11044568106013,137.8182634476338,118.26818689539664,117.3263945789603,120.21847744337757,117.99550390651149,121.542085519916,127.98201284410553,134.38583818688744,115.4003193059282,117.44006646847072,115.55662464052705,115.19611362380596,119.68446699467057,127.58182703167513,133.57300648993902,115.88159184411585,115.03206886717527,114.2170803791715,114.57765082893059,118.240079505677,127.5546126198616,133.2760903053156,117.21955867654057,117.97664488093389,120.12453589257476,124.02010105169971,127.78730844680058,133.14531849658653,139.66267017681315,120.16610446067216,120.08422889161128,121.31581195935078,119.75590727502704,124.35301686680879,133.70169054563297,137.65308239498538,119.78837781324074,117.67408925549535,118.58045769801505,117.71934821442396,125.42691336017373,131.6377080919336,137.5686898878001,120.75644678786418,120.20350201291924,120.79403317545064,121.31642827653758,126.21642844275499,133.56941918932944,140.28701571802313,122.70594591003845,123.61863272261476,123.9790991956454,126.16703377246463,132.6951829600994,143.02336402647404,153.2789485831772,135.79626901310638,139.49943894415674,138.1919475049038,139.81735892498753,145.5231062656986,152.05934086661492,158.9228927927129,143.2847810630052,140.52296530702102,140.75583786514903,140.24897301701645,145.5214828855573,152.64055837480004,162.49092913503017,143.58388871891285,142.6634891884985,143.80383348193988,144.70683273685066,149.50587911102627,157.8450462652445,164.71902776163512,146.78033760324246,144.9536512341894,145.14250296626187,147.32469329843633,150.86427890219426,160.67631821608205,169.82296524230634,154.66239034812136,157.68954952024353,157.77717817818547,155.78686436594762],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"index"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"ARIMAX Forecasts"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('1d909d81-49db-4865-9367-9759e727a8c5');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>From the plot we can see that this model performs worse than STL-ARIMA model. Let’s check ARIMAX model’s MAPE score to quantify performance difference.</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for ARIMAX model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_reg[<span class="st">'num_sold'</span>], forecast_reg)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for ARIMAX model is: </span><span class="sc">{</span>r2_score(test_reg[<span class="st">'num_sold'</span>], forecast_reg)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for ARIMAX model is: 0.6281181684643169
R2 Score for ARIMAX model is: -7.921475722370131</code></pre>
</div>
</div>
</section>
<section id="xgboost" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">3.2.2</span> XGBoost</h3>
<p>Let’s try the regression now with using XGBoost. We will again use the same feature matrix as exogenous variables but we’ll also use previous values of <code>num_sold</code> as input variables.</p>
<div class="cell" data-cache="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function so that we can try with different window sizes</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prev_values_tabularizer(feature_matrix, endog, window_size, scaler<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a list to store previous values</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    prev_values <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_matrix)):</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        prev_values.append(feature_matrix[endog][i : i <span class="op">+</span> window_size])</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape from columns to rows</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    prev_values <span class="op">=</span> [</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        pandas.Series(prev_values[i]).values.reshape([<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(prev_values))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create placeholder DataFrame with zeros and change them with previous values</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    zeros_matrix <span class="op">=</span> np.zeros(shape<span class="op">=</span>[<span class="bu">len</span>(feature_matrix), window_size])</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    placeholder_df <span class="op">=</span> pandas.DataFrame(zeros_matrix)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(placeholder_df)):</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(window_size):</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>                placeholder_df[j][i] <span class="op">=</span> prev_values[i][<span class="dv">0</span>][j]</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">IndexError</span>:</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add previous values to feature matrix, shift it by window size, remove first window size values from the feature matrix</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    feature_matrix <span class="op">=</span> pandas.concat([feature_matrix, placeholder_df], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    feature_matrix[<span class="bu">list</span>(<span class="bu">range</span>(window_size))] <span class="op">=</span> feature_matrix[</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">range</span>(window_size))</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    ].shift(window_size)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    feature_matrix <span class="op">=</span> feature_matrix.drop(<span class="bu">list</span>(<span class="bu">range</span>(window_size)), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If scaler is passed, apply scaling to previous values of endogenous variable</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scaler <span class="op">!=</span> <span class="va">False</span>:</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>        feature_matrix[<span class="bu">list</span>(<span class="bu">range</span>(window_size))] <span class="op">=</span> scaler.fit_transform(</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>            feature_matrix[<span class="bu">list</span>(<span class="bu">range</span>(window_size))]</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder the columns so that endogenous variables are at the far most right</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    reordered_columns <span class="op">=</span> (</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        feature_matrix.columns.to_list()[: (<span class="op">-</span>window_size <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> feature_matrix.columns.to_list()[(<span class="op">-</span>window_size):]</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> [feature_matrix.columns.to_list()[(<span class="op">-</span>window_size <span class="op">-</span> <span class="dv">1</span>)]]</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    feature_matrix <span class="op">=</span> feature_matrix[reordered_columns]</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_matrix</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="co"># We use 7 as window_size because of the previous partial autocorrelation graphs</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>regression_matrix <span class="op">=</span> prev_values_tabularizer(feature_matrix, <span class="st">"num_sold"</span>, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have transformed the feature matrix suitable for forecasting with regression. Now we have to split it again to train and test subsets and create regression model with XGBoost.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the same subset as previous examples and split</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>subset_xgboost <span class="op">=</span> regression_matrix[</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    (regression_matrix[<span class="st">"country_Germany"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (regression_matrix[<span class="st">"store_KaggleRama"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (regression_matrix[<span class="st">"product_Kaggle Recipe Book"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>subset_xgboost <span class="op">=</span> subset_xgboost.drop(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_France"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Germany"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Poland"</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Italy"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Spain"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"store_KaggleRama"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Getting Started"</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Recipe Book"</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle for Kids: One Smart Goose"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>train_subset_xgboost, test_subset_xgboost <span class="op">=</span> temporal_train_test_split(</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    subset_xgboost, test_size<span class="op">=</span><span class="dv">366</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Define train/test features and targets</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>train_targets_xgboost <span class="op">=</span> train_subset_xgboost[<span class="st">"num_sold"</span>]</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>train_features_xgboost <span class="op">=</span> train_subset_xgboost.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>test_targets_xgboost <span class="op">=</span> test_subset_xgboost[<span class="st">"num_sold"</span>]</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>test_features_xgboost <span class="op">=</span> test_subset_xgboost.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>xgboost_model <span class="op">=</span> XGBRegressor()</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>xgboost_model.fit(train_features_xgboost, train_targets_xgboost)</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the last year</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>forecast_xgboost <span class="op">=</span> pandas.DataFrame(xgboost_model.predict(test_features_xgboost))</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>forecast_xgboost.set_index(test_features_xgboost.index, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>plot_forecasts(test_targets_xgboost, forecast_xgboost, title<span class="op">=</span><span class="st">"XGBoost Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="17b20114-8537-4959-8eab-90c4d724c994" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("17b20114-8537-4959-8eab-90c4d724c994")) {                    Plotly.newPlot(                        "17b20114-8537-4959-8eab-90c4d724c994",                        [{"hovertemplate":"=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":[33237,33238,33239,33240,33241,33242,33243,33244,33245,33246,33247,33248,33249,33250,33251,33252,33253,33254,33255,33256,33257,33258,33259,33260,33261,33262,33263,33264,33265,33266,33267,33268,33269,33270,33271,33272,33273,33274,33275,33276,33277,33278,33279,33280,33281,33282,33283,33284,33285,33286,33287,33288,33289,33290,33291,33292,33293,33294,33295,33296,33297,33298,33299,33300,33301,33302,33303,33304,33305,33306,33307,33308,33309,33310,33311,33312,33313,33314,33315,33316,33317,33318,33319,33320,33321,33322,33323,33324,33325,33326,33327,33328,33329,33330,33331,33332,33333,33334,33335,33336,33337,33338,33339,33340,33341,33342,33343,33344,33345,33346,33347,33348,33349,33350,33351,33352,33353,33354,33355,33356,33357,33358,33359,33360,33361,33362,33363,33364,33365,33366,33367,33368,33369,33370,33371,33372,33373,33374,33375,33376,33377,33378,33379,33380,33381,33382,33383,33384,33385,33386,33387,33388,33389,33390,33391,33392,33393,33394,33395,33396,33397,33398,33399,33400,33401,33402,33403,33404,33405,33406,33407,33408,33409,33410,33411,33412,33413,33414,33415,33416,33417,33418,33419,33420,33421,33422,33423,33424,33425,33426,33427,33428,33429,33430,33431,33432,33433,33434,33435,33436,33437,33438,33439,33440,33441,33442,33443,33444,33445,33446,33447,33448,33449,33450,33451,33452,33453,33454,33455,33456,33457,33458,33459,33460,33461,33462,33463,33464,33465,33466,33467,33468,33469,33470,33471,33472,33473,33474,33475,33476,33477,33478,33479,33480,33481,33482,33483,33484,33485,33486,33487,33488,33489,33490,33491,33492,33493,33494,33495,33496,33497,33498,33499,33500,33501,33502,33503,33504,33505,33506,33507,33508,33509,33510,33511,33512,33513,33514,33515,33516,33517,33518,33519,33520,33521,33522,33523,33524,33525,33526,33527,33528,33529,33530,33531,33532,33533,33534,33535,33536,33537,33538,33539,33540,33541,33542,33543,33544,33545,33546,33547,33548,33549,33550,33551,33552,33553,33554,33555,33556,33557,33558,33559,33560,33561,33562,33563,33564,33565,33566,33567,33568,33569,33570,33571,33572,33573,33574,33575,33576,33577,33578,33579,33580,33581,33582,33583,33584,33585,33586,33587,33588,33589,33590,33591,33592,33593,33594,33595,33596,33597,33598,33599,33600,33601,33602],"xaxis":"x","y":[142.0,98.0,109.0,102.0,116.0,99.0,83.0,90.0,84.0,91.0,93.0,113.0,78.0,89.0,87.0,88.0,89.0,101.0,101.0,82.0,92.0,88.0,91.0,90.0,102.0,99.0,89.0,88.0,90.0,85.0,89.0,103.0,104.0,87.0,84.0,83.0,86.0,91.0,102.0,97.0,91.0,85.0,87.0,88.0,85.0,92.0,91.0,84.0,83.0,83.0,81.0,82.0,89.0,105.0,83.0,83.0,81.0,76.0,80.0,99.0,86.0,78.0,77.0,70.0,72.0,70.0,86.0,86.0,67.0,75.0,73.0,71.0,73.0,78.0,93.0,69.0,67.0,66.0,74.0,76.0,80.0,92.0,72.0,71.0,69.0,69.0,66.0,76.0,73.0,65.0,72.0,61.0,55.0,56.0,60.0,69.0,55.0,54.0,59.0,58.0,60.0,69.0,71.0,56.0,64.0,64.0,59.0,66.0,74.0,76.0,52.0,55.0,48.0,54.0,55.0,57.0,66.0,57.0,55.0,53.0,55.0,59.0,69.0,75.0,65.0,63.0,67.0,68.0,63.0,67.0,69.0,64.0,56.0,52.0,56.0,62.0,69.0,68.0,57.0,58.0,60.0,58.0,61.0,74.0,75.0,65.0,63.0,61.0,62.0,68.0,65.0,68.0,65.0,63.0,60.0,62.0,70.0,75.0,79.0,63.0,63.0,60.0,69.0,64.0,70.0,70.0,61.0,56.0,60.0,58.0,62.0,75.0,74.0,57.0,65.0,58.0,59.0,59.0,73.0,73.0,60.0,66.0,68.0,65.0,65.0,70.0,77.0,62.0,66.0,67.0,70.0,67.0,69.0,68.0,64.0,65.0,61.0,61.0,68.0,69.0,76.0,56.0,63.0,64.0,59.0,66.0,75.0,76.0,61.0,64.0,65.0,60.0,69.0,76.0,79.0,67.0,66.0,70.0,64.0,64.0,81.0,78.0,70.0,64.0,69.0,70.0,61.0,78.0,78.0,71.0,67.0,77.0,72.0,72.0,71.0,78.0,69.0,73.0,69.0,69.0,67.0,80.0,86.0,66.0,70.0,70.0,72.0,75.0,86.0,83.0,71.0,63.0,72.0,71.0,67.0,81.0,82.0,73.0,65.0,77.0,61.0,81.0,89.0,79.0,69.0,76.0,68.0,76.0,77.0,82.0,91.0,68.0,71.0,71.0,82.0,72.0,90.0,103.0,77.0,80.0,86.0,90.0,86.0,94.0,98.0,78.0,77.0,77.0,84.0,89.0,95.0,102.0,80.0,84.0,84.0,80.0,71.0,81.0,99.0,79.0,76.0,79.0,81.0,86.0,100.0,96.0,76.0,74.0,86.0,82.0,76.0,91.0,100.0,80.0,87.0,80.0,81.0,87.0,97.0,104.0,79.0,76.0,87.0,76.0,86.0,98.0,95.0,76.0,88.0,82.0,83.0,91.0,87.0,90.0,84.0,83.0,83.0,82.0,87.0,85.0,107.0,85.0,80.0,88.0,78.0,86.0,99.0,98.0,86.0,82.0,84.0,89.0,85.0,102.0,90.0,79.0,83.0,87.0,84.0,94.0,122.0,131.0,126.0,157.0,169.0,143.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":[33237,33238,33239,33240,33241,33242,33243,33244,33245,33246,33247,33248,33249,33250,33251,33252,33253,33254,33255,33256,33257,33258,33259,33260,33261,33262,33263,33264,33265,33266,33267,33268,33269,33270,33271,33272,33273,33274,33275,33276,33277,33278,33279,33280,33281,33282,33283,33284,33285,33286,33287,33288,33289,33290,33291,33292,33293,33294,33295,33296,33297,33298,33299,33300,33301,33302,33303,33304,33305,33306,33307,33308,33309,33310,33311,33312,33313,33314,33315,33316,33317,33318,33319,33320,33321,33322,33323,33324,33325,33326,33327,33328,33329,33330,33331,33332,33333,33334,33335,33336,33337,33338,33339,33340,33341,33342,33343,33344,33345,33346,33347,33348,33349,33350,33351,33352,33353,33354,33355,33356,33357,33358,33359,33360,33361,33362,33363,33364,33365,33366,33367,33368,33369,33370,33371,33372,33373,33374,33375,33376,33377,33378,33379,33380,33381,33382,33383,33384,33385,33386,33387,33388,33389,33390,33391,33392,33393,33394,33395,33396,33397,33398,33399,33400,33401,33402,33403,33404,33405,33406,33407,33408,33409,33410,33411,33412,33413,33414,33415,33416,33417,33418,33419,33420,33421,33422,33423,33424,33425,33426,33427,33428,33429,33430,33431,33432,33433,33434,33435,33436,33437,33438,33439,33440,33441,33442,33443,33444,33445,33446,33447,33448,33449,33450,33451,33452,33453,33454,33455,33456,33457,33458,33459,33460,33461,33462,33463,33464,33465,33466,33467,33468,33469,33470,33471,33472,33473,33474,33475,33476,33477,33478,33479,33480,33481,33482,33483,33484,33485,33486,33487,33488,33489,33490,33491,33492,33493,33494,33495,33496,33497,33498,33499,33500,33501,33502,33503,33504,33505,33506,33507,33508,33509,33510,33511,33512,33513,33514,33515,33516,33517,33518,33519,33520,33521,33522,33523,33524,33525,33526,33527,33528,33529,33530,33531,33532,33533,33534,33535,33536,33537,33538,33539,33540,33541,33542,33543,33544,33545,33546,33547,33548,33549,33550,33551,33552,33553,33554,33555,33556,33557,33558,33559,33560,33561,33562,33563,33564,33565,33566,33567,33568,33569,33570,33571,33572,33573,33574,33575,33576,33577,33578,33579,33580,33581,33582,33583,33584,33585,33586,33587,33588,33589,33590,33591,33592,33593,33594,33595,33596,33597,33598,33599,33600,33601,33602],"xaxis":"x","y":[143.4705352783203,123.05106353759766,107.05101776123047,108.44171905517578,122.8169174194336,121.76850891113281,113.71368408203125,87.77592468261719,90.22251892089844,88.10630798339844,86.9846420288086,101.73181915283203,90.74679565429688,85.08724975585938,85.96589660644531,85.75274658203125,85.54473114013672,96.69519805908203,110.09576416015625,87.2800521850586,84.19660949707031,89.8280029296875,87.68913269042969,90.7928695678711,101.72299194335938,105.47698211669922,88.97856140136719,88.4240493774414,85.09699249267578,85.88046264648438,89.96347045898438,99.89185333251953,104.4070053100586,90.4119644165039,89.29533386230469,85.37246704101562,84.30009460449219,93.36868286132812,100.60648345947266,106.79936218261719,83.44673156738281,86.6324462890625,82.09069061279297,84.14555358886719,88.83088684082031,95.16552734375,98.93617248535156,83.21124267578125,80.95712280273438,82.85628509521484,82.66677856445312,87.61869049072266,90.24176788330078,87.86746215820312,79.77078247070312,79.45378875732422,80.4876937866211,83.25372314453125,78.92453002929688,91.18254089355469,99.65396118164062,79.1343002319336,79.96436309814453,89.54107666015625,76.23529052734375,84.93840026855469,78.49108123779297,87.67351531982422,76.51217651367188,78.00006866455078,72.5278549194336,73.94557189941406,78.59648895263672,81.92027282714844,84.51439666748047,73.28364562988281,74.8603515625,77.51368713378906,74.88146209716797,77.54663848876953,77.72744750976562,87.29434967041016,70.33948516845703,72.5849609375,75.0550308227539,76.59510040283203,80.00035858154297,81.5316162109375,86.12068176269531,71.6190414428711,73.15776824951172,74.0392837524414,73.41653442382812,75.11376953125,81.22789001464844,82.11671447753906,74.25090789794922,72.93970489501953,72.16011810302734,72.364013671875,67.57865905761719,75.67301940917969,82.20233917236328,77.70729064941406,74.69953918457031,77.75743865966797,77.14358520507812,75.49164581298828,80.98306274414062,87.02392578125,74.98857879638672,71.53675842285156,73.3783950805664,73.77559661865234,71.65084075927734,78.31499481201172,84.98253631591797,71.02887725830078,66.6905746459961,67.08263397216797,66.52764129638672,68.40843963623047,76.69837188720703,79.77448272705078,72.88451385498047,70.82793426513672,71.7542953491211,70.55794525146484,72.07608795166016,79.3138656616211,81.64311218261719,69.46649932861328,70.06278991699219,69.96686553955078,64.4505615234375,65.7069320678711,74.51835632324219,76.88177490234375,69.78893280029297,68.78836059570312,67.0404052734375,65.2931137084961,67.92025756835938,80.5687484741211,83.76358032226562,71.32315826416016,71.71265411376953,70.83386993408203,71.11536407470703,71.68669891357422,79.77163696289062,86.65290832519531,71.5325698852539,72.19046020507812,75.58135986328125,70.75604248046875,72.65388488769531,80.54163360595703,90.66361999511719,76.00276184082031,71.32288360595703,72.4563980102539,67.69879150390625,72.1222152709961,84.36427307128906,79.14759063720703,68.87296295166016,67.49120330810547,67.41472625732422,68.27753448486328,67.17819213867188,75.68031311035156,78.03121948242188,68.2064437866211,65.39811706542969,67.42701721191406,65.25945281982422,68.38700103759766,76.75004577636719,79.327392578125,68.57296752929688,66.3747329711914,67.53755187988281,65.0588607788086,68.24407196044922,79.06564331054688,80.99201202392578,67.44715118408203,70.17035675048828,68.52826690673828,65.34007263183594,68.99226379394531,77.71126556396484,82.17658996582031,67.43939208984375,67.60607147216797,69.60425567626953,66.5331039428711,67.96737670898438,78.39190673828125,81.01715850830078,71.38983154296875,67.86286163330078,70.60407257080078,68.04347229003906,68.86071014404297,76.72862243652344,85.9046630859375,70.52104949951172,67.43727111816406,70.2548599243164,68.43685150146484,69.83773040771484,77.8873062133789,88.02265930175781,72.24785614013672,72.53410339355469,69.57058715820312,68.85063934326172,71.65531921386719,79.60810089111328,83.58695220947266,69.43974304199219,70.61149597167969,72.76496124267578,70.02726745605469,74.85842895507812,76.36797332763672,87.49889373779297,71.66409301757812,69.84403228759766,69.51558685302734,70.0814437866211,72.01927185058594,79.47240447998047,86.2339859008789,69.32919311523438,67.14505004882812,69.29257202148438,69.67774200439453,68.4262466430664,80.78142547607422,86.41460418701172,69.0379409790039,71.15516662597656,70.37020111083984,73.45686340332031,77.3526611328125,79.75785827636719,86.96475982666016,73.95130157470703,72.89082336425781,77.17843627929688,74.4230728149414,74.16238403320312,81.35958099365234,87.85711669921875,73.58734130859375,70.26445770263672,72.17427062988281,71.92671203613281,76.18880462646484,85.09768676757812,88.36312866210938,72.58731842041016,77.37471771240234,77.1290512084961,79.96324157714844,81.23934936523438,90.640380859375,90.25047302246094,75.97216033935547,81.85650634765625,77.15931701660156,77.95838165283203,85.84587860107422,89.03702545166016,97.44049072265625,74.41438293457031,78.73431396484375,86.67357635498047,83.2606430053711,86.76068115234375,96.59123229980469,100.72310638427734,80.8657455444336,76.49163055419922,81.5274429321289,76.48931884765625,82.36832427978516,88.67729949951172,100.61286926269531,83.32609558105469,80.87279510498047,82.03803253173828,81.92184448242188,85.62278747558594,89.97039031982422,94.78931427001953,79.43423461914062,80.7415771484375,77.49688720703125,84.81817626953125,79.70565032958984,89.92047119140625,98.84186553955078,86.8657455444336,80.13008117675781,86.41229248046875,83.52001190185547,87.55287170410156,91.17483520507812,96.61813354492188,87.92058563232422,80.52449798583984,83.28196716308594,82.46904754638672,82.45367431640625,99.59741973876953,104.68826293945312,84.34537506103516,84.19998931884766,81.49977111816406,82.69815063476562,86.16748046875,93.19585418701172,107.79017639160156,86.48548889160156,80.24330139160156,90.08810424804688,81.14826202392578,85.00981140136719,95.9523696899414,100.36405181884766,85.21480560302734,88.6435775756836,85.96500396728516,87.13846588134766,88.88153076171875,97.37663269042969,98.51026153564453,89.1866226196289,86.34542083740234,85.8936767578125,82.44070434570312,84.62076568603516,97.11314392089844,111.56613159179688,88.10338592529297,86.94366455078125,90.14173889160156,86.05488586425781,89.43207550048828,95.94517517089844,103.81814575195312,86.16545104980469,85.4930419921875,87.09906768798828,86.34162902832031,93.797607421875,121.91180419921875,139.6717987060547,159.2491912841797,149.5479736328125,190.50071716308594,177.45559692382812],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"index"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"XGBoost Forecasts"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('17b20114-8537-4959-8eab-90c4d724c994');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>From the plot we can see that regression model with XGBoost performs better than ARIMAX model. Let’s check the scores again.</p>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for XGBoost Model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_targets_xgboost, forecast_xgboost)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for XGBoost Model is: </span><span class="sc">{</span>r2_score(test_targets_xgboost, forecast_xgboost)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for XGBoost Model is: 0.09307335208975362
R2 Score for XGBoost Model is: 0.6931165642563528</code></pre>
</div>
</div>
<p>Scores surely seems better than our other forecasting attempts with STL-ARIMA and ARIMAX, though it can be said that this regression model tends not to undershoot. It is also more successful to capture New Year’s Eve sales than other models.</p>
<p>It is still early to call this the best model, since we didn’t tuned thoroughly the models’ hyperparamaters and there are deep learning models to try. Now we’ll move to the business case definition and after that, hyperparameter tuning of STL-ARIMA, ARIMAX, and XGBoost models. For deep learning part of this case please refer to <a href="../../posts/book-forecasting/book_sales_forecasting_deep_learning_part.html">Part 2</a>.</p>
</section>
</section>
</section>
<section id="business-case-objective-function" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Business Case Objective Function</h1>
<p>To compare different models, so far, we have used Mean Absolute Percentage Error and R2 Scores. We have also plotted our forecasts and compared them with test targets. Now we will approach the problem from a different perspective.</p>
<p>Instead of minimizing error, we will try to minimize our cost. It didn’t matter whether a sales forecast is for example 20 units more or less; but having 20 more books in the inventory and opportunity cost of selling 20 less books may not be the same. Our custom function will define exactly that.</p>
<p>Our assumptions are:</p>
<ul>
<li>Every book is sold for €20</li>
<li>Book dimensions: 210x148x10mm (A5)</li>
<li>Storage cost: €100 per month</li>
<li>Warehouse dimensions: 2x2x3m</li>
<li>Warehouse space utilization: %15</li>
</ul>
<p>With these assumptions, one warehouse can store approximately 6000 books for a storage fee of €100 per month. The scenario is that for every each book which the forecast undershoots the true sales, we have the opportunity cost of one book. If the forecast overshoots the true sales, then we can store the book in our warehouse by renting it. After renting the warehouse, each subsequent undershoot can be compensated from our inventory - effectively eliminating the opportunity cost but if storage limit is exceeded then we have to rent another warehouse increasing our monthly cost to €200.</p>
<p>We will use the function <code>cost_function()</code> to calculate this metric.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define cost function for our case</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost_function(storage, y_true, y_pred, book_price, storage_monthly_rent):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> storage <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_pred <span class="op">&lt;=</span> y_true:</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      cost <span class="op">=</span> book_price<span class="op">*</span>(y_true <span class="op">-</span> y_pred)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      to_storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cost, to_storage</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> y_pred <span class="op">&gt;</span> y_true:</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      cost <span class="op">=</span> storage_monthly_rent<span class="op">/</span><span class="dv">30</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>      to_storage <span class="op">=</span> y_pred <span class="op">-</span> y_true</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cost, to_storage</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> storage <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_pred <span class="op">&lt;=</span> y_true:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (y_true <span class="op">-</span> y_pred) <span class="op">&lt;</span> storage:</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> storage_monthly_rent<span class="op">/</span><span class="dv">30</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        to_storage <span class="op">=</span> y_pred <span class="op">-</span> y_true</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cost, to_storage</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> (y_true <span class="op">-</span> y_pred) <span class="op">&gt;</span> storage:</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> book_price<span class="op">*</span>(y_true <span class="op">-</span> y_pred <span class="op">-</span> storage) <span class="op">+</span> storage_monthly_rent<span class="op">/</span><span class="dv">30</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        to_storage <span class="op">=</span> <span class="op">-</span>storage</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cost, to_storage</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> y_pred <span class="op">&gt;</span> y_true:</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>      cost <span class="op">=</span> storage_monthly_rent<span class="op">/</span><span class="dv">30</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>      to_storage <span class="op">=</span> y_pred <span class="op">-</span> y_true</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cost, to_storage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hyperparameter-tuning-with-optuna" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Hyperparameter Tuning with Optuna</h1>
<p>Now we will tune and select hyperparameters for our models with the lowest cost. To reduce bias and get better generalization from the models, we will split the data to train - test - validation. While searching for the model with lowest cost using test data it may overfit. Therefore, we will tune the parameters using test dataset and after that check the performance using validation data.</p>
<p>Also earlier we were using test features for forecasts but feature matrix contains future <code>num_sold</code> values in it; thus, it wasn’t a legitimate forecast. In this part we will also change the way forecasts are created so that the model uses its own forecasts as past values instead of real sales.</p>
<section id="stl-arima-tuning" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="stl-arima-tuning"><span class="header-section-number">5.1</span> STL-ARIMA Tuning</h2>
<div class="cell" data-cache="true" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create validation data for STL-Arima</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>train_subset <span class="op">=</span> subset[<span class="st">"num_sold"</span>][<span class="dv">0</span>:<span class="dv">730</span>].reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>test_subset <span class="op">=</span> subset[<span class="st">"num_sold"</span>][<span class="dv">730</span>:<span class="dv">1095</span>].reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>val_subset <span class="op">=</span> subset[<span class="st">"num_sold"</span>][<span class="dv">1095</span>:<span class="dv">1461</span>].reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Optuna Objective</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stl_objective(trial):</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select ranges for p, d, q orders</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    p_order <span class="op">=</span> trial.suggest_int(<span class="st">"p_order"</span>, <span class="dv">0</span>, <span class="dv">10</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    d_order <span class="op">=</span> trial.suggest_int(<span class="st">"d_order"</span>, <span class="dv">0</span>, <span class="dv">2</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    q_order <span class="op">=</span> trial.suggest_int(<span class="st">"q_order"</span>, <span class="dv">0</span>, <span class="dv">10</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    robust_bool <span class="op">=</span> trial.suggest_categorical(<span class="st">"robust_mode"</span>, [<span class="va">False</span>, <span class="va">True</span>])</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    trend_deg <span class="op">=</span> trial.suggest_int(<span class="st">"trend_deg"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    seasonal_deg <span class="op">=</span> trial.suggest_int(<span class="st">"seasonal_deg"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    low_pass_deg <span class="op">=</span> trial.suggest_int(<span class="st">"low_pass_deg"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    seasonal_jump <span class="op">=</span> trial.suggest_int(<span class="st">"seasonal_jump"</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    trend_jump <span class="op">=</span> trial.suggest_int(<span class="st">"trend_jump"</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    low_pass_jump <span class="op">=</span> trial.suggest_int(<span class="st">"low_pass_jump"</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    stl_forecast_tuned <span class="op">=</span> STLForecast(</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        train_subset,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>statsmodels.tsa.arima.model.ARIMA,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        model_kwargs<span class="op">=</span>{<span class="st">"order"</span>: (p_order, d_order, q_order), <span class="st">"trend"</span>: <span class="st">"n"</span>},</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        period<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        trend<span class="op">=</span><span class="dv">731</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        trend_deg<span class="op">=</span>trend_deg,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        seasonal_deg<span class="op">=</span>seasonal_deg,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        low_pass_deg<span class="op">=</span>low_pass_deg,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        seasonal_jump<span class="op">=</span>seasonal_jump,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        trend_jump<span class="op">=</span>trend_jump,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        low_pass_jump<span class="op">=</span>low_pass_jump,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        robust<span class="op">=</span>robust_bool,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit and forecast test data</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> stl_forecast_tuned.fit()</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> model.forecast(steps<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reset index of forecasts</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> forecast.reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_subset)):</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>        cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>            storage, test_subset[<span class="st">"num_sold"</span>][step], forecast[<span class="dv">0</span>][step], book_price, monthly_storage_cost</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>        storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage <span class="op">*</span> book_price</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_cost</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Optuna Study and Minimize total_cost</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>stl_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>)</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>stl_study.optimize(stl_objective, n_trials<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll create the model with best parameters to get tuned forecasts.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the parameters of the best model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>best_stl_model_parameters <span class="op">=</span> stl_study.best_params</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define STL-Arima model with the best parameters and train on test data</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>stl_forecast <span class="op">=</span> STLForecast(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    test_subset,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>statsmodels.tsa.arima.model.ARIMA,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    model_kwargs<span class="op">=</span>{</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"order"</span>: (</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            best_stl_model_parameters[<span class="st">"p_order"</span>],</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>            best_stl_model_parameters[<span class="st">"d_order"</span>],</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>            best_stl_model_parameters[<span class="st">"q_order"</span>],</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trend"</span>: <span class="st">"n"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    period<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">=</span><span class="dv">1095</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    robust<span class="op">=</span>best_stl_model_parameters[<span class="st">"robust_mode"</span>],</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    trend_deg<span class="op">=</span>best_stl_model_parameters[<span class="st">"trend_deg"</span>],</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    seasonal_deg<span class="op">=</span>best_stl_model_parameters[<span class="st">"seasonal_deg"</span>],</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    low_pass_deg<span class="op">=</span>best_stl_model_parameters[<span class="st">"low_pass_deg"</span>],</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    seasonal_jump<span class="op">=</span>best_stl_model_parameters[<span class="st">"seasonal_jump"</span>],</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    trend_jump<span class="op">=</span>best_stl_model_parameters[<span class="st">"trend_jump"</span>],</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    low_pass_jump<span class="op">=</span>best_stl_model_parameters[<span class="st">"low_pass_jump"</span>],</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and forecast test data</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>tuned_stl_model <span class="op">=</span> stl_forecast.fit()</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>forecast_stl_arima_tuned <span class="op">=</span> tuned_stl_model.forecast(steps<span class="op">=</span><span class="dv">366</span>)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>forecast_stl_arima_tuned <span class="op">=</span> forecast_stl_arima_tuned.reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(val_subset)):</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>        storage,</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>        val_subset[<span class="st">"num_sold"</span>][step],</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>        forecast_stl_arima_tuned[<span class="dv">0</span>][step],</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>        book_price,</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>        monthly_storage_cost,</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>stl_arima_total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage <span class="op">*</span> book_price</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>plot_forecasts(val_subset, forecast_stl_arima_tuned, title<span class="op">=</span><span class="st">"STL ARIMA Tuned Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="f4a804a2-febb-4bf1-a358-d8f6ec0035cb" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("f4a804a2-febb-4bf1-a358-d8f6ec0035cb")) {                    Plotly.newPlot(                        "f4a804a2-febb-4bf1-a358-d8f6ec0035cb",                        [{"hovertemplate":"=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[142.0,98.0,109.0,102.0,116.0,99.0,83.0,90.0,84.0,91.0,93.0,113.0,78.0,89.0,87.0,88.0,89.0,101.0,101.0,82.0,92.0,88.0,91.0,90.0,102.0,99.0,89.0,88.0,90.0,85.0,89.0,103.0,104.0,87.0,84.0,83.0,86.0,91.0,102.0,97.0,91.0,85.0,87.0,88.0,85.0,92.0,91.0,84.0,83.0,83.0,81.0,82.0,89.0,105.0,83.0,83.0,81.0,76.0,80.0,99.0,86.0,78.0,77.0,70.0,72.0,70.0,86.0,86.0,67.0,75.0,73.0,71.0,73.0,78.0,93.0,69.0,67.0,66.0,74.0,76.0,80.0,92.0,72.0,71.0,69.0,69.0,66.0,76.0,73.0,65.0,72.0,61.0,55.0,56.0,60.0,69.0,55.0,54.0,59.0,58.0,60.0,69.0,71.0,56.0,64.0,64.0,59.0,66.0,74.0,76.0,52.0,55.0,48.0,54.0,55.0,57.0,66.0,57.0,55.0,53.0,55.0,59.0,69.0,75.0,65.0,63.0,67.0,68.0,63.0,67.0,69.0,64.0,56.0,52.0,56.0,62.0,69.0,68.0,57.0,58.0,60.0,58.0,61.0,74.0,75.0,65.0,63.0,61.0,62.0,68.0,65.0,68.0,65.0,63.0,60.0,62.0,70.0,75.0,79.0,63.0,63.0,60.0,69.0,64.0,70.0,70.0,61.0,56.0,60.0,58.0,62.0,75.0,74.0,57.0,65.0,58.0,59.0,59.0,73.0,73.0,60.0,66.0,68.0,65.0,65.0,70.0,77.0,62.0,66.0,67.0,70.0,67.0,69.0,68.0,64.0,65.0,61.0,61.0,68.0,69.0,76.0,56.0,63.0,64.0,59.0,66.0,75.0,76.0,61.0,64.0,65.0,60.0,69.0,76.0,79.0,67.0,66.0,70.0,64.0,64.0,81.0,78.0,70.0,64.0,69.0,70.0,61.0,78.0,78.0,71.0,67.0,77.0,72.0,72.0,71.0,78.0,69.0,73.0,69.0,69.0,67.0,80.0,86.0,66.0,70.0,70.0,72.0,75.0,86.0,83.0,71.0,63.0,72.0,71.0,67.0,81.0,82.0,73.0,65.0,77.0,61.0,81.0,89.0,79.0,69.0,76.0,68.0,76.0,77.0,82.0,91.0,68.0,71.0,71.0,82.0,72.0,90.0,103.0,77.0,80.0,86.0,90.0,86.0,94.0,98.0,78.0,77.0,77.0,84.0,89.0,95.0,102.0,80.0,84.0,84.0,80.0,71.0,81.0,99.0,79.0,76.0,79.0,81.0,86.0,100.0,96.0,76.0,74.0,86.0,82.0,76.0,91.0,100.0,80.0,87.0,80.0,81.0,87.0,97.0,104.0,79.0,76.0,87.0,76.0,86.0,98.0,95.0,76.0,88.0,82.0,83.0,91.0,87.0,90.0,84.0,83.0,83.0,82.0,87.0,85.0,107.0,85.0,80.0,88.0,78.0,86.0,99.0,98.0,86.0,82.0,84.0,89.0,85.0,102.0,90.0,79.0,83.0,87.0,84.0,94.0,122.0,131.0,126.0,157.0,169.0,143.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[140.0000000000001,117.0000000000002,102.00000000000031,105.00000000000028,120.00000000000024,124.0000000000004,101.00000000000057,101.00000000000053,84.00000000000048,93.00000000000053,99.00000000000057,105.00000000000064,117.00000000000071,88.00000000000077,92.00000000000084,89.00000000000087,91.0000000000009,97.00000000000102,104.00000000000114,113.00000000000117,94.0000000000012,93.00000000000125,87.0000000000013,95.0000000000014,86.00000000000152,100.00000000000156,111.00000000000159,89.0000000000016,93.00000000000162,85.0000000000017,80.0000000000018,90.00000000000185,101.00000000000189,112.00000000000196,87.00000000000202,88.00000000000199,89.00000000000198,87.00000000000207,99.00000000000216,102.00000000000225,96.00000000000234,92.00000000000244,94.00000000000256,95.00000000000257,86.00000000000259,88.00000000000267,100.00000000000276,107.00000000000276,92.00000000000277,92.00000000000277,88.00000000000277,90.00000000000296,85.00000000000315,95.00000000000315,107.00000000000317,86.00000000000324,85.00000000000331,84.00000000000334,83.00000000000337,91.00000000000337,99.00000000000337,103.00000000000347,89.00000000000357,77.00000000000365,83.00000000000374,92.00000000000384,83.00000000000395,99.00000000000395,102.00000000000394,88.00000000000395,83.00000000000398,92.00000000000406,81.00000000000414,95.00000000000422,97.0000000000043,101.00000000000429,81.00000000000426,89.00000000000436,86.00000000000446,84.00000000000453,82.0000000000046,91.00000000000466,91.00000000000472,85.00000000000476,78.0000000000048,82.00000000000492,86.00000000000504,79.00000000000506,89.00000000000506,105.00000000000519,74.00000000000531,84.00000000000534,87.00000000000539,78.00000000000546,76.00000000000551,91.00000000000553,95.00000000000554,85.00000000000561,80.00000000000568,80.00000000000571,77.00000000000573,79.00000000000577,95.0000000000058,94.00000000000585,78.00000000000593,84.00000000000605,80.00000000000617,77.0000000000062,79.00000000000624,96.00000000000628,99.00000000000631,82.00000000000641,91.00000000000651,86.00000000000657,92.00000000000661,94.00000000000657,102.00000000000654,105.00000000000665,88.00000000000675,73.00000000000679,77.00000000000685,81.0000000000069,93.00000000000695,101.00000000000705,105.00000000000716,78.0000000000071,84.00000000000706,77.00000000000725,80.00000000000743,81.0000000000075,93.00000000000756,83.00000000000753,75.00000000000749,78.00000000000762,71.00000000000773,67.0000000000078,82.00000000000787,88.00000000000792,90.00000000000796,71.000000000008,80.00000000000804,73.00000000000811,69.00000000000819,79.00000000000821,88.00000000000824,88.00000000000828,72.00000000000833,72.00000000000841,74.00000000000848,72.00000000000851,75.00000000000854,81.00000000000861,91.0000000000087,82.00000000000878,74.00000000000888,75.00000000000891,79.00000000000894,82.00000000000897,78.000000000009,78.00000000000907,69.00000000000915,72.00000000000924,74.00000000000931,82.00000000000938,83.00000000000944,93.00000000000949,96.00000000000956,81.00000000000958,73.0000000000096,72.00000000000965,72.00000000000969,76.00000000000976,86.00000000000983,74.00000000000992,75.00000000001002,65.00000000001,74.00000000000999,77.0000000000101,67.00000000001022,79.00000000001023,79.00000000001026,69.00000000001037,68.00000000001049,68.0000000000105,72.00000000001052,74.00000000001057,83.00000000001063,94.00000000001067,72.00000000001071,69.00000000001079,74.00000000001086,65.00000000001091,85.00000000001098,81.00000000001107,88.00000000001116,77.00000000001117,70.00000000001117,72.00000000001125,73.00000000001133,69.00000000001138,83.00000000001144,89.00000000001155,66.00000000001167,76.00000000001168,73.00000000001171,68.00000000001172,72.00000000001174,78.0000000000118,88.00000000001187,69.00000000001191,79.00000000001197,74.00000000001211,69.00000000001225,78.00000000001228,84.0000000000123,83.00000000001232,73.00000000001234,69.0000000000124,75.00000000001248,73.00000000001249,79.0000000000125,78.00000000001262,89.00000000001275,77.00000000001272,77.00000000001269,67.00000000001278,69.00000000001286,69.00000000001299,85.00000000001312,94.00000000001307,75.00000000001305,70.00000000001313,67.00000000001323,74.00000000001327,75.0000000000133,84.00000000001336,88.0000000000134,72.0000000000135,67.00000000001361,73.00000000001363,76.00000000001364,78.00000000001373,89.00000000001381,84.00000000001388,75.00000000001396,73.00000000001394,77.00000000001393,78.00000000001404,84.00000000001415,92.00000000001421,98.00000000001427,73.00000000001427,78.00000000001427,78.00000000001435,77.00000000001445,91.00000000001458,88.00000000001471,89.00000000001475,75.00000000001478,78.00000000001481,76.00000000001482,81.00000000001484,80.00000000001486,87.000000000015,100.00000000001515,75.00000000001515,82.00000000001516,83.00000000001523,74.0000000000153,89.00000000001529,90.00000000001529,91.0000000000154,88.00000000001553,80.0000000000156,78.00000000001566,81.00000000001573,91.0000000000158,96.00000000001586,99.0000000000159,97.00000000001592,87.00000000001593,91.00000000001602,87.0000000000161,86.00000000001616,88.00000000001621,92.00000000001629,74.00000000001634,81.00000000001641,81.00000000001648,80.00000000001657,87.00000000001667,89.0000000000167,95.00000000001673,79.00000000001677,77.00000000001683,80.00000000001685,90.00000000001687,82.00000000001694,102.00000000001702,99.00000000001711,86.00000000001718,83.00000000001721,78.00000000001724,83.00000000001728,91.00000000001734,94.00000000001742,100.00000000001752,78.00000000001752,84.00000000001752,81.00000000001768,84.00000000001782,87.00000000001779,95.00000000001776,111.00000000001782,93.00000000001786,84.000000000018,87.00000000001815,81.00000000001816,92.00000000001819,103.00000000001825,114.00000000001829,83.00000000001833,81.00000000001836,84.00000000001842,90.00000000001847,91.00000000001855,97.00000000001862,109.0000000000187,89.00000000001879,80.00000000001877,88.00000000001876,84.00000000001884,83.00000000001893,98.00000000001899,110.00000000001903,89.00000000001914,87.00000000001926,90.00000000001927,82.00000000001928,89.00000000001927,97.00000000001927,108.00000000001936,92.00000000001945,92.00000000001955,86.00000000001967,81.00000000001972,91.0000000000198,98.00000000001981,104.00000000001982,84.00000000001984,90.00000000001985,84.00000000001994,89.00000000002002,80.00000000002015,93.00000000002028,103.00000000002024,88.0000000000202,87.00000000002031,92.00000000002042,95.00000000002049,141.00000000002055,151.00000000002063,193.00000000002075,174.00000000002075,155.00000000002075,140.00000000002086],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"index"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"STL ARIMA Tuned Forecasts"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('f4a804a2-febb-4bf1-a358-d8f6ec0035cb');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Calculate the MAPE and R2 Scores and the total cost according to our metric.</p>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Earlier STL-ARIMA Model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_subset_pretuning, forecast)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Tuned STL-ARIMA is: </span><span class="sc">{</span>mean_absolute_percentage_error(val_subset[<span class="st">'num_sold'</span>], forecast_stl_arima_tuned[<span class="dv">0</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Earlier STL-ARIMA Model is: </span><span class="sc">{</span>r2_score(test_subset_pretuning, forecast)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Tuned STL-ARIMA is: </span><span class="sc">{</span>r2_score(val_subset[<span class="st">'num_sold'</span>], forecast_stl_arima_tuned[<span class="dv">0</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Cost for tuned STL-ARIMA is: €</span><span class="sc">{</span>stl_arima_total_cost<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for Earlier STL-ARIMA Model is: 0.18646794982275017
MAPE for Tuned STL-ARIMA is: 0.1666647758683933

R2 Score for Earlier STL-ARIMA Model is: -0.6091132358371121
R2 Score for Tuned STL-ARIMA is: 0.03715486112144273

Total Cost for tuned STL-ARIMA is: €72,474.00</code></pre>
</div>
</div>
</section>
<section id="arimax-tuning" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="arimax-tuning"><span class="header-section-number">5.2</span> ARIMAX Tuning</h2>
<div class="cell" data-cache="true" data-execution_count="28">
<details>
<summary>Optuna ARIMAX Tuning Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create validation data for ARIMAX</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>train_subset <span class="op">=</span> subset[<span class="dv">0</span>:<span class="dv">730</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>test_subset <span class="op">=</span> subset[<span class="dv">730</span>:<span class="dv">1095</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>val_subset <span class="op">=</span> subset[<span class="dv">1095</span>:<span class="dv">1461</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define endogenous and exogenous variables</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>train_targets <span class="op">=</span> pandas.DataFrame(train_subset[<span class="st">"num_sold"</span>]).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>train_features <span class="op">=</span> pandas.DataFrame(train_subset.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>test_targets <span class="op">=</span> pandas.DataFrame(test_subset[<span class="st">"num_sold"</span>]).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>test_features <span class="op">=</span> pandas.DataFrame(test_subset.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>val_targets <span class="op">=</span> pandas.DataFrame(val_subset[<span class="st">"num_sold"</span>]).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>val_features <span class="op">=</span> pandas.DataFrame(val_subset.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>)).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Optuna Objective</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> arimax_objective(trial):</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select ranges for p, d, q orders</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  p_order <span class="op">=</span> trial.suggest_int(<span class="st">"p_order"</span>, <span class="dv">0</span>, <span class="dv">10</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  d_order <span class="op">=</span> trial.suggest_int(<span class="st">"d_order"</span>, <span class="dv">0</span>, <span class="dv">2</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  q_order <span class="op">=</span> trial.suggest_int(<span class="st">"q_order"</span>, <span class="dv">0</span>, <span class="dv">10</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trend order according to d_order differencing</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  trend_order <span class="op">=</span> <span class="bu">list</span>(np.zeros(d_order))</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  trend_order.append(<span class="dv">1</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define model with trial variables</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  arimax_model <span class="op">=</span> statsmodels.tsa.arima.model.ARIMA(</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    order<span class="op">=</span>(p_order, d_order, q_order),</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    endog<span class="op">=</span>train_targets,</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">=</span>trend_order,</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    exog<span class="op">=</span>train_features</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  arimax_model_results <span class="op">=</span> arimax_model.fit()</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forecast for the last year</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  forecast_arimax_tuned <span class="op">=</span> arimax_model_results.forecast(<span class="dv">365</span>, exog<span class="op">=</span>test_features)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  forecast_arimax_tuned <span class="op">=</span> pandas.DataFrame(forecast_arimax_tuned).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_targets)):</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>    cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>      storage, </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>      test_targets[<span class="st">"num_sold"</span>][step], </span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>      forecast_arimax_tuned[<span class="st">"predicted_mean"</span>][step], </span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>      book_price, </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>      monthly_storage_cost</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>  total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage<span class="op">*</span>book_price</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> total_cost</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Optuna Study and Minimize total_cost</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>arimax_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>)</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>arimax_study.optimize(arimax_objective, n_trials<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-cache="true" data-execution_count="29">
<details>
<summary>Forecasts with Best ARIMAX Parameters Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the parameters of the best model</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>best_arimax_model_parameters <span class="op">=</span> arimax_study.best_params</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Trend order according to d_order differencing</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>trend_order <span class="op">=</span> <span class="bu">list</span>(np.zeros(best_arimax_model_parameters[<span class="st">"d_order"</span>]))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>trend_order.append(<span class="dv">1</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Arimax model with the best parameters and train on test data</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>arimax_model <span class="op">=</span> statsmodels.tsa.arima.model.ARIMA(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  order<span class="op">=</span>(best_arimax_model_parameters[<span class="st">"p_order"</span>],</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  best_arimax_model_parameters[<span class="st">"d_order"</span>],</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  best_arimax_model_parameters[<span class="st">"q_order"</span>]),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  endog<span class="op">=</span>test_targets,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  trend<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  exog<span class="op">=</span>test_features)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>arimax_model_results <span class="op">=</span> arimax_model.fit()</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the last year</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>forecast_arimax_tuned <span class="op">=</span> arimax_model_results.forecast(<span class="dv">366</span>, exog<span class="op">=</span>val_features)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>forecast_arimax_tuned <span class="op">=</span> pandas.DataFrame(forecast_arimax_tuned).reset_index().drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(val_targets)):</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    storage, </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    val_targets[<span class="st">"num_sold"</span>][step], </span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    forecast_arimax_tuned[<span class="st">"predicted_mean"</span>][step], </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    book_price, </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    monthly_storage_cost)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>arimax_total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage<span class="op">*</span>book_price</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>plot_forecasts(val_targets, forecast_arimax_tuned, title<span class="op">=</span><span class="st">"ARIMAX Tuned Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>                            <div id="4dff54f2-c416-489f-a8f1-556f8b5b17c6" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("4dff54f2-c416-489f-a8f1-556f8b5b17c6")) {                    Plotly.newPlot(                        "4dff54f2-c416-489f-a8f1-556f8b5b17c6",                        [{"hovertemplate":"=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[142.0,98.0,109.0,102.0,116.0,99.0,83.0,90.0,84.0,91.0,93.0,113.0,78.0,89.0,87.0,88.0,89.0,101.0,101.0,82.0,92.0,88.0,91.0,90.0,102.0,99.0,89.0,88.0,90.0,85.0,89.0,103.0,104.0,87.0,84.0,83.0,86.0,91.0,102.0,97.0,91.0,85.0,87.0,88.0,85.0,92.0,91.0,84.0,83.0,83.0,81.0,82.0,89.0,105.0,83.0,83.0,81.0,76.0,80.0,99.0,86.0,78.0,77.0,70.0,72.0,70.0,86.0,86.0,67.0,75.0,73.0,71.0,73.0,78.0,93.0,69.0,67.0,66.0,74.0,76.0,80.0,92.0,72.0,71.0,69.0,69.0,66.0,76.0,73.0,65.0,72.0,61.0,55.0,56.0,60.0,69.0,55.0,54.0,59.0,58.0,60.0,69.0,71.0,56.0,64.0,64.0,59.0,66.0,74.0,76.0,52.0,55.0,48.0,54.0,55.0,57.0,66.0,57.0,55.0,53.0,55.0,59.0,69.0,75.0,65.0,63.0,67.0,68.0,63.0,67.0,69.0,64.0,56.0,52.0,56.0,62.0,69.0,68.0,57.0,58.0,60.0,58.0,61.0,74.0,75.0,65.0,63.0,61.0,62.0,68.0,65.0,68.0,65.0,63.0,60.0,62.0,70.0,75.0,79.0,63.0,63.0,60.0,69.0,64.0,70.0,70.0,61.0,56.0,60.0,58.0,62.0,75.0,74.0,57.0,65.0,58.0,59.0,59.0,73.0,73.0,60.0,66.0,68.0,65.0,65.0,70.0,77.0,62.0,66.0,67.0,70.0,67.0,69.0,68.0,64.0,65.0,61.0,61.0,68.0,69.0,76.0,56.0,63.0,64.0,59.0,66.0,75.0,76.0,61.0,64.0,65.0,60.0,69.0,76.0,79.0,67.0,66.0,70.0,64.0,64.0,81.0,78.0,70.0,64.0,69.0,70.0,61.0,78.0,78.0,71.0,67.0,77.0,72.0,72.0,71.0,78.0,69.0,73.0,69.0,69.0,67.0,80.0,86.0,66.0,70.0,70.0,72.0,75.0,86.0,83.0,71.0,63.0,72.0,71.0,67.0,81.0,82.0,73.0,65.0,77.0,61.0,81.0,89.0,79.0,69.0,76.0,68.0,76.0,77.0,82.0,91.0,68.0,71.0,71.0,82.0,72.0,90.0,103.0,77.0,80.0,86.0,90.0,86.0,94.0,98.0,78.0,77.0,77.0,84.0,89.0,95.0,102.0,80.0,84.0,84.0,80.0,71.0,81.0,99.0,79.0,76.0,79.0,81.0,86.0,100.0,96.0,76.0,74.0,86.0,82.0,76.0,91.0,100.0,80.0,87.0,80.0,81.0,87.0,97.0,104.0,79.0,76.0,87.0,76.0,86.0,98.0,95.0,76.0,88.0,82.0,83.0,91.0,87.0,90.0,84.0,83.0,83.0,82.0,87.0,85.0,107.0,85.0,80.0,88.0,78.0,86.0,99.0,98.0,86.0,82.0,84.0,89.0,85.0,102.0,90.0,79.0,83.0,87.0,84.0,94.0,122.0,131.0,126.0,157.0,169.0,143.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[44.226151582131564,41.44743165133197,36.70122642146226,39.5166044042146,29.112854848795948,14.747146740107883,10.968340941313205,7.94268313782235,2.0458007510347667,9.941450599997793,18.5227870741145,23.498716213222114,11.722072532620498,7.369680258962025,10.038218365352098,9.370070177092199,17.301399829365952,24.768829860245066,30.973293972311637,15.395461905780945,15.269716534356082,13.09683690810921,11.654051573463473,20.9161122991955,27.65719933735889,33.29864831595479,21.15817385887895,18.308955726353112,19.05930826691526,17.69005128353338,23.45465796775247,27.825412027292177,32.194117391428385,17.374053801413076,13.793414305298471,13.003620669253529,13.234079943103021,19.637433739007264,25.39466202396198,27.975285177904517,13.33013978918463,11.849865819335692,8.689141112214841,12.055224452332988,11.121404896206563,21.63578973988522,24.6732823332081,11.543442617163029,7.602442079721066,6.032914396981616,4.498727465127444,9.343384182637926,16.045150479289465,19.39150529410461,7.639907637372008,4.3273204407894506,3.3883262596701518,6.565403410733187,8.73626935430584,19.228762586216394,27.41495282548267,10.817306622354579,10.692293225091817,7.367216249169296,7.307154548358263,12.08435152369888,23.060810073960685,25.487893105906725,7.084543895098758,7.023633357976055,5.84396163830134,3.670725680081891,11.649203753641135,15.223860652083335,22.400957114973234,4.663901284506268,6.248341096081899,2.613460019806678,2.0187906828566615,5.252015271041928,14.761582370812226,18.178625477011607,0.7443476622129304,3.802994068735676,0.9375389532828096,1.04415780857963,8.984166192777444,15.862297492292791,23.168306677620265,6.604891549825617,7.150003943423471,0.6788985799508087,-0.1305994668494363,5.523215421882923,12.256064059080128,17.966737630956704,2.9756998844182836,11.974291922219493,8.407770073125837,5.798216062967026,8.06771772333799,20.30540718542148,23.85116782599988,8.6115777477435,5.904648038156235,7.01317109848207,4.991832770608896,4.587618219925637,10.888112915287692,15.927514600482212,-0.7321018188768142,-1.0076888137644735,-3.7367821831560484,-5.547676568739768,3.097359083186653,10.068247773644234,15.718360167682395,3.668221744407038,8.33250768035569,9.38487221298572,8.346055503386145,6.961076421195156,18.49602521979411,25.056881359644294,7.260843165726909,-1.2273951225516315,-1.5880705810599824,0.6042700303377468,2.2525253078448797,8.475793106574717,14.981398955040843,-0.8171638894384695,-3.8703377415197955,-1.1367724453072554,-6.467371539689238,-0.21694303379156027,6.528534267503974,14.558821248850302,3.8650644174057134,2.250667856083719,0.0955074546987445,-2.8456810407312543,2.949712608890969,9.87180983295663,19.243691028212385,-6.160812634648415,-7.179978736574168,-4.736602043581734,-7.002490409520672,6.836002043088074,14.537928591018982,21.309612730612717,2.3382142663076104,3.7394938407221825,3.8261379166492078,1.3531471812536038,-1.82517586150568,7.39221472076909,14.891862430590812,-3.6570606492205533,-7.506387601212786,-7.409476580931164,-7.8145424508088706,-5.4822436892907875,6.909332547771336,6.969721699984389,-6.889488425853824,-10.125007346804239,-8.408236186663778,-11.290731122108253,-7.418893661512771,0.18753753457639674,6.164057812871421,-11.462846553454193,-14.412287210224095,-11.242987052702187,-13.363433644719457,-8.783429801207888,3.5347289198221885,6.879220120440428,-6.851017535490952,-8.907888419426754,-7.32672154560074,-8.17505595814743,-2.5505250934115735,4.159751619878035,9.853076714766932,-5.146854380348581,-3.8260605742935705,-7.37993226810461,-9.968577916973384,-4.247693839651555,4.612800320042721,8.214655663798304,-3.537259405567308,-9.586439494422171,-8.386011600460524,-10.301176459164912,-2.9059003724739108,3.52640482138407,8.711645468808234,-7.78709498351575,-7.8875086718349925,-10.42793277172731,-12.036021306100753,-3.1731172279805326,4.030357986141691,9.926857481207318,-1.8630901574023786,-4.604476391932849,-3.2631828067186404,-3.9996418288750797,2.3479456603030373,3.0951495216702107,8.062102262634953,-6.021366481992483,-8.914399613230946,-9.181800267649217,-8.363195628000462,-1.256087920530877,5.223772980659893,8.37567470960621,-5.690933778654334,-6.517767416697558,-8.964954145020199,-4.990711501412546,-5.349756231656043,5.784702612066463,9.507138577018864,-2.9909875577357354,-6.354584692651128,-7.329312050195168,-8.214856169187145,-2.739815867844468,4.537713678205467,8.450088372633774,-2.6982692377888386,-5.408942425187761,-5.790706558032921,-2.0854595661195905,0.6312453609917978,11.674108462764726,16.343043305086482,2.5659512905954505,-0.07527982216558242,-1.4957054645591035,-0.19045790782043748,2.2710740171025514,11.604980182892803,17.732281611259854,4.621869120830772,0.9874478812802788,-2.3323215315034957,-1.0898344709637304,3.36319583087803,10.447768622176936,19.666536723955524,-0.9686147694677641,-0.0012470229058739574,-2.7973370353178186,-0.02710692165330688,1.854682136541291,10.38362677770742,14.72102127000671,-0.09503828501605585,-2.992923113777695,-5.600670001584284,-1.4755006240414852,1.071169434390459,10.211822615905772,19.165525259139525,1.6233832703465363,2.52976595431715,8.404413103479943,9.58199311959366,13.315089859573321,19.996790565426803,26.68346484331434,11.413744251748634,10.977656108217674,4.800499012151535,2.049501351558747,3.981872013848848,14.124712944506918,19.489942034255556,2.0826965048055945,4.853728209739062,-1.0486743735270996,0.9245590467401408,3.5059739694459613,15.304518320515214,18.22872605419625,2.3979878690474945,0.42134624549141986,0.4729439182485102,-1.2833207495061096,1.6226718163192877,14.912500592443727,18.637673541694525,3.5540942978190713,6.328204144534653,3.7867829516061295,5.966098599049086,9.803386795047023,20.643249223485444,18.623376597501135,2.686545252460315,3.248649649672352,0.642129745478761,1.3041298143334137,6.792471897568804,18.49221976937391,21.66916766145019,4.025636539614806,4.716538084470462,4.29144933864668,2.8918863168361373,11.656767424216786,16.013618612928575,23.97044042982936,7.024395279417681,9.412054864351518,6.579443992420157,6.782181981243399,10.817346262279026,21.13820441850325,25.367491741476773,8.73987095565661,12.604490875002325,10.550316394309485,11.469465995880523,20.21642236538376,27.89711692490764,36.0067014322335,20.247021871721625,8.472281815593899,7.649183642226025,9.563703436938352,12.645556402972282,22.609891876273057,29.376747641431965,16.913990745750088,13.934264192692833,11.275130059820015,13.183060412371244,18.30517787786623,26.061288582967105,35.9528257468571,15.990430960341696,17.629278446298375,15.50210837326414,18.93740040382395,21.47908257637526,30.661431161343405,35.644413540728955,21.464795444232983,26.873166830322166,24.87957848152673,29.60577812922788,29.31841353747253,39.02991062144154,51.95804846077896,34.95141802680717,36.37376292009484,35.06330624510519,37.08501599748573],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"index"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"ARIMAX Tuned Forecasts"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('4dff54f2-c416-489f-a8f1-556f8b5b17c6');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Earlier ARIMAX model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_reg[<span class="st">'num_sold'</span>], forecast_reg)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Tuned ARIMAX model is: </span><span class="sc">{</span>mean_absolute_percentage_error(val_targets[<span class="st">'num_sold'</span>], forecast_arimax_tuned[<span class="st">'predicted_mean'</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Earlier ARIMAX model is: </span><span class="sc">{</span>r2_score(test_reg[<span class="st">'num_sold'</span>], forecast_reg)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Tuned ARIMAX model is: </span><span class="sc">{</span>r2_score(val_targets[<span class="st">'num_sold'</span>], forecast_arimax_tuned[<span class="st">'predicted_mean'</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Cost for tuned ARIMAX model is: €</span><span class="sc">{</span>arimax_total_cost<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for Earlier ARIMAX model is: 0.6281181684643169
MAPE for Tuned ARIMAX model is: 0.9091655799646171

R2 Score for Earlier ARIMAX model is: -7.921475722370131
R2 Score for Tuned ARIMAX model is: -18.59284765359555

Total Cost for tuned ARIMAX model is: €505,022.00</code></pre>
</div>
</div>
</section>
<section id="xgboost-tuning" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="xgboost-tuning"><span class="header-section-number">5.3</span> XGBoost Tuning</h2>
<div class="cell" data-cache="true" data-execution_count="31">
<details>
<summary>XGBoost Optuna Tuning and regression_forecast Function</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train - test- validation data</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>subset_xgboost_tuned <span class="op">=</span> regression_matrix[</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    (regression_matrix[<span class="st">"country_Germany"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (regression_matrix[<span class="st">"store_KaggleRama"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (regression_matrix[<span class="st">"product_Kaggle Recipe Book"</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>subset_xgboost_tuned <span class="op">=</span> subset_xgboost_tuned.drop(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_France"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Germany"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Poland"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Italy"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"country_Spain"</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"store_KaggleRama"</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Getting Started"</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle Recipe Book"</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"product_Kaggle for Kids: One Smart Goose"</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Define train - test - validation features and targets</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>train_subset_xgboost_tuned, test_subset_xgboost_tuned <span class="op">=</span> temporal_train_test_split(</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    subset_xgboost_tuned, train_size<span class="op">=</span><span class="dv">730</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>test_subset_xgboost_tuned, val_subset_xgboost_tuned <span class="op">=</span> temporal_train_test_split(</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    test_subset_xgboost_tuned, test_size<span class="op">=</span><span class="dv">366</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>train_targets_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(train_subset_xgboost_tuned[<span class="st">"num_sold"</span>])</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>train_features_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(train_subset_xgboost_tuned.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>))</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>test_targets_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(test_subset_xgboost_tuned[<span class="st">"num_sold"</span>])</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>test_features_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(test_subset_xgboost_tuned.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>))</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>val_targets_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(val_subset_xgboost_tuned[<span class="st">"num_sold"</span>])</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>val_features_xgboost_tuned <span class="op">=</span> (</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    pandas.DataFrame(val_subset_xgboost_tuned.drop(columns<span class="op">=</span><span class="st">"num_sold"</span>))</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Define forecasting function</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_forecast(</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    train_features, forecast_features, model, window_size, scaled<span class="op">=</span><span class="va">False</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the last column of training data</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    history <span class="op">=</span> train_features.tail(<span class="dv">1</span>)</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>    forecasts <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(forecast_features)):</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> model.predict(history.tail(<span class="dv">1</span>))</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get features of data to be forecasted</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        next_sample <span class="op">=</span> forecast_features.head(<span class="dv">1</span>)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Shift previous values to 1 left</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>        next_sample[<span class="bu">list</span>(<span class="bu">range</span>(window_size))] <span class="op">=</span> (</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>            history.tail(<span class="dv">1</span>)[<span class="bu">list</span>(<span class="bu">range</span>(window_size))].shift(<span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">1</span>).values</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If scaled, inverse transform</span></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scaled <span class="op">!=</span> <span class="va">False</span>:</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>            next_sample[<span class="bu">list</span>(<span class="bu">range</span>(window_size))] <span class="op">=</span> scaler.inverse_transform(</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>                next_sample[<span class="bu">list</span>(<span class="bu">range</span>(window_size))]</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add prediction to the right</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>            next_sample[window_size <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> prediction</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Scale values again before forecasting</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>            next_sample[<span class="bu">list</span>(<span class="bu">range</span>(window_size))] <span class="op">=</span> scaler.transform(</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>                next_sample[<span class="bu">list</span>(<span class="bu">range</span>(window_size))]</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add prediction to the right</span></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>            next_sample[window_size <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> prediction</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add last values to history</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>        history <span class="op">=</span> pandas.concat([history, next_sample], ignore_index<span class="op">=</span><span class="va">True</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Drop uppermost row from forecast features</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>        forecast_features <span class="op">=</span> forecast_features.drop(index<span class="op">=</span><span class="bu">min</span>(forecast_features.index))</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add current prediction the forecasts as a seperate list</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>        forecasts.append(prediction)</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pandas.DataFrame(forecasts, columns<span class="op">=</span>[<span class="st">"prediction"</span>])</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Optuna Objective</span></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> xgboost_objective(trial):</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define trial variables</span></span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>    booster <span class="op">=</span> trial.suggest_categorical(<span class="st">"booster"</span>, [<span class="st">"gbtree"</span>, <span class="st">"gblinear"</span>, <span class="st">"dart"</span>])</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> booster <span class="kw">in</span> [<span class="st">"gbtree"</span>, <span class="st">"dart"</span>]:</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> trial.suggest_float(<span class="st">"eta"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>        gamma <span class="op">=</span> trial.suggest_int(<span class="st">"gamma"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>        max_depth <span class="op">=</span> trial.suggest_int(<span class="st">"max_depth"</span>, <span class="dv">1</span>, <span class="dv">50</span>)</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>        min_child_weight <span class="op">=</span> trial.suggest_int(<span class="st">"min_child_weight"</span>, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>        subsample <span class="op">=</span> trial.suggest_float(<span class="st">"subsample"</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>        reg_lambda <span class="op">=</span> trial.suggest_float(<span class="st">"lambda"</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>        alpha <span class="op">=</span> trial.suggest_float(<span class="st">"alpha"</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define model with trial variables</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>        xgboost_model <span class="op">=</span> XGBRegressor(</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>            booster<span class="op">=</span>booster,</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>            learning_rate<span class="op">=</span>eta,</span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>            min_split_loss<span class="op">=</span>gamma,</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>            max_depth<span class="op">=</span>max_depth,</span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>            min_child_weight<span class="op">=</span>min_child_weight,</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>            subsample<span class="op">=</span>subsample,</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>            reg_lambda<span class="op">=</span>reg_lambda,</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>            reg_alpha<span class="op">=</span>alpha,</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>        reg_lambda <span class="op">=</span> trial.suggest_float(<span class="st">"lambda"</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a>        alpha <span class="op">=</span> trial.suggest_float(<span class="st">"alpha"</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>        updater <span class="op">=</span> trial.suggest_categorical(<span class="st">"updater"</span>, [<span class="st">"shotgun"</span>, <span class="st">"coord_descent"</span>])</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>        feature_selector <span class="op">=</span> trial.suggest_categorical(</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>            <span class="st">"feature_selector"</span>, [<span class="st">"cyclic"</span>, <span class="st">"shuffle"</span>]</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define model with trial variables</span></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>        xgboost_model <span class="op">=</span> XGBRegressor(</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>            booster<span class="op">=</span>booster,</span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>            reg_lambda<span class="op">=</span>reg_lambda,</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>            reg_alpha<span class="op">=</span>alpha,</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a>            updater<span class="op">=</span>updater,</span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>            feature_selector<span class="op">=</span>feature_selector,</span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the model</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>    xgboost_model.fit(train_features_xgboost_tuned, train_targets_xgboost_tuned)</span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forecast for the test data but this time using model's predicted values as past values</span></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a>    forecast_xgboost_tuned <span class="op">=</span> regression_forecast(</span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a>        train_features_xgboost_tuned, </span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a>        test_features_xgboost_tuned, </span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>        xgboost_model, </span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span></span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>    book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a>    monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_targets_xgboost_tuned)):</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>        cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>            storage,</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>            test_targets_xgboost_tuned[<span class="st">"num_sold"</span>][step],</span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>            forecast_xgboost_tuned[<span class="st">"prediction"</span>][step],</span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>            book_price,</span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>            monthly_storage_cost,</span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>        cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>        storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a>    total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage <span class="op">*</span> book_price</span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_cost</span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Optuna Study and Minimize total_cost</span></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>xgboost_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>)</span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>xgboost_study.optimize(xgboost_objective, n_trials<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="32">
<details>
<summary>XGBoost Model with Best Parameters Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>best_xgboost_model_parameters <span class="op">=</span> xgboost_study.best_params</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> best_xgboost_model_parameters[<span class="st">"booster"</span>] <span class="kw">in</span> [<span class="st">"gbtree"</span>, <span class="st">"dart"</span>]:</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    xgboost_model <span class="op">=</span> XGBRegressor(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        booster<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"booster"</span>],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        learning_rate<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"eta"</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        min_split_loss<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"gamma"</span>],</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"max_depth"</span>],</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        min_child_weight<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"min_child_weight"</span>],</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        subsample<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"subsample"</span>],</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        reg_lambda<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"lambda"</span>],</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        reg_alpha<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"alpha"</span>]</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    xgboost_model <span class="op">=</span> XGBRegressor(</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        booster<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"booster"</span>],</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        reg_lambda<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"lambda"</span>],</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        reg_alpha<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"alpha"</span>],</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        updater<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"updater"</span>],</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        feature_selector<span class="op">=</span>best_xgboost_model_parameters[<span class="st">"feature_selector"</span>]</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model with the best parameters</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>xgboost_model.fit(test_features_xgboost_tuned, test_targets_xgboost_tuned)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the test data but this time using model's predicted values as past values</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>forecast_xgboost_tuned <span class="op">=</span> regression_forecast(</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  test_features_xgboost_tuned,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  val_features_xgboost_tuned,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  xgboost_model,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(val_targets_xgboost_tuned)):</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>      storage, </span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>      val_targets_xgboost_tuned[<span class="st">"num_sold"</span>][step], </span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>      forecast_xgboost_tuned[<span class="st">"prediction"</span>][step], </span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>      book_price, </span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>      monthly_storage_cost)</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>xgboost_total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage<span class="op">*</span>book_price</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the forecasts compared to validation data</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>plot_forecasts(val_targets_xgboost_tuned, forecast_xgboost_tuned, title<span class="op">=</span><span class="st">"XGBoost Tuned Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>                            <div id="b7b6158c-051e-4590-a95d-b73148bc0594" class="plotly-graph-div" style="height:500px; width:700px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("b7b6158c-051e-4590-a95d-b73148bc0594")) {                    Plotly.newPlot(                        "b7b6158c-051e-4590-a95d-b73148bc0594",                        [{"hovertemplate":"=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Observed","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Observed","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[142.0,98.0,109.0,102.0,116.0,99.0,83.0,90.0,84.0,91.0,93.0,113.0,78.0,89.0,87.0,88.0,89.0,101.0,101.0,82.0,92.0,88.0,91.0,90.0,102.0,99.0,89.0,88.0,90.0,85.0,89.0,103.0,104.0,87.0,84.0,83.0,86.0,91.0,102.0,97.0,91.0,85.0,87.0,88.0,85.0,92.0,91.0,84.0,83.0,83.0,81.0,82.0,89.0,105.0,83.0,83.0,81.0,76.0,80.0,99.0,86.0,78.0,77.0,70.0,72.0,70.0,86.0,86.0,67.0,75.0,73.0,71.0,73.0,78.0,93.0,69.0,67.0,66.0,74.0,76.0,80.0,92.0,72.0,71.0,69.0,69.0,66.0,76.0,73.0,65.0,72.0,61.0,55.0,56.0,60.0,69.0,55.0,54.0,59.0,58.0,60.0,69.0,71.0,56.0,64.0,64.0,59.0,66.0,74.0,76.0,52.0,55.0,48.0,54.0,55.0,57.0,66.0,57.0,55.0,53.0,55.0,59.0,69.0,75.0,65.0,63.0,67.0,68.0,63.0,67.0,69.0,64.0,56.0,52.0,56.0,62.0,69.0,68.0,57.0,58.0,60.0,58.0,61.0,74.0,75.0,65.0,63.0,61.0,62.0,68.0,65.0,68.0,65.0,63.0,60.0,62.0,70.0,75.0,79.0,63.0,63.0,60.0,69.0,64.0,70.0,70.0,61.0,56.0,60.0,58.0,62.0,75.0,74.0,57.0,65.0,58.0,59.0,59.0,73.0,73.0,60.0,66.0,68.0,65.0,65.0,70.0,77.0,62.0,66.0,67.0,70.0,67.0,69.0,68.0,64.0,65.0,61.0,61.0,68.0,69.0,76.0,56.0,63.0,64.0,59.0,66.0,75.0,76.0,61.0,64.0,65.0,60.0,69.0,76.0,79.0,67.0,66.0,70.0,64.0,64.0,81.0,78.0,70.0,64.0,69.0,70.0,61.0,78.0,78.0,71.0,67.0,77.0,72.0,72.0,71.0,78.0,69.0,73.0,69.0,69.0,67.0,80.0,86.0,66.0,70.0,70.0,72.0,75.0,86.0,83.0,71.0,63.0,72.0,71.0,67.0,81.0,82.0,73.0,65.0,77.0,61.0,81.0,89.0,79.0,69.0,76.0,68.0,76.0,77.0,82.0,91.0,68.0,71.0,71.0,82.0,72.0,90.0,103.0,77.0,80.0,86.0,90.0,86.0,94.0,98.0,78.0,77.0,77.0,84.0,89.0,95.0,102.0,80.0,84.0,84.0,80.0,71.0,81.0,99.0,79.0,76.0,79.0,81.0,86.0,100.0,96.0,76.0,74.0,86.0,82.0,76.0,91.0,100.0,80.0,87.0,80.0,81.0,87.0,97.0,104.0,79.0,76.0,87.0,76.0,86.0,98.0,95.0,76.0,88.0,82.0,83.0,91.0,87.0,90.0,84.0,83.0,83.0,82.0,87.0,85.0,107.0,85.0,80.0,88.0,78.0,86.0,99.0,98.0,86.0,82.0,84.0,89.0,85.0,102.0,90.0,79.0,83.0,87.0,84.0,94.0,122.0,131.0,126.0,157.0,169.0,143.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>","legendgroup":"Predicted","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Predicted","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365],"xaxis":"x","y":[155.74530029296875,137.20004272460938,116.5306625366211,102.77574157714844,107.21173095703125,128.36126708984375,121.39527893066406,100.43810272216797,101.29459381103516,79.03701782226562,96.75978088378906,100.44857025146484,117.36219787597656,88.3681869506836,83.18113708496094,86.4070053100586,88.61793518066406,88.72276306152344,98.53453063964844,109.52726745605469,96.25370788574219,97.66734313964844,92.51795196533203,95.28888702392578,97.14210510253906,97.03517150878906,112.20768737792969,89.15873718261719,92.39054870605469,84.28689575195312,83.346923828125,92.31771087646484,101.6893310546875,106.79254150390625,87.83882141113281,86.47601318359375,85.508544921875,90.17292022705078,97.88912200927734,97.6564712524414,103.68661499023438,89.29464721679688,83.35855102539062,91.95790100097656,96.0521011352539,87.40044403076172,89.80717468261719,105.13020324707031,95.51338958740234,83.94343566894531,86.54666137695312,96.98283386230469,88.68406677246094,94.4090576171875,106.97482299804688,87.88162994384766,86.87411499023438,84.33199310302734,83.08439636230469,87.37870025634766,97.30538177490234,104.86436462402344,85.3580093383789,78.52580261230469,85.05775451660156,85.47007751464844,86.8536376953125,96.94332885742188,103.7183837890625,79.67913818359375,90.04600524902344,88.99927520751953,86.13349914550781,84.62428283691406,94.25212860107422,96.99982452392578,86.81400299072266,84.44583892822266,82.47258758544922,83.28624725341797,88.93536376953125,91.00894165039062,98.6312484741211,82.30976867675781,85.17594909667969,81.8416748046875,79.9613037109375,86.00945281982422,91.34809875488281,98.29447174072266,76.6062240600586,76.87747955322266,84.48351287841797,84.09722900390625,79.17904663085938,93.4567642211914,98.93130493164062,81.30730438232422,82.03330993652344,81.79576873779297,79.35804748535156,81.3603744506836,92.77621459960938,91.71825408935547,79.28289794921875,76.31112670898438,77.17913818359375,78.60519409179688,87.37225341796875,91.86006927490234,100.70649719238281,81.44892120361328,79.93279266357422,90.76454162597656,84.60226440429688,88.26410675048828,97.760498046875,102.85709381103516,86.598876953125,90.70027160644531,81.51693725585938,86.55197143554688,77.67456817626953,98.21102905273438,86.06101989746094,68.15038299560547,80.59917449951172,79.3335952758789,91.04059600830078,80.2054672241211,81.3901138305664,75.98050689697266,69.39927673339844,69.1978759765625,73.63642883300781,81.8333740234375,81.66732025146484,91.02197265625,79.7227783203125,78.22846221923828,68.93220520019531,69.4681625366211,75.47166442871094,76.33995819091797,84.17743682861328,75.73552703857422,72.56012725830078,67.59613800048828,78.3647689819336,71.60175323486328,63.36985397338867,84.90125274658203,81.19195556640625,74.87446594238281,70.6572265625,78.33824920654297,78.03302764892578,71.73087310791016,74.7562255859375,87.36600494384766,83.73592376708984,68.24103546142578,67.52215576171875,76.19209289550781,73.7517318725586,85.67610931396484,91.88418579101562,85.27262878417969,71.48458099365234,72.02751159667969,72.24427795410156,72.80718231201172,71.9461441040039,85.2525634765625,77.63294219970703,65.8691635131836,68.57966613769531,69.96894836425781,72.92496490478516,75.59083557128906,82.75535583496094,81.20818328857422,65.62979888916016,68.64337921142578,70.44001770019531,73.20162963867188,83.435546875,87.157958984375,75.91429901123047,66.17720031738281,71.32132720947266,66.2435531616211,72.25849151611328,80.47265625,90.53968811035156,75.61775207519531,74.2557373046875,69.27375030517578,66.7339096069336,73.23461151123047,77.55992889404297,93.4969482421875,70.96275329589844,71.96884155273438,73.59139251708984,67.73332977294922,84.53031158447266,80.78861999511719,87.92093658447266,77.53298950195312,72.1490249633789,69.82321166992188,72.3230972290039,67.3727035522461,84.649658203125,92.53506469726562,78.03612518310547,71.95266723632812,66.85357666015625,71.73802185058594,75.61334228515625,79.82563781738281,88.19205474853516,83.16568756103516,72.45709228515625,72.28972625732422,71.31674194335938,73.70565795898438,85.34938049316406,93.48194122314453,84.30848693847656,72.50313568115234,70.61103820800781,69.47038269042969,75.93952941894531,82.46684265136719,88.37446594238281,83.17103576660156,73.17172241210938,71.9374771118164,73.70453643798828,72.6166000366211,78.91649627685547,91.0748062133789,80.88047790527344,81.82186889648438,80.58192443847656,80.18109893798828,86.55770874023438,90.1462173461914,89.67547607421875,83.8795166015625,83.10065460205078,82.59225463867188,83.19611358642578,79.10295104980469,84.1082763671875,95.41415405273438,80.3244857788086,80.80046081542969,86.80158996582031,79.86013793945312,80.01203155517578,88.805419921875,87.48954010009766,86.05549621582031,77.46590423583984,72.80581665039062,78.99729919433594,78.49495697021484,85.90257263183594,93.5852279663086,79.91542053222656,82.5401382446289,87.25621032714844,80.23393249511719,82.73054504394531,80.87359619140625,96.58052825927734,83.60774230957031,81.7618637084961,85.1950454711914,80.56719970703125,91.15876770019531,87.53929901123047,91.24504852294922,79.7907485961914,81.39923095703125,83.82184600830078,87.95507049560547,79.75132751464844,82.77545928955078,86.52549743652344,75.83380889892578,74.1224594116211,79.77522277832031,82.49113464355469,81.31053161621094,91.89158630371094,103.82080078125,88.14663696289062,79.5547866821289,79.41597747802734,79.0360107421875,87.40130615234375,89.96112060546875,94.68620300292969,83.70504760742188,83.67961120605469,80.7089614868164,84.21888732910156,82.26246643066406,95.04216003417969,111.99673461914062,96.0154037475586,81.37117767333984,88.6397705078125,78.59658813476562,95.2176742553711,105.30011749267578,117.05381774902344,85.78548431396484,85.84906768798828,81.27458953857422,85.70213317871094,89.76964569091797,102.75492095947266,110.55262756347656,86.54116821289062,75.55826568603516,80.64232635498047,87.35928344726562,89.00125122070312,99.9877700805664,110.33457946777344,91.54115295410156,86.37187957763672,88.38167572021484,83.82073211669922,89.26573181152344,93.909912109375,105.95601654052734,89.82198333740234,80.51289367675781,88.2228775024414,82.65459442138672,89.69256591796875,96.81230926513672,111.03800201416016,85.9352798461914,84.7798843383789,89.73881530761719,85.15292358398438,85.27128601074219,98.25809478759766,108.25689697265625,81.42839813232422,85.8164291381836,80.11691284179688,93.79608917236328,101.54069519042969,139.2329559326172,168.7577667236328,163.8039093017578,159.2863311767578,142.28863525390625],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"index"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Sales"}},"legend":{"title":{"text":""},"tracegroupgap":0},"title":{"text":"XGBoost Tuned Forecasts"},"height":500,"width":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b7b6158c-051e-4590-a95d-b73148bc0594');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div class="cell" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Earlier XGBoost model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_targets_xgboost, forecast_xgboost)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for Tuned XGBoost model is: </span><span class="sc">{</span>mean_absolute_percentage_error(val_targets_xgboost_tuned, forecast_xgboost_tuned)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Earlier XGBoost model is: </span><span class="sc">{</span>mean_absolute_percentage_error(test_targets_xgboost, forecast_xgboost)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for Tuned XGBoost model is: </span><span class="sc">{</span>r2_score(val_targets_xgboost_tuned, forecast_xgboost_tuned)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total Cost for Tuned XGBoost model is: €</span><span class="sc">{</span>xgboost_total_cost<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAPE for Earlier XGBoost model is: 0.09307335208975362
MAPE for Tuned XGBoost model is: 0.1667327819877228

R2 Score for Earlier XGBoost model is: 0.09307335208975362
R2 Score for Tuned XGBoost model is: 0.05834389322854061

Total Cost for Tuned XGBoost model is: €64,838.00</code></pre>
</div>
</div>
<p>Tuning for XGBoost model loses some accuracy due to the difference between lagged value features. Earlier model was using real targets as lagged value, while this tuned and correct model uses its own forecasts as lagged values. We’ll create and tune deep learning models on</p>
<p align="center">
</p><p style="font-size:25px">
<a href="../../posts/book-forecasting/book_sales_forecasting_deep_learning_part.html"><b>Part 2 -&gt;</b></a>
</p>
<p></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>