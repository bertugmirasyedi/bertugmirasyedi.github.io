<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

  <meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.269">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

  <meta name="dcterms.date" content="2022-12-20">
  <meta name="description" content="Deep Learning Models">

  <title>Data and Decisions - Book Sales Forecasting: Comparison of Different Models Part 2</title>
  <style>
    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    div.columns {
      display: flex;
      gap: min(4vw, 1.5em);
    }

    div.column {
      flex: auto;
      overflow-x: auto;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }

    pre>code.sourceCode {
      white-space: pre;
      position: relative;
    }

    pre>code.sourceCode>span {
      display: inline-block;
      line-height: 1.25;
    }

    pre>code.sourceCode>span:empty {
      height: 1.2em;
    }

    .sourceCode {
      overflow: visible;
    }

    code.sourceCode>span {
      color: inherit;
      text-decoration: inherit;
    }

    div.sourceCode {
      margin: 1em 0;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      pre>code.sourceCode {
        white-space: pre-wrap;
      }

      pre>code.sourceCode>span {
        text-indent: -5em;
        padding-left: 5em;
      }
    }

    pre.numberSource code {
      counter-reset: source-line 0;
    }

    pre.numberSource code>span {
      position: relative;
      left: -4em;
      counter-increment: source-line;
    }

    pre.numberSource code>span>a:first-child::before {
      content: counter(source-line);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
      color: #aaaaaa;
    }

    pre.numberSource {
      margin-left: 3em;
      border-left: 1px solid #aaaaaa;
      padding-left: 4px;
    }

    div.sourceCode {}

    @media screen {
      pre>code.sourceCode>span>a:first-child::before {
        text-decoration: underline;
      }
    }

    code span.al {
      color: #ff0000;
      font-weight: bold;
    }

    /* Alert */
    code span.an {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Annotation */
    code span.at {
      color: #7d9029;
    }

    /* Attribute */
    code span.bn {
      color: #40a070;
    }

    /* BaseN */
    code span.bu {
      color: #008000;
    }

    /* BuiltIn */
    code span.cf {
      color: #007020;
      font-weight: bold;
    }

    /* ControlFlow */
    code span.ch {
      color: #4070a0;
    }

    /* Char */
    code span.cn {
      color: #880000;
    }

    /* Constant */
    code span.co {
      color: #60a0b0;
      font-style: italic;
    }

    /* Comment */
    code span.cv {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* CommentVar */
    code span.do {
      color: #ba2121;
      font-style: italic;
    }

    /* Documentation */
    code span.dt {
      color: #902000;
    }

    /* DataType */
    code span.dv {
      color: #40a070;
    }

    /* DecVal */
    code span.er {
      color: #ff0000;
      font-weight: bold;
    }

    /* Error */
    code span.ex {}

    /* Extension */
    code span.fl {
      color: #40a070;
    }

    /* Float */
    code span.fu {
      color: #06287e;
    }

    /* Function */
    code span.im {
      color: #008000;
      font-weight: bold;
    }

    /* Import */
    code span.in {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Information */
    code span.kw {
      color: #007020;
      font-weight: bold;
    }

    /* Keyword */
    code span.op {
      color: #666666;
    }

    /* Operator */
    code span.ot {
      color: #007020;
    }

    /* Other */
    code span.pp {
      color: #bc7a00;
    }

    /* Preprocessor */
    code span.sc {
      color: #4070a0;
    }

    /* SpecialChar */
    code span.ss {
      color: #bb6688;
    }

    /* SpecialString */
    code span.st {
      color: #4070a0;
    }

    /* String */
    code span.va {
      color: #19177c;
    }

    /* Variable */
    code span.vs {
      color: #4070a0;
    }

    /* VerbatimString */
    code span.wa {
      color: #60a0b0;
      font-weight: bold;
      font-style: italic;
    }

    /* Warning */
  </style>


  <script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../site_libs/clipboard/clipboard.min.js"></script>
  <script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../site_libs/quarto-search/quarto-search.js"></script>
  <meta name="quarto:offset" content="../../">
  <script src="../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet"
    id="quarto-text-highlighting-styles">
  <script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
  <script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"
    integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [], function () { return window.jQuery; })</script>
  <script type="text/javascript">
    window.PlotlyConfig = { MathJaxConfig: 'local' };
    if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) { window.MathJax.Hub.Config({ SVG: { font: "STIX-Web" } }); }
    if (typeof require !== 'undefined') {
      require.undef("plotly");
      requirejs.config({
        paths: {
          'plotly': ['https://cdn.plot.ly/plotly-2.16.1.min']
        }
      });
      require(['plotly'], function (Plotly) {
        window._Plotly = Plotly;
      });
    }
  </script>



  <link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

  <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
        <div class="navbar-brand-container">
          <a class="navbar-brand" href="../../index.html">
            <span class="navbar-title">Data and Decisions</span>
          </a>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
          onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="../../about.html">
                <span class="menu-text">About</span></a>
            </li>
            <li class="nav-item compact">
              <a class="nav-link" href="https://github.com/bertugmirasyedi"><i class="bi bi-github" role="img">
                </i>
                <span class="menu-text"></span></a>
            </li>
            <li class="nav-item compact">
              <a class="nav-link" href="https://twitter.com/bertugmirasyedi"><i class="bi bi-twitter" role="img">
                </i>
                <span class="menu-text"></span></a>
            </li>
          </ul>
          <div id="quarto-search" class="" title="Search"></div>
        </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  </header>
  <!-- content -->
  <header id="title-block-header" class="quarto-title-block default page-columns page-full">
    <div class="quarto-title-banner page-columns page-full">
      <div class="quarto-title column-body">
        <h1 class="title">Book Sales Forecasting: Comparison of Different Models Part 2</h1>
        <div>
          <div class="description">
            Deep Learning Models
          </div>
        </div>
        <div class="quarto-categories">
          <div class="quarto-category">python</div>
          <div class="quarto-category">time series forecasting</div>
          <div class="quarto-category">tensorflow</div>
          <div class="quarto-category">optuna</div>
          <div class="quarto-category">hyperparameter tuning</div>
        </div>
      </div>
    </div>


    <div class="quarto-title-meta">


      <div>
        <div class="quarto-title-meta-heading">Published</div>
        <div class="quarto-title-meta-contents">
          <p class="date">November 27, 2022</p>
        </div>
      </div>


    </div>


  </header>
  <div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
    <!-- sidebar -->
    <!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
      <nav id="TOC" role="doc-toc" class="toc-active">
        <h2 id="toc-title">On this page</h2>

        <ul>
          <li><a href="#introduction" id="toc-introduction" class="nav-link active"
              data-scroll-target="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
          <li><a href="#deep-learning" id="toc-deep-learning" class="nav-link" data-scroll-target="#deep-learning"><span
                class="toc-section-number">2</span> Deep Learning</a>
            <ul class="collapse">
              <li><a href="#lstm" id="toc-lstm" class="nav-link" data-scroll-target="#lstm"><span
                    class="toc-section-number">2.1</span> LSTM</a></li>
              <li><a href="#cnn" id="toc-cnn" class="nav-link" data-scroll-target="#cnn"><span
                    class="toc-section-number">2.2</span> CNN</a></li>
            </ul>
          </li>
          <li><a href="#rnn-model-tuning" id="toc-rnn-model-tuning" class="nav-link"
              data-scroll-target="#rnn-model-tuning"><span class="toc-section-number">3</span> RNN Model Tuning</a></li>
          <li><a href="#results-and-conclusion" id="toc-results-and-conclusion" class="nav-link"
              data-scroll-target="#results-and-conclusion"><span class="toc-section-number">4</span> Results and
              Conclusion</a></li>
        </ul>
      </nav>
    </div>
    <!-- main -->
    <main class="content quarto-banner-title-block" id="quarto-document-content">




      <section id="introduction" class="level1" data-number="1">
        <h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
        <p>This post is the continuation of the <a href="../../posts/book-forecasting/book_sales_forecasting.html">book
            sales forecasting case</a>. In this second part we will create deep learning models and hyperparameter
          tuning according to the assumed business case on Part 1.</p>
      </section>
      <section id="deep-learning" class="level1" data-number="2">
        <h1 data-number="2"><span class="header-section-number">2</span> Deep Learning</h1>
        <p>Now we will create the forecasts with deep learning methods - LSTM and CNN. For these models we have to
          change feature and target DataFrames to Numpy arrays, and reshape features to 3 dimensional shape of (samples,
          timesteps, features). After creating a base model for both of them and comparing visually by plotting test
          features with forecasts, we will create our custom function in the next section and do hyperparameter tuning.
        </p>
        <section id="lstm" class="level2" data-number="2.1">
          <h2 data-number="2.1" class="anchored" data-anchor-id="lstm"><span class="header-section-number">2.1</span>
            LSTM</h2>
          <p>Firstly, we will create a simple network.</p>
          <div class="cell" data-execution_count="2">
            <div class="sourceCode cell-code" id="cb1">
              <pre
                class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers, Sequential</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Disable logging</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.disable_interactive_logging()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>window_size <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train and test data for LSTM</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>lstm_train_features <span class="op">=</span> np.array(train_features)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>lstm_train_targets <span class="op">=</span> np.array(train_targets)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>lstm_test_features <span class="op">=</span> np.array(test_features)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>lstm_test_targets <span class="op">=</span> np.array(test_targets)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape train and test features suitable fo RNN</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>lstm_train_features <span class="op">=</span> lstm_train_features.reshape((lstm_train_features.shape[<span class="dv">0</span>], <span class="dv">1</span>, lstm_train_features.shape[<span class="dv">1</span>]))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>lstm_test_features <span class="op">=</span> lstm_test_features.reshape((lstm_test_features.shape[<span class="dv">0</span>], <span class="dv">1</span>, lstm_test_features.shape[<span class="dv">1</span>]))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement LSTM</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>lstm_model <span class="op">=</span> Sequential()</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>lstm_model.add(layers.LSTM(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>lstm_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>lstm_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mape"</span>, optimizer<span class="op">=</span><span class="st">"Adam"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and Forecast</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>lstm_model.fit(lstm_train_features, lstm_train_targets, <span class="dv">1</span>, <span class="dv">5</span>, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>lstm_forecast <span class="op">=</span> lstm_model.predict(lstm_test_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
          </div>
          <div class="cell" data-cache="true" data-execution_count="3">
            <div class="cell-output cell-output-stdout">
              <pre><code>Metal device set to: Apple M1
WARNING:tensorflow:Layer lstm will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
            </div>
            <div class="cell-output cell-output-display">

              <div>
                <div id="7c1f609e-92f4-406d-a6e8-26d2c45a980f" class="plotly-graph-div"
                  style="height:500px; width:700px;"></div>
                <script type="text/javascript">                require(["plotly"], function (Plotly) {
                    window.PLOTLYENV = window.PLOTLYENV || {}; if (document.getElementById("7c1f609e-92f4-406d-a6e8-26d2c45a980f")) {
                      Plotly.newPlot("7c1f609e-92f4-406d-a6e8-26d2c45a980f", [{ "hovertemplate": "=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Observed", "line": { "color": "#636efa", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Observed", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [142.0, 98.0, 109.0, 102.0, 116.0, 99.0, 83.0, 90.0, 84.0, 91.0, 93.0, 113.0, 78.0, 89.0, 87.0, 88.0, 89.0, 101.0, 101.0, 82.0, 92.0, 88.0, 91.0, 90.0, 102.0, 99.0, 89.0, 88.0, 90.0, 85.0, 89.0, 103.0, 104.0, 87.0, 84.0, 83.0, 86.0, 91.0, 102.0, 97.0, 91.0, 85.0, 87.0, 88.0, 85.0, 92.0, 91.0, 84.0, 83.0, 83.0, 81.0, 82.0, 89.0, 105.0, 83.0, 83.0, 81.0, 76.0, 80.0, 99.0, 86.0, 78.0, 77.0, 70.0, 72.0, 70.0, 86.0, 86.0, 67.0, 75.0, 73.0, 71.0, 73.0, 78.0, 93.0, 69.0, 67.0, 66.0, 74.0, 76.0, 80.0, 92.0, 72.0, 71.0, 69.0, 69.0, 66.0, 76.0, 73.0, 65.0, 72.0, 61.0, 55.0, 56.0, 60.0, 69.0, 55.0, 54.0, 59.0, 58.0, 60.0, 69.0, 71.0, 56.0, 64.0, 64.0, 59.0, 66.0, 74.0, 76.0, 52.0, 55.0, 48.0, 54.0, 55.0, 57.0, 66.0, 57.0, 55.0, 53.0, 55.0, 59.0, 69.0, 75.0, 65.0, 63.0, 67.0, 68.0, 63.0, 67.0, 69.0, 64.0, 56.0, 52.0, 56.0, 62.0, 69.0, 68.0, 57.0, 58.0, 60.0, 58.0, 61.0, 74.0, 75.0, 65.0, 63.0, 61.0, 62.0, 68.0, 65.0, 68.0, 65.0, 63.0, 60.0, 62.0, 70.0, 75.0, 79.0, 63.0, 63.0, 60.0, 69.0, 64.0, 70.0, 70.0, 61.0, 56.0, 60.0, 58.0, 62.0, 75.0, 74.0, 57.0, 65.0, 58.0, 59.0, 59.0, 73.0, 73.0, 60.0, 66.0, 68.0, 65.0, 65.0, 70.0, 77.0, 62.0, 66.0, 67.0, 70.0, 67.0, 69.0, 68.0, 64.0, 65.0, 61.0, 61.0, 68.0, 69.0, 76.0, 56.0, 63.0, 64.0, 59.0, 66.0, 75.0, 76.0, 61.0, 64.0, 65.0, 60.0, 69.0, 76.0, 79.0, 67.0, 66.0, 70.0, 64.0, 64.0, 81.0, 78.0, 70.0, 64.0, 69.0, 70.0, 61.0, 78.0, 78.0, 71.0, 67.0, 77.0, 72.0, 72.0, 71.0, 78.0, 69.0, 73.0, 69.0, 69.0, 67.0, 80.0, 86.0, 66.0, 70.0, 70.0, 72.0, 75.0, 86.0, 83.0, 71.0, 63.0, 72.0, 71.0, 67.0, 81.0, 82.0, 73.0, 65.0, 77.0, 61.0, 81.0, 89.0, 79.0, 69.0, 76.0, 68.0, 76.0, 77.0, 82.0, 91.0, 68.0, 71.0, 71.0, 82.0, 72.0, 90.0, 103.0, 77.0, 80.0, 86.0, 90.0, 86.0, 94.0, 98.0, 78.0, 77.0, 77.0, 84.0, 89.0, 95.0, 102.0, 80.0, 84.0, 84.0, 80.0, 71.0, 81.0, 99.0, 79.0, 76.0, 79.0, 81.0, 86.0, 100.0, 96.0, 76.0, 74.0, 86.0, 82.0, 76.0, 91.0, 100.0, 80.0, 87.0, 80.0, 81.0, 87.0, 97.0, 104.0, 79.0, 76.0, 87.0, 76.0, 86.0, 98.0, 95.0, 76.0, 88.0, 82.0, 83.0, 91.0, 87.0, 90.0, 84.0, 83.0, 83.0, 82.0, 87.0, 85.0, 107.0, 85.0, 80.0, 88.0, 78.0, 86.0, 99.0, 98.0, 86.0, 82.0, 84.0, 89.0, 85.0, 102.0, 90.0, 79.0, 83.0, 87.0, 84.0, 94.0, 122.0, 131.0, 126.0, 157.0, 169.0, 143.0], "yaxis": "y", "type": "scatter" }, { "hovertemplate": "=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Predicted", "line": { "color": "#EF553B", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Predicted", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [76.53011322021484, 64.69878387451172, 69.89448547363281, 76.9672622680664, 104.4306411743164, 80.34725189208984, 86.65019226074219, 86.68470001220703, 85.55055236816406, 89.24820709228516, 96.7008285522461, 101.89249420166016, 81.33949279785156, 83.18096160888672, 82.47649383544922, 84.62217712402344, 88.3222885131836, 97.88214874267578, 101.10958099365234, 79.6385269165039, 82.83023071289062, 84.88627624511719, 83.36681365966797, 88.6441650390625, 93.90929412841797, 102.16583251953125, 76.94718170166016, 83.61197662353516, 84.29663848876953, 84.60472106933594, 86.12213134765625, 94.49714660644531, 108.02436065673828, 86.28582000732422, 88.92435455322266, 88.57106018066406, 87.7213363647461, 91.90511322021484, 99.74779510498047, 103.8891830444336, 80.33744049072266, 83.93820190429688, 82.84654235839844, 85.54071807861328, 85.3316879272461, 92.63098907470703, 99.850830078125, 76.51722717285156, 82.448486328125, 79.54606628417969, 81.54061889648438, 82.69085693359375, 92.76460266113281, 96.57421875, 74.9648666381836, 76.74468231201172, 78.91522216796875, 77.64173889160156, 82.28933715820312, 91.19856262207031, 93.292724609375, 77.77574920654297, 83.98099517822266, 82.23839569091797, 81.96702575683594, 84.13919067382812, 93.39674377441406, 99.0561294555664, 74.03642272949219, 78.97850036621094, 78.04385375976562, 77.52775573730469, 83.32133483886719, 88.34918975830078, 93.55738830566406, 72.08097839355469, 77.19441223144531, 78.7361068725586, 76.39957427978516, 81.55226135253906, 87.96988677978516, 95.98228454589844, 71.34803009033203, 78.11628723144531, 75.54266357421875, 78.37760925292969, 80.31732940673828, 90.44602966308594, 97.24901580810547, 74.71928405761719, 77.93598937988281, 72.64949035644531, 80.84785461425781, 85.92057037353516, 92.56101989746094, 98.3900375366211, 75.11325073242188, 60.27556228637695, 60.39036560058594, 59.095542907714844, 83.59056854248047, 70.81201171875, 76.13624572753906, 76.42185974121094, 58.065399169921875, 57.58051300048828, 60.15224838256836, 84.54712677001953, 94.17997741699219, 97.74891662597656, 77.30854797363281, 80.30787658691406, 82.87792205810547, 81.9137954711914, 87.58782958984375, 92.9166030883789, 101.5572280883789, 77.8092041015625, 64.51776123046875, 65.59688568115234, 66.25788116455078, 75.19901275634766, 71.83426666259766, 79.295654296875, 54.50465393066406, 78.99349975585938, 78.49529266357422, 79.96041107177734, 83.2397689819336, 89.97714233398438, 95.9771499633789, 72.55192565917969, 76.02649688720703, 79.03782653808594, 76.09725952148438, 78.82547760009766, 88.92579650878906, 95.11486053466797, 53.0477409362793, 55.34215545654297, 57.222835540771484, 75.97479248046875, 61.32318115234375, 68.09194946289062, 75.825439453125, 69.79872131347656, 76.489501953125, 74.9844741821289, 77.0523681640625, 61.025020599365234, 69.43234252929688, 73.4178466796875, 62.11586380004883, 55.159751892089844, 56.109432220458984, 54.28770065307617, 77.79175567626953, 85.07795715332031, 91.82389068603516, 68.7254409790039, 71.47053527832031, 71.48187255859375, 70.62874603271484, 72.8317642211914, 83.48416900634766, 86.1128158569336, 62.45308303833008, 68.36385345458984, 68.67259979248047, 69.9842300415039, 70.41277313232422, 80.39649200439453, 84.4875259399414, 63.48440933227539, 66.06725311279297, 68.04255676269531, 65.32890319824219, 70.80130767822266, 77.3546142578125, 84.9298095703125, 62.69069290161133, 67.54129791259766, 60.18741226196289, 68.25041198730469, 73.06227111816406, 79.40393829345703, 85.1732406616211, 61.099281311035156, 67.02152252197266, 66.9945068359375, 65.7382583618164, 69.20238494873047, 76.45600128173828, 81.57400512695312, 61.128047943115234, 62.896820068359375, 62.37274169921875, 64.3491439819336, 68.21807098388672, 77.76995849609375, 81.1971664428711, 60.13428497314453, 63.418975830078125, 65.80358123779297, 64.52054595947266, 70.05841064453125, 75.65311431884766, 84.18301391601562, 59.70703887939453, 66.57347869873047, 67.7770767211914, 68.68366241455078, 70.65987396240234, 70.19085693359375, 84.42141723632812, 63.144107818603516, 66.50709533691406, 66.7274169921875, 66.52069854736328, 71.37982940673828, 79.88397979736328, 84.69495391845703, 61.91350555419922, 66.1922607421875, 65.75983428955078, 69.13025665283203, 69.72212982177734, 77.69459533691406, 85.63743591308594, 63.19538116455078, 69.63777923583984, 67.43464660644531, 70.10359191894531, 72.09598541259766, 82.8377456665039, 87.37371826171875, 66.60407257080078, 68.85466003417969, 71.60667419433594, 70.82189178466797, 76.24651336669922, 85.6947021484375, 92.27455139160156, 67.82782745361328, 65.52019500732422, 73.85134887695312, 75.99925994873047, 77.80303192138672, 86.17443084716797, 91.64268493652344, 69.89237213134766, 74.69538879394531, 73.44967651367188, 74.14212036132812, 76.6912612915039, 84.23739624023438, 93.11402130126953, 67.09131622314453, 71.2874755859375, 73.16542053222656, 73.99840545654297, 78.66858673095703, 84.40769958496094, 92.36576080322266, 67.74297332763672, 74.63050842285156, 73.17583465576172, 75.57289123535156, 75.9623794555664, 86.69021606445312, 91.24234771728516, 70.03742980957031, 75.58255767822266, 54.71681213378906, 54.76298141479492, 67.27558898925781, 97.9007339477539, 81.2615966796875, 56.57695388793945, 61.417850494384766, 83.558349609375, 83.66365814208984, 85.56917572021484, 93.90103149414062, 98.87057495117188, 75.05059814453125, 82.30836486816406, 79.3057632446289, 79.04979705810547, 84.00239562988281, 92.65599060058594, 99.79399871826172, 74.2346420288086, 80.84672546386719, 79.32283020019531, 81.81121063232422, 83.45549774169922, 93.83238220214844, 96.92842864990234, 76.45406341552734, 79.64134216308594, 81.63842010498047, 82.9450454711914, 86.73306274414062, 93.54080963134766, 91.0379867553711, 76.06201934814453, 82.44988250732422, 80.94511413574219, 81.35630798339844, 84.05125427246094, 93.72322082519531, 99.86878967285156, 75.56519317626953, 80.67900085449219, 80.09878540039062, 79.89006805419922, 86.22813415527344, 91.71659851074219, 97.48178100585938, 76.37301635742188, 81.83487701416016, 83.51044464111328, 81.60359954833984, 87.33299255371094, 94.35688781738281, 102.87330627441406, 78.64452362060547, 85.69766998291016, 83.3965835571289, 86.52983093261719, 88.87549591064453, 99.39961242675781, 106.7386474609375, 84.73846435546875, 77.87834167480469, 86.21508026123047, 88.75615692138672, 90.76439666748047, 99.40542602539062, 105.14591217041016, 83.99673461914062, 88.87800598144531, 88.03264617919922, 89.04481506347656, 91.91512298583984, 99.7825927734375, 108.93331909179688, 83.61720275878906, 87.98058319091797, 90.15215301513672, 91.4300537109375, 96.37671661376953, 102.46048736572266, 110.86412048339844, 86.93492126464844, 73.31758117675781, 72.28598022460938, 74.78209686279297, 96.6628646850586, 107.99716186523438, 92.1595687866211, 70.33860778808594, 77.04011535644531, 77.72333526611328, 76.37171173095703], "yaxis": "y", "type": "scatter" }], { "template": { "data": { "histogram2dcontour": [{ "type": "histogram2dcontour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "choropleth": [{ "type": "choropleth", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "histogram2d": [{ "type": "histogram2d", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmap": [{ "type": "heatmap", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmapgl": [{ "type": "heatmapgl", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "contourcarpet": [{ "type": "contourcarpet", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "contour": [{ "type": "contour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "surface": [{ "type": "surface", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "mesh3d": [{ "type": "mesh3d", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "scatter": [{ "fillpattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 }, "type": "scatter" }], "parcoords": [{ "type": "parcoords", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolargl": [{ "type": "scatterpolargl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "bar": [{ "error_x": { "color": "#2a3f5f" }, "error_y": { "color": "#2a3f5f" }, "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "bar" }], "scattergeo": [{ "type": "scattergeo", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolar": [{ "type": "scatterpolar", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "histogram": [{ "marker": { "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "histogram" }], "scattergl": [{ "type": "scattergl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatter3d": [{ "type": "scatter3d", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattermapbox": [{ "type": "scattermapbox", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterternary": [{ "type": "scatterternary", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattercarpet": [{ "type": "scattercarpet", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "carpet": [{ "aaxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "baxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "type": "carpet" }], "table": [{ "cells": { "fill": { "color": "#EBF0F8" }, "line": { "color": "white" } }, "header": { "fill": { "color": "#C8D4E3" }, "line": { "color": "white" } }, "type": "table" }], "barpolar": [{ "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "barpolar" }], "pie": [{ "automargin": true, "type": "pie" }] }, "layout": { "autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": { "color": "#2a3f5f" }, "hovermode": "closest", "hoverlabel": { "align": "left" }, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": { "bgcolor": "#E5ECF6", "angularaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "radialaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "ternary": { "bgcolor": "#E5ECF6", "aaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "baxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "caxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "coloraxis": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "colorscale": { "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]] }, "xaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "yaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "scene": { "xaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "yaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "zaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 } }, "shapedefaults": { "line": { "color": "#2a3f5f" } }, "annotationdefaults": { "arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1 }, "geo": { "bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white" }, "title": { "x": 0.05 }, "mapbox": { "style": "light" } } }, "xaxis": { "anchor": "y", "domain": [0.0, 1.0], "title": { "text": "index" } }, "yaxis": { "anchor": "x", "domain": [0.0, 1.0], "title": { "text": "Sales" } }, "legend": { "title": { "text": "" }, "tracegroupgap": 0 }, "title": { "text": "Simple LSTM Model Forecasts" }, "height": 500, "width": 700 }, { "responsive": true }).then(function () {

                        var gd = document.getElementById('7c1f609e-92f4-406d-a6e8-26d2c45a980f');
                        var x = new MutationObserver(function (mutations, observer) {
                          {
                            var display = window.getComputedStyle(gd).display;
                            if (!display || display === 'none') {
                              {
                                console.log([gd, 'removed!']);
                                Plotly.purge(gd);
                                observer.disconnect();
                              }
                            }
                          }
                        });

                        // Listen for the removal of the full notebook cells
                        var notebookContainer = gd.closest('#notebook-container');
                        if (notebookContainer) {
                          {
                            x.observe(notebookContainer, { childList: true });
                          }
                        }

                        // Listen for the clearing of the current output cell
                        var outputEl = gd.closest('.output');
                        if (outputEl) {
                          {
                            x.observe(outputEl, { childList: true });
                          }
                        }

                      })
                    };
                  });            </script>
              </div>
            </div>
          </div>
          <p>For easier comparison we will compute the previous benchmarks again.</p>
          <div class="cell" data-execution_count="5">
            <details>
              <summary>LSTM Benchmark Scores</summary>
              <div class="sourceCode cell-code" id="cb3">
                <pre
                  class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE for LSTM model is: </span><span class="sc">{</span>mean_absolute_percentage_error(lstm_test_targets, lstm_forecast)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R2 Score for LSTM model is: </span><span class="sc">{</span>r2_score(lstm_test_targets, lstm_forecast)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
            </details>
            <div class="cell-output cell-output-stdout">
              <pre><code>MAPE for LSTM model is: 0.11236970126628876
R2 Score for LSTM model is: 0.25165724866292205</code></pre>
            </div>
          </div>
          <p>Now let’s create a simple CNN network and plot its forecasts.</p>
        </section>
        <section id="cnn" class="level2" data-number="2.2">
          <h2 data-number="2.2" class="anchored" data-anchor-id="cnn"><span class="header-section-number">2.2</span> CNN
          </h2>
          <div class="cell" data-cache="true" data-execution_count="6">
            <details>
              <summary>Simple CNN Model</summary>
              <div class="sourceCode cell-code" id="cb5">
                <pre
                  class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disable logging</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.disable_interactive_logging()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train and test data for CNN</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>cnn_train_features <span class="op">=</span> np.array(train_features)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>cnn_train_targets <span class="op">=</span> np.array(train_targets)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>cnn_test_features <span class="op">=</span> np.array(test_features)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>cnn_test_targets <span class="op">=</span> np.array(test_targets)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape train and test features suitable fo RNN</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>cnn_train_features <span class="op">=</span> cnn_train_features.reshape((cnn_train_features.shape[<span class="dv">0</span>], <span class="dv">1</span>, cnn_train_features.shape[<span class="dv">1</span>]))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>cnn_test_features <span class="op">=</span> cnn_test_features.reshape((cnn_test_features.shape[<span class="dv">0</span>], <span class="dv">1</span>, cnn_test_features.shape[<span class="dv">1</span>]))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement CNN</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>cnn_model <span class="op">=</span> Sequential()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>cnn_model.add(layers.Conv1D(<span class="dv">50</span>, <span class="dv">1</span>, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>cnn_model.add(layers.Flatten())</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>cnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>cnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mape"</span>, optimizer<span class="op">=</span><span class="st">"Adam"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and Forecast</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>cnn_model.fit(cnn_train_features, cnn_train_targets, <span class="dv">1</span>, <span class="dv">5</span>, verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>cnn_forecast <span class="op">=</span> cnn_model.predict(cnn_test_features)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>plot_forecasts(cnn_test_targets, cnn_forecast, title<span class="op">=</span><span class="st">"Simple CNN Model Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
            </details>
            <div class="cell-output cell-output-display">

              <div>
                <div id="98a85118-cf38-4d93-bf74-97108b032184" class="plotly-graph-div"
                  style="height:500px; width:700px;"></div>
                <script type="text/javascript">                require(["plotly"], function (Plotly) {
                    window.PLOTLYENV = window.PLOTLYENV || {}; if (document.getElementById("98a85118-cf38-4d93-bf74-97108b032184")) {
                      Plotly.newPlot("98a85118-cf38-4d93-bf74-97108b032184", [{ "hovertemplate": "=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Observed", "line": { "color": "#636efa", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Observed", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [142.0, 98.0, 109.0, 102.0, 116.0, 99.0, 83.0, 90.0, 84.0, 91.0, 93.0, 113.0, 78.0, 89.0, 87.0, 88.0, 89.0, 101.0, 101.0, 82.0, 92.0, 88.0, 91.0, 90.0, 102.0, 99.0, 89.0, 88.0, 90.0, 85.0, 89.0, 103.0, 104.0, 87.0, 84.0, 83.0, 86.0, 91.0, 102.0, 97.0, 91.0, 85.0, 87.0, 88.0, 85.0, 92.0, 91.0, 84.0, 83.0, 83.0, 81.0, 82.0, 89.0, 105.0, 83.0, 83.0, 81.0, 76.0, 80.0, 99.0, 86.0, 78.0, 77.0, 70.0, 72.0, 70.0, 86.0, 86.0, 67.0, 75.0, 73.0, 71.0, 73.0, 78.0, 93.0, 69.0, 67.0, 66.0, 74.0, 76.0, 80.0, 92.0, 72.0, 71.0, 69.0, 69.0, 66.0, 76.0, 73.0, 65.0, 72.0, 61.0, 55.0, 56.0, 60.0, 69.0, 55.0, 54.0, 59.0, 58.0, 60.0, 69.0, 71.0, 56.0, 64.0, 64.0, 59.0, 66.0, 74.0, 76.0, 52.0, 55.0, 48.0, 54.0, 55.0, 57.0, 66.0, 57.0, 55.0, 53.0, 55.0, 59.0, 69.0, 75.0, 65.0, 63.0, 67.0, 68.0, 63.0, 67.0, 69.0, 64.0, 56.0, 52.0, 56.0, 62.0, 69.0, 68.0, 57.0, 58.0, 60.0, 58.0, 61.0, 74.0, 75.0, 65.0, 63.0, 61.0, 62.0, 68.0, 65.0, 68.0, 65.0, 63.0, 60.0, 62.0, 70.0, 75.0, 79.0, 63.0, 63.0, 60.0, 69.0, 64.0, 70.0, 70.0, 61.0, 56.0, 60.0, 58.0, 62.0, 75.0, 74.0, 57.0, 65.0, 58.0, 59.0, 59.0, 73.0, 73.0, 60.0, 66.0, 68.0, 65.0, 65.0, 70.0, 77.0, 62.0, 66.0, 67.0, 70.0, 67.0, 69.0, 68.0, 64.0, 65.0, 61.0, 61.0, 68.0, 69.0, 76.0, 56.0, 63.0, 64.0, 59.0, 66.0, 75.0, 76.0, 61.0, 64.0, 65.0, 60.0, 69.0, 76.0, 79.0, 67.0, 66.0, 70.0, 64.0, 64.0, 81.0, 78.0, 70.0, 64.0, 69.0, 70.0, 61.0, 78.0, 78.0, 71.0, 67.0, 77.0, 72.0, 72.0, 71.0, 78.0, 69.0, 73.0, 69.0, 69.0, 67.0, 80.0, 86.0, 66.0, 70.0, 70.0, 72.0, 75.0, 86.0, 83.0, 71.0, 63.0, 72.0, 71.0, 67.0, 81.0, 82.0, 73.0, 65.0, 77.0, 61.0, 81.0, 89.0, 79.0, 69.0, 76.0, 68.0, 76.0, 77.0, 82.0, 91.0, 68.0, 71.0, 71.0, 82.0, 72.0, 90.0, 103.0, 77.0, 80.0, 86.0, 90.0, 86.0, 94.0, 98.0, 78.0, 77.0, 77.0, 84.0, 89.0, 95.0, 102.0, 80.0, 84.0, 84.0, 80.0, 71.0, 81.0, 99.0, 79.0, 76.0, 79.0, 81.0, 86.0, 100.0, 96.0, 76.0, 74.0, 86.0, 82.0, 76.0, 91.0, 100.0, 80.0, 87.0, 80.0, 81.0, 87.0, 97.0, 104.0, 79.0, 76.0, 87.0, 76.0, 86.0, 98.0, 95.0, 76.0, 88.0, 82.0, 83.0, 91.0, 87.0, 90.0, 84.0, 83.0, 83.0, 82.0, 87.0, 85.0, 107.0, 85.0, 80.0, 88.0, 78.0, 86.0, 99.0, 98.0, 86.0, 82.0, 84.0, 89.0, 85.0, 102.0, 90.0, 79.0, 83.0, 87.0, 84.0, 94.0, 122.0, 131.0, 126.0, 157.0, 169.0, 143.0], "yaxis": "y", "type": "scatter" }, { "hovertemplate": "=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Predicted", "line": { "color": "#EF553B", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Predicted", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [79.90837860107422, 74.36846160888672, 78.41361236572266, 86.03778076171875, 104.85387420654297, 83.5852279663086, 87.44857025146484, 88.69799041748047, 87.04027557373047, 89.34648132324219, 98.42143249511719, 103.75325775146484, 83.50023651123047, 84.66834259033203, 82.80389404296875, 86.63855743408203, 88.73138427734375, 98.41935729980469, 101.83409881591797, 81.49162292480469, 84.13191986083984, 85.12667083740234, 83.71785736083984, 88.45548248291016, 93.54377746582031, 102.82752227783203, 79.59243774414062, 83.80502319335938, 83.5782241821289, 84.24220275878906, 85.7756118774414, 94.89185333251953, 109.21788787841797, 87.36131286621094, 89.15487670898438, 87.65328216552734, 88.65135955810547, 91.13511657714844, 100.64231872558594, 104.3593521118164, 81.01692962646484, 84.03031921386719, 84.06451416015625, 86.07637023925781, 85.83937072753906, 92.87266540527344, 100.91719055175781, 78.16227722167969, 82.18938446044922, 80.11768341064453, 82.04117584228516, 84.04081726074219, 93.05340576171875, 96.81322479248047, 76.36544799804688, 76.5328598022461, 80.24087524414062, 79.37316131591797, 82.57892608642578, 90.96380615234375, 94.82894134521484, 81.15473937988281, 85.35388946533203, 83.72123718261719, 82.83678436279297, 86.4184799194336, 94.2186279296875, 101.10005187988281, 77.60358428955078, 80.38652801513672, 80.33422088623047, 80.6220932006836, 85.39726257324219, 90.50540161132812, 94.92356872558594, 76.33948516845703, 79.53115844726562, 80.42514038085938, 78.75652313232422, 83.6511001586914, 90.7577896118164, 97.62840270996094, 74.05052185058594, 79.83173370361328, 76.95712280273438, 80.8558349609375, 83.22308349609375, 91.7433853149414, 97.99411010742188, 77.26616668701172, 79.2119140625, 72.28165435791016, 81.24602508544922, 85.45499420166016, 92.58525085449219, 96.96966552734375, 75.63227844238281, 65.38007354736328, 66.41141510009766, 64.78263092041016, 82.9148178100586, 76.7793197631836, 82.18726348876953, 77.08353424072266, 63.79835891723633, 61.810325622558594, 66.31585693359375, 83.180908203125, 92.8082046508789, 96.45814514160156, 76.39446258544922, 79.64132690429688, 80.7852554321289, 79.56098937988281, 85.2503890991211, 90.28720092773438, 99.5344467163086, 77.19200134277344, 67.39993286132812, 67.30499267578125, 68.77064514160156, 74.90007781982422, 77.3176040649414, 83.98490142822266, 60.32188034057617, 77.17305755615234, 77.25007629394531, 77.77326965332031, 82.4944076538086, 88.93598175048828, 93.92138671875, 71.75629425048828, 75.20440673828125, 76.64604949951172, 74.3677978515625, 75.92532348632812, 88.18202209472656, 92.76311492919922, 56.74654769897461, 58.51007843017578, 59.806312561035156, 74.47866821289062, 63.6356315612793, 70.54410552978516, 78.08511352539062, 66.1738052368164, 73.6682357788086, 72.44892883300781, 73.3579330444336, 62.0745964050293, 71.2778549194336, 75.35933685302734, 62.687957763671875, 60.302181243896484, 60.020172119140625, 58.829978942871094, 74.39520263671875, 83.86408996582031, 89.15314483642578, 68.01567840576172, 69.40878295898438, 68.35396575927734, 68.32034301757812, 71.25526428222656, 81.26463317871094, 83.90765380859375, 60.47772979736328, 67.18215942382812, 66.266357421875, 67.12145233154297, 67.98614501953125, 77.98057556152344, 82.36546325683594, 61.66007995605469, 63.41962814331055, 65.23619842529297, 62.07349395751953, 68.77494049072266, 76.15106964111328, 82.15924072265625, 60.38361358642578, 64.71495819091797, 58.660003662109375, 67.31655883789062, 71.16059112548828, 77.86673736572266, 82.0916519165039, 61.272216796875, 64.62390899658203, 66.17216491699219, 64.97798156738281, 67.03160095214844, 75.25553894042969, 80.96138763427734, 61.249515533447266, 61.92205810546875, 61.25156021118164, 64.44944763183594, 67.29105377197266, 76.5833511352539, 80.3055648803711, 60.56245803833008, 63.32204818725586, 65.01985931396484, 63.915828704833984, 68.89794158935547, 74.34090423583984, 84.08614349365234, 61.44100570678711, 65.65458679199219, 66.53951263427734, 67.89207458496094, 70.10189819335938, 70.77838897705078, 85.35018920898438, 64.57909393310547, 66.64424133300781, 66.17981719970703, 67.6286392211914, 70.97074127197266, 80.82223510742188, 85.61339569091797, 62.9797248840332, 66.6629867553711, 67.3483657836914, 69.97528076171875, 70.59037780761719, 78.09431457519531, 87.11493682861328, 65.22029876708984, 69.89665985107422, 68.30441284179688, 70.84710693359375, 73.54862976074219, 83.29894256591797, 87.7020263671875, 67.68148040771484, 68.54839324951172, 72.84246826171875, 72.50421142578125, 76.29877471923828, 85.31721496582031, 91.941162109375, 69.16310119628906, 67.01829528808594, 76.0143814086914, 77.36397552490234, 79.12471771240234, 86.46228790283203, 93.25531005859375, 71.3753890991211, 76.4241714477539, 75.43231964111328, 74.7457275390625, 77.89454650878906, 86.49864959716797, 94.23493194580078, 69.54647827148438, 72.09489440917969, 75.37126159667969, 75.18067169189453, 79.21894836425781, 85.71565246582031, 93.22745513916016, 70.52269744873047, 75.38057708740234, 74.05883026123047, 75.92645263671875, 75.90287780761719, 88.2113037109375, 92.69335174560547, 71.38076782226562, 75.16526794433594, 59.87599182128906, 60.63645553588867, 72.61359405517578, 97.66358947753906, 86.65254974365234, 62.40449142456055, 67.260009765625, 82.84247589111328, 84.45462036132812, 85.98542022705078, 93.282470703125, 98.65914916992188, 76.8211669921875, 82.32367706298828, 79.6579818725586, 78.89899444580078, 84.7301254272461, 92.66690826416016, 99.03668212890625, 75.1278076171875, 80.64075469970703, 79.9924545288086, 81.54881286621094, 82.9216537475586, 93.01997375488281, 95.60599517822266, 77.60301208496094, 80.20661163330078, 80.99198913574219, 81.73026275634766, 85.6297836303711, 92.918701171875, 91.106201171875, 77.78013610839844, 82.28897857666016, 81.12779235839844, 80.4160385131836, 84.59071350097656, 92.95747375488281, 100.2553939819336, 77.07523345947266, 79.80517578125, 80.1458511352539, 80.83663940429688, 86.16722106933594, 92.02307891845703, 96.87987518310547, 78.11644744873047, 81.53782653808594, 82.96318054199219, 81.61748504638672, 87.04895782470703, 94.84867095947266, 102.61125183105469, 78.98311614990234, 84.99186706542969, 82.18376922607422, 86.76051330566406, 89.48114776611328, 99.1003646850586, 105.86642456054688, 84.6015853881836, 77.18547058105469, 86.15007019042969, 88.08566284179688, 90.13359832763672, 97.98810577392578, 105.4246826171875, 83.18267059326172, 89.33885955810547, 87.23989868164062, 87.3905258178711, 90.97476959228516, 100.01587677001953, 108.59786224365234, 83.84049224853516, 86.88326263427734, 90.24285888671875, 90.2745361328125, 94.80187225341797, 101.91667175292969, 110.44451141357422, 87.33109283447266, 78.76617431640625, 76.77175903320312, 79.74146270751953, 94.86475372314453, 107.86621856689453, 98.35928344726562, 76.56954193115234, 81.14266967773438, 81.48512268066406, 81.02072143554688], "yaxis": "y", "type": "scatter" }], { "template": { "data": { "histogram2dcontour": [{ "type": "histogram2dcontour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "choropleth": [{ "type": "choropleth", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "histogram2d": [{ "type": "histogram2d", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmap": [{ "type": "heatmap", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmapgl": [{ "type": "heatmapgl", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "contourcarpet": [{ "type": "contourcarpet", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "contour": [{ "type": "contour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "surface": [{ "type": "surface", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "mesh3d": [{ "type": "mesh3d", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "scatter": [{ "fillpattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 }, "type": "scatter" }], "parcoords": [{ "type": "parcoords", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolargl": [{ "type": "scatterpolargl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "bar": [{ "error_x": { "color": "#2a3f5f" }, "error_y": { "color": "#2a3f5f" }, "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "bar" }], "scattergeo": [{ "type": "scattergeo", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolar": [{ "type": "scatterpolar", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "histogram": [{ "marker": { "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "histogram" }], "scattergl": [{ "type": "scattergl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatter3d": [{ "type": "scatter3d", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattermapbox": [{ "type": "scattermapbox", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterternary": [{ "type": "scatterternary", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattercarpet": [{ "type": "scattercarpet", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "carpet": [{ "aaxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "baxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "type": "carpet" }], "table": [{ "cells": { "fill": { "color": "#EBF0F8" }, "line": { "color": "white" } }, "header": { "fill": { "color": "#C8D4E3" }, "line": { "color": "white" } }, "type": "table" }], "barpolar": [{ "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "barpolar" }], "pie": [{ "automargin": true, "type": "pie" }] }, "layout": { "autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": { "color": "#2a3f5f" }, "hovermode": "closest", "hoverlabel": { "align": "left" }, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": { "bgcolor": "#E5ECF6", "angularaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "radialaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "ternary": { "bgcolor": "#E5ECF6", "aaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "baxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "caxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "coloraxis": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "colorscale": { "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]] }, "xaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "yaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "scene": { "xaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "yaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "zaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 } }, "shapedefaults": { "line": { "color": "#2a3f5f" } }, "annotationdefaults": { "arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1 }, "geo": { "bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white" }, "title": { "x": 0.05 }, "mapbox": { "style": "light" } } }, "xaxis": { "anchor": "y", "domain": [0.0, 1.0], "title": { "text": "index" } }, "yaxis": { "anchor": "x", "domain": [0.0, 1.0], "title": { "text": "Sales" } }, "legend": { "title": { "text": "" }, "tracegroupgap": 0 }, "title": { "text": "Simple CNN Model Forecasts" }, "height": 500, "width": 700 }, { "responsive": true }).then(function () {

                        var gd = document.getElementById('98a85118-cf38-4d93-bf74-97108b032184');
                        var x = new MutationObserver(function (mutations, observer) {
                          {
                            var display = window.getComputedStyle(gd).display;
                            if (!display || display === 'none') {
                              {
                                console.log([gd, 'removed!']);
                                Plotly.purge(gd);
                                observer.disconnect();
                              }
                            }
                          }
                        });

                        // Listen for the removal of the full notebook cells
                        var notebookContainer = gd.closest('#notebook-container');
                        if (notebookContainer) {
                          {
                            x.observe(notebookContainer, { childList: true });
                          }
                        }

                        // Listen for the clearing of the current output cell
                        var outputEl = gd.closest('.output');
                        if (outputEl) {
                          {
                            x.observe(outputEl, { childList: true });
                          }
                        }

                      })
                    };
                  });            </script>
              </div>
            </div>
          </div>
          <p>Plots show comparable performances for simple LSTM and CNN models. Let’s quantify the comparison.</p>
          <div class="cell" data-execution_count="7">
            <div class="cell-output cell-output-stdout">
              <pre><code>MAPE for CNN model is: 0.10711897164583206
R2 Score for CNN model is: 0.34101557513257685</code></pre>
            </div>
          </div>
        </section>
      </section>
      <section id="rnn-model-tuning" class="level1" data-number="3">
        <h1 data-number="3"><span class="header-section-number">3</span> RNN Model Tuning</h1>
        <p>In this deep learning tuning part, we will combine tuning of LSTM and CNN models and also several other
          network types under one category of <strong>RNN Model</strong>. The code will compare pure LSTM, pure CNN,
          Stacked LSTM, Bidirectional LSTM and CNN-LSTM Models together and select the best performing one.</p>
        <div class="cell" data-cache="true" data-execution_count="9">
          <details>
            <summary>RNN Model Tuning Code</summary>
            <div class="sourceCode cell-code" id="cb7">
              <pre
                class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Bidirectional</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Disable logging</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.disable_interactive_logging()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model creation function</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_rnn_model(trial):</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define trial variables</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  model_type <span class="op">=</span> trial.suggest_categorical(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"model_type"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      [<span class="st">"vanilla_lstm"</span>, <span class="st">"stacked_lstm"</span>, <span class="st">"bidirectional_lstm"</span>, <span class="st">"cnn"</span>, <span class="st">"cnn_lstm"</span>],</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  dropout <span class="op">=</span> trial.suggest_categorical(<span class="st">"dropout"</span>, [<span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">"vanilla_lstm"</span>:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trial variables</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> trial.suggest_int(<span class="st">"units"</span>, <span class="dv">50</span>, <span class="dv">200</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    dense_layers <span class="op">=</span> trial.suggest_int(<span class="st">"dense_layers"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    activation <span class="op">=</span> trial.suggest_categorical(<span class="st">"activation"</span>, [<span class="st">"relu"</span>, <span class="st">"tanh"</span>])</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> trial.suggest_categorical(<span class="st">"optimizer"</span>, [<span class="st">"Adam"</span>, <span class="st">"RMSprop"</span>])</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"stacked_lstm"</span>:</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trial variables</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> trial.suggest_int(<span class="st">"units"</span>, <span class="dv">50</span>, <span class="dv">200</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    dense_layers <span class="op">=</span> trial.suggest_int(<span class="st">"dense_layers"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    lstm_layers <span class="op">=</span> trial.suggest_int(<span class="st">"lstm_layers"</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    activation <span class="op">=</span> trial.suggest_categorical(<span class="st">"activation"</span>, [<span class="st">"relu"</span>, <span class="st">"tanh"</span>])</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> trial.suggest_categorical(<span class="st">"optimizer"</span>, [<span class="st">"Adam"</span>, <span class="st">"RMSprop"</span>])</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(lstm_layers):</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> layer <span class="op">==</span> lstm_layers <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"bidirectional_lstm"</span>:</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trial variables</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> trial.suggest_int(<span class="st">"units"</span>, <span class="dv">50</span>, <span class="dv">200</span>)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    dense_layers <span class="op">=</span> trial.suggest_int(<span class="st">"dense_layers"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    activation <span class="op">=</span> trial.suggest_categorical(<span class="st">"activation"</span>, [<span class="st">"relu"</span>, <span class="st">"tanh"</span>])</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> trial.suggest_categorical(<span class="st">"optimizer"</span>, [<span class="st">"Adam"</span>, <span class="st">"RMSprop"</span>])</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(Bidirectional(layers.LSTM(units, activation<span class="op">=</span>activation)))</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"cnn"</span>:</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trial variables</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> trial.suggest_int(<span class="st">"units"</span>, <span class="dv">50</span>, <span class="dv">200</span>)</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>    dense_layers <span class="op">=</span> trial.suggest_int(<span class="st">"dense_layers"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    activation <span class="op">=</span> trial.suggest_categorical(<span class="st">"activation"</span>, [<span class="st">"relu"</span>, <span class="st">"tanh"</span>])</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> trial.suggest_categorical(<span class="st">"optimizer"</span>, [<span class="st">"Adam"</span>, <span class="st">"RMSprop"</span>])</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Conv1D(units, <span class="dv">1</span>, activation<span class="op">=</span>activation))</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Flatten())</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"cnn_lstm"</span>:</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trial variables</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    units <span class="op">=</span> trial.suggest_int(<span class="st">"units"</span>, <span class="dv">50</span>, <span class="dv">200</span>)</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    dense_layers <span class="op">=</span> trial.suggest_int(<span class="st">"dense_layers"</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>    activation <span class="op">=</span> trial.suggest_categorical(<span class="st">"activation"</span>, [<span class="st">"relu"</span>, <span class="st">"tanh"</span>])</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> trial.suggest_categorical(<span class="st">"optimizer"</span>, [<span class="st">"Adam"</span>, <span class="st">"RMSprop"</span>])</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Conv1D(units, <span class="dv">1</span>, activation<span class="op">=</span>activation))</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rnn_model</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Optuna Objective</span></span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rnn_objective(trial):</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define training variables</span></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>  batch_size <span class="op">=</span> trial.suggest_int(<span class="st">"batch_size"</span>, <span class="dv">1</span>, <span class="dv">100</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>  epochs <span class="op">=</span> trial.suggest_int(<span class="st">"epochs"</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Call model</span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>  rnn_model <span class="op">=</span> create_rnn_model(trial)</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>  rnn_model.fit(lstm_train_features, lstm_train_targets, batch_size, epochs, verbose<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forecast for the test data</span></span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>  rnn_forecast <span class="op">=</span> rnn_model.predict(lstm_test_features)</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a loop to calculate cumulative cost of the forecast</span></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>  storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>  cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>  book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>  monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(lstm_test_targets)):</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>      storage, </span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>      lstm_test_targets[step], </span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>      rnn_forecast[step][<span class="dv">0</span>], </span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>      book_price, </span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>      monthly_storage_cost)</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>  total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage<span class="op">*</span>book_price</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> total_cost</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Optuna Study and Minimize total_cost</span></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>rnn_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, sampler<span class="op">=</span>optuna.samplers.QMCSampler())</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>rnn_study.optimize(rnn_objective, n_trials<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
          </details>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_2 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_2 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_2 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_3 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_4 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_5 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_6 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_7 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_7 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_7 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_11 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_12 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_14 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_15 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_16 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_17 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_18 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_19 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
        </div>
        <div class="cell" data-cache="true" data-execution_count="10">
          <details>
            <summary>RNN Model with Best Parameters</summary>
            <div class="sourceCode cell-code" id="cb26">
              <pre
                class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disable logging</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.disable_interactive_logging()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define best model parameters</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>best_rnn_model_parameters <span class="op">=</span> rnn_study.best_params</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>model_type <span class="op">=</span> best_rnn_model_parameters[<span class="st">"model_type"</span>]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>units <span class="op">=</span> best_rnn_model_parameters[<span class="st">"units"</span>]</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>activation <span class="op">=</span> best_rnn_model_parameters[<span class="st">"activation"</span>]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>dense_layers <span class="op">=</span> best_rnn_model_parameters[<span class="st">"dense_layers"</span>]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>lstm_layers <span class="op">=</span> best_rnn_model_parameters[<span class="st">"lstm_layers"</span>] <span class="cf">if</span> <span class="st">"lstm_layers"</span> <span class="kw">in</span> best_rnn_model_parameters.keys() <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> best_rnn_model_parameters[<span class="st">"optimizer"</span>]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> best_rnn_model_parameters[<span class="st">"batch_size"</span>]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> best_rnn_model_parameters[<span class="st">"epochs"</span>]</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>dropout <span class="op">=</span> best_rnn_model_parameters[<span class="st">"dropout"</span>]</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>test_subset <span class="op">=</span> subset[<span class="dv">730</span>:<span class="dv">1095</span>]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>val_subset <span class="op">=</span> subset[<span class="dv">1095</span>:<span class="dv">1461</span>]</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>test_targets <span class="op">=</span> np.array(test_subset[<span class="st">"num_sold"</span>])</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>test_features <span class="op">=</span> np.array(test_subset.drop(columns<span class="op">=</span>[<span class="st">"num_sold"</span>])).reshape((test_subset.shape[<span class="dv">0</span>], <span class="dv">1</span>, test_subset.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>val_targets <span class="op">=</span> np.array(val_subset[<span class="st">"num_sold"</span>])</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>val_features <span class="op">=</span> np.array(val_subset.drop(columns<span class="op">=</span>[<span class="st">"num_sold"</span>])).reshape((val_subset.shape[<span class="dv">0</span>], <span class="dv">1</span>, val_subset.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> model_type <span class="op">==</span> <span class="st">"vanilla_lstm"</span>:</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"stacked_lstm"</span>:</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(lstm_layers):</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> layer <span class="op">==</span> lstm_layers <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>            rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>            rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation, return_sequences<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"bidirectional_lstm"</span>:</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(Bidirectional(layers.LSTM(units, activation<span class="op">=</span>activation)))</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"cnn"</span>:</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Conv1D(units, <span class="dv">1</span>, activation<span class="op">=</span>activation))</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Flatten())</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> model_type <span class="op">==</span> <span class="st">"cnn_lstm"</span>:</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define model with trial variables</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>    rnn_model <span class="op">=</span> Sequential()</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Conv1D(units, <span class="dv">1</span>, activation<span class="op">=</span>activation))</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.LSTM(units, activation<span class="op">=</span>activation))</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> <span class="bu">range</span>(dense_layers):</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>        rnn_model.add(layers.Dense(units, activation<span class="op">=</span><span class="st">"relu"</span>))</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropout:</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>      rnn_model.add(layers.Dropout(rate<span class="op">=</span><span class="fl">0.25</span>))</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>    rnn_model.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>    rnn_model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">"mae"</span>, optimizer<span class="op">=</span>optimizer)</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>rnn_model.fit(test_features,</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>              test_targets,</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>              batch_size,</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>              epochs,</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>              verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>              validation_data<span class="op">=</span>(val_features, val_targets),</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>              callbacks<span class="op">=</span>tf.keras.callbacks.EarlyStopping(patience<span class="op">=</span><span class="dv">7</span>, min_delta<span class="op">=</span><span class="fl">0.1</span>))<span class="op">;</span></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast for the test data</span></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>rnn_forecast <span class="op">=</span> rnn_model.predict(val_features)</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total cost</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>storage <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>cumulative_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>book_price <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a>monthly_storage_cost <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(val_targets)):</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cost and difference for storage for the current step</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>    cost, to_storage <span class="op">=</span> cost_function(</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>      storage, </span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>      val_targets[step], </span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>      rnn_forecast[step][<span class="dv">0</span>], </span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>      book_price, </span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>      monthly_storage_cost)</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add cost to cumulative cost and storage difference to storage</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a>    cumulative_cost <span class="op">+=</span> <span class="bu">int</span>(cost)</span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>    storage <span class="op">+=</span> <span class="bu">int</span>(to_storage)</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>rnn_model_total_cost <span class="op">=</span> cumulative_cost <span class="op">+</span> storage<span class="op">*</span>book_price</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both test data and forecast from the model to compare them visually.</span></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>plot_forecasts(val_targets, rnn_forecast, title<span class="op">=</span><span class="st">"Simple LSTM Model Forecasts"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
          </details>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_20 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_21 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-stdout">
            <pre><code>WARNING:tensorflow:Layer lstm_22 will not use cuDNN kernels since it doesn't meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.</code></pre>
          </div>
          <div class="cell-output cell-output-display">

            <div>
              <div id="a133a400-4c2b-4227-ba3b-06bf07c108a9" class="plotly-graph-div"
                style="height:500px; width:700px;"></div>
              <script type="text/javascript">                require(["plotly"], function (Plotly) {
                  window.PLOTLYENV = window.PLOTLYENV || {}; if (document.getElementById("a133a400-4c2b-4227-ba3b-06bf07c108a9")) {
                    Plotly.newPlot("a133a400-4c2b-4227-ba3b-06bf07c108a9", [{ "hovertemplate": "=Observed<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Observed", "line": { "color": "#636efa", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Observed", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [142.0, 98.0, 109.0, 102.0, 116.0, 99.0, 83.0, 90.0, 84.0, 91.0, 93.0, 113.0, 78.0, 89.0, 87.0, 88.0, 89.0, 101.0, 101.0, 82.0, 92.0, 88.0, 91.0, 90.0, 102.0, 99.0, 89.0, 88.0, 90.0, 85.0, 89.0, 103.0, 104.0, 87.0, 84.0, 83.0, 86.0, 91.0, 102.0, 97.0, 91.0, 85.0, 87.0, 88.0, 85.0, 92.0, 91.0, 84.0, 83.0, 83.0, 81.0, 82.0, 89.0, 105.0, 83.0, 83.0, 81.0, 76.0, 80.0, 99.0, 86.0, 78.0, 77.0, 70.0, 72.0, 70.0, 86.0, 86.0, 67.0, 75.0, 73.0, 71.0, 73.0, 78.0, 93.0, 69.0, 67.0, 66.0, 74.0, 76.0, 80.0, 92.0, 72.0, 71.0, 69.0, 69.0, 66.0, 76.0, 73.0, 65.0, 72.0, 61.0, 55.0, 56.0, 60.0, 69.0, 55.0, 54.0, 59.0, 58.0, 60.0, 69.0, 71.0, 56.0, 64.0, 64.0, 59.0, 66.0, 74.0, 76.0, 52.0, 55.0, 48.0, 54.0, 55.0, 57.0, 66.0, 57.0, 55.0, 53.0, 55.0, 59.0, 69.0, 75.0, 65.0, 63.0, 67.0, 68.0, 63.0, 67.0, 69.0, 64.0, 56.0, 52.0, 56.0, 62.0, 69.0, 68.0, 57.0, 58.0, 60.0, 58.0, 61.0, 74.0, 75.0, 65.0, 63.0, 61.0, 62.0, 68.0, 65.0, 68.0, 65.0, 63.0, 60.0, 62.0, 70.0, 75.0, 79.0, 63.0, 63.0, 60.0, 69.0, 64.0, 70.0, 70.0, 61.0, 56.0, 60.0, 58.0, 62.0, 75.0, 74.0, 57.0, 65.0, 58.0, 59.0, 59.0, 73.0, 73.0, 60.0, 66.0, 68.0, 65.0, 65.0, 70.0, 77.0, 62.0, 66.0, 67.0, 70.0, 67.0, 69.0, 68.0, 64.0, 65.0, 61.0, 61.0, 68.0, 69.0, 76.0, 56.0, 63.0, 64.0, 59.0, 66.0, 75.0, 76.0, 61.0, 64.0, 65.0, 60.0, 69.0, 76.0, 79.0, 67.0, 66.0, 70.0, 64.0, 64.0, 81.0, 78.0, 70.0, 64.0, 69.0, 70.0, 61.0, 78.0, 78.0, 71.0, 67.0, 77.0, 72.0, 72.0, 71.0, 78.0, 69.0, 73.0, 69.0, 69.0, 67.0, 80.0, 86.0, 66.0, 70.0, 70.0, 72.0, 75.0, 86.0, 83.0, 71.0, 63.0, 72.0, 71.0, 67.0, 81.0, 82.0, 73.0, 65.0, 77.0, 61.0, 81.0, 89.0, 79.0, 69.0, 76.0, 68.0, 76.0, 77.0, 82.0, 91.0, 68.0, 71.0, 71.0, 82.0, 72.0, 90.0, 103.0, 77.0, 80.0, 86.0, 90.0, 86.0, 94.0, 98.0, 78.0, 77.0, 77.0, 84.0, 89.0, 95.0, 102.0, 80.0, 84.0, 84.0, 80.0, 71.0, 81.0, 99.0, 79.0, 76.0, 79.0, 81.0, 86.0, 100.0, 96.0, 76.0, 74.0, 86.0, 82.0, 76.0, 91.0, 100.0, 80.0, 87.0, 80.0, 81.0, 87.0, 97.0, 104.0, 79.0, 76.0, 87.0, 76.0, 86.0, 98.0, 95.0, 76.0, 88.0, 82.0, 83.0, 91.0, 87.0, 90.0, 84.0, 83.0, 83.0, 82.0, 87.0, 85.0, 107.0, 85.0, 80.0, 88.0, 78.0, 86.0, 99.0, 98.0, 86.0, 82.0, 84.0, 89.0, 85.0, 102.0, 90.0, 79.0, 83.0, 87.0, 84.0, 94.0, 122.0, 131.0, 126.0, 157.0, 169.0, 143.0], "yaxis": "y", "type": "scatter" }, { "hovertemplate": "=Predicted<br>index=%{x}<br>Sales=%{y}<extra></extra>", "legendgroup": "Predicted", "line": { "color": "#EF553B", "dash": "solid" }, "marker": { "symbol": "circle" }, "mode": "lines", "name": "Predicted", "orientation": "v", "showlegend": true, "x": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365], "xaxis": "x", "y": [106.30654907226562, 116.40312194824219, 121.01404571533203, 132.76678466796875, 135.301513671875, 101.06381225585938, 107.67555236816406, 92.2025146484375, 87.26155853271484, 95.86298370361328, 112.8382568359375, 117.9668197631836, 102.22937774658203, 96.13428497314453, 86.7293930053711, 86.8812484741211, 96.2574691772461, 105.02098083496094, 119.84657287597656, 89.79032135009766, 94.4855728149414, 85.50499725341797, 80.66785430908203, 94.3231201171875, 95.0383071899414, 107.19462585449219, 92.92906951904297, 95.65288543701172, 91.62920379638672, 87.78661346435547, 91.32320404052734, 97.78728485107422, 111.24108123779297, 95.99433135986328, 88.44368743896484, 85.18488311767578, 89.91213989257812, 95.42192840576172, 100.1011962890625, 103.59368896484375, 87.23104858398438, 93.06562805175781, 90.35736846923828, 95.07976531982422, 91.181884765625, 100.9552993774414, 105.60091400146484, 94.9591293334961, 90.2622299194336, 90.41728210449219, 86.80799102783203, 91.89875030517578, 93.78534698486328, 96.02440643310547, 91.55933380126953, 83.43917083740234, 86.36602020263672, 85.68228149414062, 86.6093978881836, 93.41603088378906, 96.80899810791016, 86.76654815673828, 89.37479400634766, 86.3944320678711, 76.90350341796875, 88.12117767333984, 99.19104766845703, 95.20643615722656, 86.50753021240234, 83.3050765991211, 85.90314483642578, 82.14289093017578, 92.87664794921875, 92.50928497314453, 99.02368927001953, 84.24266815185547, 82.9498291015625, 80.2609634399414, 79.59292602539062, 83.66732025146484, 90.95189666748047, 89.87134552001953, 77.3848648071289, 78.55155944824219, 80.06539154052734, 74.59978485107422, 82.84732055664062, 90.33832550048828, 89.86617279052734, 74.48087310791016, 82.0179443359375, 74.56986236572266, 74.92140197753906, 85.73200988769531, 89.43486785888672, 90.13495635986328, 76.171875, 82.85248565673828, 78.45197296142578, 77.0243911743164, 77.15190887451172, 94.05493927001953, 91.09040069580078, 78.46793365478516, 79.13257598876953, 74.11128997802734, 72.24312591552734, 79.70514678955078, 87.20745849609375, 90.49724578857422, 76.46405029296875, 78.22968292236328, 77.62682342529297, 74.8830795288086, 80.15772247314453, 94.37470245361328, 96.77613067626953, 78.94955444335938, 87.06366729736328, 83.34552764892578, 73.47850799560547, 74.36158752441406, 96.37316131591797, 109.59891510009766, 79.7925033569336, 80.26543426513672, 73.27085876464844, 72.68900299072266, 74.42826080322266, 86.89713287353516, 91.12391662597656, 76.00615692138672, 67.29242706298828, 73.07704162597656, 68.98131561279297, 72.20922088623047, 81.26129913330078, 88.84225463867188, 71.17279815673828, 75.6980972290039, 68.13997650146484, 69.89165496826172, 70.37590026855469, 79.88116455078125, 86.31269836425781, 69.74491119384766, 71.59754943847656, 70.51898193359375, 65.61316680908203, 73.56160736083984, 77.43946075439453, 91.91033935546875, 65.41165161132812, 70.96306610107422, 75.5772705078125, 68.84142303466797, 77.32147216796875, 89.36193084716797, 88.9459457397461, 68.46932983398438, 68.94181060791016, 73.42626953125, 72.0827407836914, 77.76433563232422, 91.96126556396484, 86.69305419921875, 78.31826782226562, 74.01153564453125, 77.36617279052734, 72.4217300415039, 73.07294464111328, 84.71866607666016, 81.90904998779297, 71.70230102539062, 63.9163932800293, 75.09522247314453, 66.21263885498047, 78.43749237060547, 86.5870132446289, 77.57811737060547, 69.04865264892578, 65.84664916992188, 65.97663879394531, 66.6534194946289, 73.81937408447266, 76.83702850341797, 86.40830993652344, 70.15897369384766, 74.09644317626953, 66.0300064086914, 69.29644775390625, 72.82530975341797, 77.92719268798828, 91.93192291259766, 74.3191146850586, 69.34333801269531, 70.92325592041016, 66.25012969970703, 73.9000473022461, 81.5040283203125, 82.32868194580078, 72.46408081054688, 69.16728973388672, 64.38804626464844, 65.8390121459961, 73.30480194091797, 74.90122985839844, 80.1425552368164, 66.98301696777344, 72.94048309326172, 67.59101104736328, 70.15446472167969, 73.51730346679688, 73.22685241699219, 88.2125015258789, 69.97936248779297, 66.81057739257812, 70.08824157714844, 68.70498657226562, 75.8780746459961, 76.14464569091797, 85.9815444946289, 68.72435760498047, 68.4358901977539, 74.06246185302734, 73.21133422851562, 69.12879180908203, 75.59014129638672, 81.45272064208984, 70.84680938720703, 72.51499938964844, 70.17308807373047, 67.96459197998047, 69.13298034667969, 78.78114318847656, 81.3717269897461, 73.21109771728516, 69.47724151611328, 69.41645050048828, 68.63925170898438, 74.2264633178711, 80.96729278564453, 90.51506805419922, 75.1110610961914, 68.80333709716797, 72.65538024902344, 72.19795227050781, 76.05762481689453, 82.69318389892578, 92.25542449951172, 80.03878021240234, 75.31421661376953, 74.2348861694336, 74.66000366210938, 80.73683166503906, 78.9606704711914, 96.75350952148438, 72.2101058959961, 72.38780975341797, 72.18535614013672, 74.9764175415039, 78.9476089477539, 83.66490936279297, 88.41448211669922, 75.80046844482422, 75.10643768310547, 72.96570587158203, 80.4980697631836, 81.63935852050781, 86.21504211425781, 94.32010650634766, 78.83476257324219, 74.52169036865234, 78.85633087158203, 76.29353332519531, 82.75257110595703, 89.0263442993164, 94.63343048095703, 80.44280242919922, 81.3594741821289, 87.1480484008789, 81.3579330444336, 88.0199203491211, 94.06145477294922, 96.19066619873047, 77.84627532958984, 82.86711883544922, 76.6471176147461, 81.51827239990234, 83.7987289428711, 91.19342041015625, 91.83934020996094, 76.38921356201172, 76.05316925048828, 79.15802001953125, 77.70925903320312, 78.14421844482422, 96.07865142822266, 91.29059600830078, 80.83484649658203, 84.7567367553711, 83.80841064453125, 77.69625854492188, 80.9889144897461, 95.00601959228516, 99.7751693725586, 83.2798080444336, 86.1593246459961, 83.72367095947266, 80.26795196533203, 89.71785736083984, 98.88233184814453, 100.3631591796875, 85.00149536132812, 87.2121810913086, 88.60797882080078, 80.7668685913086, 93.42806243896484, 93.8257064819336, 105.75308990478516, 86.77344512939453, 84.34037017822266, 79.95215606689453, 77.35713958740234, 86.70773315429688, 95.45021057128906, 101.27742767333984, 78.86933135986328, 81.59136199951172, 82.57198333740234, 78.66854095458984, 92.54850006103516, 97.8001480102539, 104.56800079345703, 83.4126205444336, 78.41414642333984, 82.90023040771484, 82.3970947265625, 84.75138092041016, 96.52124786376953, 108.15697479248047, 86.10253143310547, 84.54066467285156, 84.97219848632812, 86.0733871459961, 86.28196716308594, 92.54752349853516, 112.39783477783203, 80.6657943725586, 84.13703155517578, 82.03197479248047, 83.72563171386719, 87.93975067138672, 102.54778289794922, 110.9996109008789, 87.1410903930664, 111.39380645751953, 95.64540100097656, 95.32003021240234, 99.80992889404297, 121.2625503540039, 161.78253173828125, 137.08810424804688, 145.86973571777344, 125.42029571533203, 126.5094223022461], "yaxis": "y", "type": "scatter" }], { "template": { "data": { "histogram2dcontour": [{ "type": "histogram2dcontour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "choropleth": [{ "type": "choropleth", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "histogram2d": [{ "type": "histogram2d", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmap": [{ "type": "heatmap", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "heatmapgl": [{ "type": "heatmapgl", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "contourcarpet": [{ "type": "contourcarpet", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "contour": [{ "type": "contour", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "surface": [{ "type": "surface", "colorbar": { "outlinewidth": 0, "ticks": "" }, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]] }], "mesh3d": [{ "type": "mesh3d", "colorbar": { "outlinewidth": 0, "ticks": "" } }], "scatter": [{ "fillpattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 }, "type": "scatter" }], "parcoords": [{ "type": "parcoords", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolargl": [{ "type": "scatterpolargl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "bar": [{ "error_x": { "color": "#2a3f5f" }, "error_y": { "color": "#2a3f5f" }, "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "bar" }], "scattergeo": [{ "type": "scattergeo", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterpolar": [{ "type": "scatterpolar", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "histogram": [{ "marker": { "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "histogram" }], "scattergl": [{ "type": "scattergl", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatter3d": [{ "type": "scatter3d", "line": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattermapbox": [{ "type": "scattermapbox", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scatterternary": [{ "type": "scatterternary", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "scattercarpet": [{ "type": "scattercarpet", "marker": { "colorbar": { "outlinewidth": 0, "ticks": "" } } }], "carpet": [{ "aaxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "baxis": { "endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f" }, "type": "carpet" }], "table": [{ "cells": { "fill": { "color": "#EBF0F8" }, "line": { "color": "white" } }, "header": { "fill": { "color": "#C8D4E3" }, "line": { "color": "white" } }, "type": "table" }], "barpolar": [{ "marker": { "line": { "color": "#E5ECF6", "width": 0.5 }, "pattern": { "fillmode": "overlay", "size": 10, "solidity": 0.2 } }, "type": "barpolar" }], "pie": [{ "automargin": true, "type": "pie" }] }, "layout": { "autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": { "color": "#2a3f5f" }, "hovermode": "closest", "hoverlabel": { "align": "left" }, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": { "bgcolor": "#E5ECF6", "angularaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "radialaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "ternary": { "bgcolor": "#E5ECF6", "aaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "baxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" }, "caxis": { "gridcolor": "white", "linecolor": "white", "ticks": "" } }, "coloraxis": { "colorbar": { "outlinewidth": 0, "ticks": "" } }, "colorscale": { "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]] }, "xaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "yaxis": { "gridcolor": "white", "linecolor": "white", "ticks": "", "title": { "standoff": 15 }, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2 }, "scene": { "xaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "yaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 }, "zaxis": { "backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2 } }, "shapedefaults": { "line": { "color": "#2a3f5f" } }, "annotationdefaults": { "arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1 }, "geo": { "bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white" }, "title": { "x": 0.05 }, "mapbox": { "style": "light" } } }, "xaxis": { "anchor": "y", "domain": [0.0, 1.0], "title": { "text": "index" } }, "yaxis": { "anchor": "x", "domain": [0.0, 1.0], "title": { "text": "Sales" } }, "legend": { "title": { "text": "" }, "tracegroupgap": 0 }, "title": { "text": "Simple LSTM Model Forecasts" }, "height": 500, "width": 700 }, { "responsive": true }).then(function () {

                      var gd = document.getElementById('a133a400-4c2b-4227-ba3b-06bf07c108a9');
                      var x = new MutationObserver(function (mutations, observer) {
                        {
                          var display = window.getComputedStyle(gd).display;
                          if (!display || display === 'none') {
                            {
                              console.log([gd, 'removed!']);
                              Plotly.purge(gd);
                              observer.disconnect();
                            }
                          }
                        }
                      });

                      // Listen for the removal of the full notebook cells
                      var notebookContainer = gd.closest('#notebook-container');
                      if (notebookContainer) {
                        {
                          x.observe(notebookContainer, { childList: true });
                        }
                      }

                      // Listen for the clearing of the current output cell
                      var outputEl = gd.closest('.output');
                      if (outputEl) {
                        {
                          x.observe(outputEl, { childList: true });
                        }
                      }

                    })
                  };
                });            </script>
            </div>
          </div>
        </div>
        <div class="cell" data-execution_count="11">
          <div class="cell-output cell-output-stdout">
            <pre><code>MAPE for Tuned RNN Model is: 0.1282406598329544
R2 Score for Tuned RNN Model is: 0.4284575613815327

Total Cost for Tuned RNN Model is: €53,048.00</code></pre>
          </div>
        </div>
      </section>
      <section id="results-and-conclusion" class="level1" data-number="4">
        <h1 data-number="4"><span class="header-section-number">4</span> Results and Conclusion</h1>
        <p>We have tuned all models and calculated the total costs in terms of our cost function and the winner is
          <strong>RNN Model</strong> with the total cost of <strong>€53,048.00</strong>! XGBoost’s performance is not
          surprising given that it is usually the winning model for competitions but STL-ARIMA has also performed very
          successfully. RNN models were, for me, somewhat disappointing; however, it should be stated that we didn’t
          fully utilized LSTM cells’ memory because we have only used one timestep in the input. Increasing timesteps
          could potentially improve its performance. ARIMAX was the worst performer even with tuning. It could be
          because of the feature matrix that we have created couldn’t fully capture seasonality and trend.
        </p>
        <p>Even though we have added calendar features, they might not be enough to predict seasonality and trend.
          Therefore, a decomposition model where a model similar to STL decompose the time series to trend, seasonality,
          and residuals and after that a seperate regression model trained on only residuals could potentially be more
          accurate; but that’s all for this post.</p>
        <p><strong>Thank you for reading this post and see you on the next one!</strong></p>


      </section>

    </main> <!-- /main -->
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const toggleBodyColorMode = (bsSheetEl) => {
          const mode = bsSheetEl.getAttribute("data-mode");
          const bodyEl = window.document.querySelector("body");
          if (mode === "dark") {
            bodyEl.classList.add("quarto-dark");
            bodyEl.classList.remove("quarto-light");
          } else {
            bodyEl.classList.add("quarto-light");
            bodyEl.classList.remove("quarto-dark");
          }
        }
        const toggleBodyColorPrimary = () => {
          const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
          if (bsSheetEl) {
            toggleBodyColorMode(bsSheetEl);
          }
        }
        toggleBodyColorPrimary();
        const icon = "";
        const anchorJS = new window.AnchorJS();
        anchorJS.options = {
          placement: 'right',
          icon: icon
        };
        anchorJS.add('.anchored');
        const clipboard = new window.ClipboardJS('.code-copy-button', {
          target: function (trigger) {
            return trigger.previousElementSibling;
          }
        });
        clipboard.on('success', function (e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button,
              {
                trigger: "manual",
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]
              });
            tooltip.show();
          }
          setTimeout(function () {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        });
        function tippyHover(el, contentFn) {
          const config = {
            allowHTML: true,
            content: contentFn,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function (el) {
              return el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'bottom-start'
          };
          window.tippy(el, config);
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i = 0; i < noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function () {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch { }
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            return note.innerHTML;
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i = 0; i < bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function () {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function (cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
    </script>
  </div> <!-- /content -->



</body>

</html>